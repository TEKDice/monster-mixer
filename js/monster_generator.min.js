function _getArmorBonus(n){var t={};return isset(n.marmor[0])&&(t[n.marmor[0].aname]=parseInt(n.marmor[0].ac_bonus)),isset(n.marmor[1])&&(t[n.marmor[1].aname]=parseInt(n.marmor[1].ac_bonus)),t}function getFlatac(n){var t={Base:10},i=parseInt(n.data[0].natural_ac),r=parseInt(n.data[0].insight),u=parseInt(n.data[0].deflection),f=getBonus(n.data[0].dex),e=_getSizeModifier(n.data[0].size);return i!=0&&(t["Natural AC"]=i),r!=0&&(t["Insight AC"]=r),u!=0&&(t["Deflection AC"]=u),f>0&&(t["DEX Bonus"]=f),e!=0&&(t["Size Mod"]=e),collect(t,_getArmorBonus(n))}function getTouchac(n){return _baseAc(n)}function getAc(n){var t={},i=parseInt(n.data[0].natural_ac),r=parseInt(n.data[0].insight),u=parseInt(n.data[0].deflection);return i!=0&&(t["Natural AC"]=i),r!=0&&(t["Insight AC"]=r),u!=0&&(t["Deflection AC"]=u),collect(t,_baseAc(n),_getArmorBonus(n))}function _baseAc(n){var t={Base:10},i=getBonus(n.data[0].dex),r=_getSizeModifier(n.data[0].size);return i!=0&&(t["DEX Bonus"]=i),r!=0&&(t["Size Mod"]=r),t}function _getSizeModifier(n){switch(n){case 10:case"Fine":return 8;case 9:case"Diminutive":return 4;case 6:case"Tiny":return 2;case 1:case"Small":return 1;case 2:case"Medium":return 0;case 3:case"Large":return-1;case 5:case"Huge":return-2;case 7:case"Gargantuan":return-4;case 8:case"Colossal":return-8}}function isset(n){return n!=undefined&&n.length!=0}function doAttack(n,t,i,r,u,f,e,o,s,h,c,l,a,v){var it,ct,tt,ft,d,y;r&&(r=r.trim()),u&&(u=u.trim());var g=$("a[href='#"+f+"']").html(),et=t.indexOf("(2h)")!=-1,ut=1,ot=a!=null?a:e;for(it=0;it<e;it++){ct=v!=null?v:it,ut=1;var w=0,b="",p="",nt=ot>1?"("+(v+1)+"/"+ot+") ":"";if(i){tt=_buildRoll(n,h,!0,o,!1);for(y in tt)if(tt[y]!=0&&(w+=tt[y],b+=y+": "+tt[y]+"<br>",p=_critStatus(tt[y],y,s,!0)||p,p=="threat"||p=="success")){var rt=_buildRoll(n,h,!0,o,!1),st=0,ht="",k=_buildRoll(n,t,!1,o,i);et&&k["Power Attack"]!==undefined&&(k["Power Attack"]*=2);for(y in k)k[y]!=0&&(st+=k[y],ht+=y+": "+k[y]+"<br>");ut=c||1,rt=_rollArray(rt),k=_rollArray(k)}p=="threat"||p=="success"?(addToLog(nt+logMessages.critAttempt(g,u,b,w),p,f),addToLog(nt+logMessages.critMiss(g,u,ht,st)+(r!=null&&r!="null"?" ("+r+" occurs)":""),p,f),addToLog(nt+logMessages.critSecond(g,u,rt.text,rt.result),p,f)):addToLog(nt+logMessages.initiate(g,u,b,w),p,f)}for(w=0,b="",ft=0;ft<ut;ft++){d=_buildRoll(n,t,!1,o,i),et&&d["Power Attack"]!==undefined&&(d["Power Attack"]*=2);for(y in d)d[y]!=0&&(w+=d[y],b+=y+": "+d[y]+"<br>",p=_critStatus(d[y],y,0,!1)||p)}(p=="threat"||p=="success")&&i?addToLog(nt+logMessages.critSuccess(g,u,b,w)+(r!=null&&r!="null"?" ("+r+" occurs)":""),p,f):i?addToLog(nt+logMessages.hit(g,u,b,w)+(r!=null&&r!="null"?" ("+r+" occurs)":""),p,f):addToLog(nt+logMessages.skill(g,u,b,w),p,f)}}function attack(n,t,i){var o=typeof n.attr("data-fatk")!="undefined",s=n.attr("data-roll"),h=n.attr("data-spatk"),c=n.attr("data-roll-for"),e=t.closest("div[data-for]").attr("id"),u=n.attr("data-attack-roll"),r;u=typeof u!="undefined"&&u!==!1;var l=parseInt(n.attr("data-how-many"))||1,f=n.attr("data-range")!="0",a=parseInt(n.attr("data-min-crit")),v=n.attr("data-attack-roll"),y=parseInt(n.attr("data-crit-mult")),p=$("#"+i+"_calc_cleave").children().val();o?(r=$.parseJSON(n.attr("data-fatk")),f=r.range!="0",$.each(r.rolls,function(n,t){var u=t.refIndex;doAttack(i,JSON.stringify(t.tohit),!0,r.spatk[u],r.names[u],e,1,f,r.minCrit[u],JSON.stringify(t.damage),r.critMult[u],!0,r.rolls.length,n)})):doAttack(i,s,u,h,c,e,l,f,a,v,y,!1)}function _critStatus(n,t,i,r){var u;return n<=1&&t.indexOf("1d20")!=-1&&t.indexOf("Base")!=-1?u="fail":r&&n>=i&&t.indexOf("1d20")!=-1&&t.indexOf("Base")!=-1?(u="threat",n>=20&&(u="success")):n>=20&&t.indexOf("1d20")!=-1&&t.indexOf("Base")!=-1&&(u="success"),u}function _buildRoll(n,t,i,r,u){var e=rollDice(t),f;return i&&(hasFeat(n,"Combat Expertise")&&(f=parseInt($("#"+n+"_calc_ce").children("input").val()),isNaN(f)||(e["Combat Expertise"]=-f)),hasFeat(n,"Awesome Blow")&&$("#"+n+"_calc_ab").is(":checked")&&(e["Awesome Blow"]=-4),hasFeat(n,"Point Blank Shot")&&$("#"+n+"_calc_pbs").is(":checked")&&r&&(e["Point Blank Shot"]=1),hasFeat(n,"Power Attack")&&(f=parseInt($("#"+n+"_calc_pa").children("input").val()),f==0||isNaN(f)||(e["Power Attack"]=-f))),u&&(hasFeat(n,"Power Attack")&&(f=parseInt($("#"+n+"_calc_pa").children("input").val()),f==0||isNaN(f)||(e["Power Attack"]=f)),hasFeat(n,"Point Blank Shot")&&$("#"+n+"_calc_pbs").is(":checked")&&r&&(t["Point Blank Shot"]=1)),e}function _rollArray(n){var i={result:0,text:""},t;for(t in n)n[t]!=0&&n[t]!=null&&(i.result+=n[t],i.text+=t+": "+n[t]+"<br>");return i}function loadFilters(){if(Data.hasVar("filters")){var n=Data.getVar("filters");$.each(n,function(n,t){_addNewFilter(t)})}}function addNewFilter(){var t=$("#filters").val(),n={name:t},i;if(filterData[t]instanceof Array)n.value=$("#joinSelect").val();else if(filterData[t]){if(i=$("#numberInput").val(),i==0)return;n.value=$("#numberInput").val(),n.sign=$("#signChooser").val()}else n.value=$("#autocompleteName").val();_addNewFilter(n)&&_trackFilter(n,!0)}function _addNewFilter(n){var l=n.name,i=_cleanName(n.name),e=$("#"+i+"_filters"),u,t,r;if(e.length){if(u=!1,$("."+i+"-filter").each(function(){if($(this).attr("data-sign")==n.sign&&$(this).attr("data-value")==n.value){$(this).animate({boxShadow:"0 0 15px #f00"},1e3,function(){$(this).animate({boxShadow:"none"})}),u=!0;return}}),u)return!1;t=$("<span/>",{text:getFilterText(n)+" "}).attr("data-value",n.value).attr("data-sign",n.sign).addClass("badge").addClass("badge-info").addClass(i+"-filter"),r=$("<sup/>",{text:"[x]"}).addClass("filter-remover"),t.appendTo(e),r.appendTo(t)}else{var f=$("<tr/>",{}).attr("data-attr",n.name),o=$("<td/>",{}),c=$("<span/>",{text:n.name}).addClass("label filter-label");f.appendTo("#filterTable"),o.appendTo(f),c.appendTo(o);var s=$("<td/>",{}),h=$("<div/>",{id:i+"_filters"}).attr("data-attr",n.name).addClass("inner-filter-container"),t=$("<span/>",{text:getFilterText(n)+" "}).attr("data-value",n.value).attr("data-sign",n.sign).addClass("badge badge-info "+i+"-filter"),r=$("<sup/>",{text:"[x]"}).addClass("filter-remover");s.appendTo(f),h.appendTo(s),t.appendTo(h),r.appendTo(t)}return makeSpansRemovable(),!0}function _trackFilter(n,t){Data.hasVar("filters")||Data.setVar("filters",[]);var i=Data.getVar("filters"),r=!1;$.each(i,function(u,f){f&&n.name==f.name&&n.sign==f.sign&&n.value==f.value&&(t?r=!0:i.splice(u,1))}),!r&&t&&i.push(n),Data.setVar("filters",i)}function makeSpansRemovable(){$(".filter-remover").click(function(){$(this).parent().fadeOut(function(){var n=$(this).siblings().size();n==0&&$(this).closest("tr").remove(),_trackFilter({name:$(this).closest("[data-attr]").attr("data-attr"),value:$(this).closest("[data-value]").attr("data-value"),sign:$(this).closest("[data-sign]").attr("data-sign")},!1),$(this).remove()})})}function getFilterText(n){return n.hasOwnProperty("sign")?n.sign+n.value:n.value}function initializeAutocomplete(){$("#autocompleteName").autocomplete({source:autocompleteList,minLength:2,select:function(n,t){return $("#autocompleteName").val(t.item.label),addNewFilter(),$("#autocompleteName").val(""),!1}})}function initializeFilterSelect(){for(var n in filterData)$("#filters").append("<option value='"+n+"'>"+n+"<\/option>");$("#filters").change(function(){var n,t;if($(".joinOpt, .numericOpt, .nameOpt").hide(),$("#numberInput, #autocompleteName").val(""),$("#joinSelect").empty(),filterData[$(this).val()]instanceof Array){$(".joinOpt").fadeIn(),n=filterData[$(this).val()];for(t in n)$("#joinSelect").append("<option value='"+n[t]+"'>"+n[t]+"<\/option>")}else filterData[$(this).val()]?$(".numericOpt").fadeIn():$(".nameOpt").fadeIn()})}function $$(n){return $("#"+n)}function _arrToTooltip(n){var i="",t;for(t in n)n[t]!=0&&(i+=t+": "+n[t]+"<br>");return i}function overlayLoadingGif(){($t=$("#monsterListCont"),$t.length)&&($("#overlay").css({opacity:.8,top:$t.offset().top,left:$t.offset().left,width:$t.outerWidth(),height:$t.outerHeight()}),$("#img-load").css({top:$t.height()/2,left:$t.width()/2}))}function rollDice(n){var t,i;try{i=$.parseJSON(n),t=[],$.each(i,function(n,i){n=="Base"&&(n="Base ("+i+")"),t[n]=typeof i=="string"&&i.indexOf("d")!=-1?parseInt(rollExpression(i)):isNaN(parseInt(i))?0:parseInt(i)})}catch(r){t=rollExpression(n)}return t===undefined?(bootbox.alert("The roll '"+n+"'' is invalid."),null):t}function determineRoll(n){if(n.hasClass("roll_me")){var t=rollExpression(n.attr("data-base-value"));n.attr("data-initial-roll",t)}}function getBonus(n){return get_bonus(n)}function get_bonus(n){return(n=parseInt(n),n==0||isNaN(n))?0:Math.floor(n/2)-5}function _cleanName(n){return n.split(" ").join("")}function bodyBinding(){$("body").on("click",".reroll-hp",function(){var n=$(this).attr("data-uid");monsters[n].hp.hp().reroll()});$("body").on("click",".left",function(){var t=$("#monsterList").children(".active"),n;n=t.is($("#monsterList").children().first())?$("#monsterList").children().last():$("#monsterList").children(".active").prev(),n.children("a").tab("show")});$("body").on("click",".right",function(){var t=$("#monsterList").children(".active"),n;n=t.is($("#monsterList").children().last())?$("#monsterList").children().first():$("#monsterList").children(".active").next(),n.children("a").tab("show")});$(".loaded").livequery(function(){var n=$(this).closest(".minibox-content").find("tr[data-roll]:not(.unrollable)");n.each(function(){$(this).click(function(){n.removeClass("info"),$(this).hasClass("info")?$(this).removeClass("info"):$(this).addClass("info")})})}),$(".delete").livequery(function(){$(this).click(function(){var n=$(this).attr("data-uid"),t=$("#"+n+"_name").text();bootbox.confirm("Are you sure you want to remove "+t+" from the encounter?",function(t){t&&remove(n,!1)})})}),addFeatFunctions()}function addFeatFunctions(){}function collect(){for(var t={},i=arguments.length,n=0;n<i;n++)for(p in arguments[n])arguments[n].hasOwnProperty(p)&&(t[p]=arguments[n][p]);return t}function clamp(n,t,i){return i=Math.max(n,i),Math.min(t,i)}function checkboxName(n){switch(n){case"Awesome Blow":return"ab";case"Point Blank Shot":return"pbs";case"Rage":return"rage";case"Dodge":return"dodge";case"Frenzy":return"frenzy"}return searchNameForNamedEntries(n)}function searchNameForNamedEntries(n){return n.indexOf("Frenzy")!=-1?"frenzy":n.indexOf("Rage")!=-1?"rage":!1}function hasTwoWeapons(n){return hasFeat(n,"Two-Weapon Fighting")||hasFeat(n,"Multiweapon Fighting")}function hasWeaponFocus(n,t){if(hasFeat(t,"Weapon Focus")){var i=fullFeatName(t,"Weapon Focus"),r=i.substring(i.indexOf("(")+1,i.indexOf(")"));if(n.aname!=undefined&&n.aname.toLowerCase().indexOf(r.toLowerCase())!=-1||n.wname!=undefined&&n.wname.toLowerCase().indexOf(r.toLowerCase())!=-1)return!0}return!1}function addNewMonster(n){$(".alert").hide(),$("#monsterList").show();var t=(new Date).getTime();return _addNewMonster(n,t),_hidePopup(),saveMonsters(),t}function _addNewMonster(n,t,i){var f=$("<li/>"),h=n==null?i:n.data[0].name,u=$("<a/>",{href:"#"+t}).html("[<span class='logCount'>"+ ++monsterCount+"<\/span>] "+h).attr("data-toggle","tab").attr("data-uid",t),e,r,c,o,s;u.appendTo(f),u.attr("class","hp-good"),e=$("#dummyData").html(),$("#monsterData").append(e),r=$(".tab-pane[data-for='none']").not("#dummyData > [data-for='none']"),r.attr("id",t),r.attr("data-for",t),r.find("*[id*='1A']").each(function(){$(this).attr("id",$(this).attr("id").replace("1A",t))}),r.find("*[data-uid*='1A']").each(function(){$(this).attr("data-uid",$(this).attr("data-uid").replace("1A",t))}),t in monsters||(monsters[t]=new MonsterModel(t,n)),ko.applyBindings(monsters[t],$$(t)[0]),setUpHp(t),c=$("#monsterList").niceScroll({horizrailenabled:!1,zindex:9,railoffset:{left:-118}}),$("#monsterList").css("overflow","hidden"),tabChangeScrollbars(),setupRollables(r),limitFeatNums(t),o=$("#dummyLog").html(),$("#curMon").append(o),s=$(".log[data-for='none']").not("#dummyLog > [data-for='none']"),s.attr("id",t+"_log").attr("data-for",t),f.appendTo($("#monsterList")),u.tab("show"),sortMonsters()}function sortMonsters(){var n=$("#monsterList"),t=n.children("li").get();t.sort(function(n,t){var i=parseInt($("#"+$(n).children("a").attr("data-uid")+"_init").text()),r=parseInt($("#"+$(t).children("a").attr("data-uid")+"_init").text());return r-i}),$.each(t,function(t,i){n.append(i)})}function buildACInfo(n,t){var i=getACArr(n,t);return i==null?"":_arrToTooltip(i)}function getACArr(n,t){switch(t){case"ac":return getAc(n);case"flatfoot_ac":return getFlatac(n);case"touch_ac":return getTouchac(n);default:return null}return null}function refreshAc(n){var r=$.parseJSON(n.attr("data-ac")),i=_rollArray(r),t;n.empty(),t=$("<a/>").text(i.result).attr("href","#").attr("rel","tooltip").addClass("has-tooltip reg-has-tt").attr("title",i.text),n.append(t),manualTooltip(t)}function addDataToMonster(n,t,i){var r=t.data[0],u,f,o,e;n.find("*[id*='1A']").each(function(){var n=$(this).attr("data-attr"),u,f;if($(this).attr("id",$(this).attr("id").replace("1A",i)),$(this).attr("data-uid",i),r.hasOwnProperty(n)){if(u=r[n]=="0"&&$(this).hasClass("dashable")?"--":r[n]+($(this).hasClass("ftable")?"ft":""),n=="cr")if(r[n]<1)switch(r[n]){case"0.25":return $("<div/>").html("&frac14;").text();case"0.33":return $("<div/>").html("&frac13;").text();case"0.50":return $("<div/>").html("&frac12;").text()}else $(this).text(parseInt(r[n]));else n=="ac"||n.indexOf("_ac")!=-1?($(this).attr("data-ac",JSON.stringify(getACArr(t,n))),refreshAc($(this))):n=="grapple"?(f=$(this),$("#"+i+"_mfeat_table .loaded").livequery(function(){var n=parseInt(u);hasFeat(i,"Racial Grapple Bonus")&&(n+=4),hasFeat(i,"Improved Grapple")&&(n+=4),f.text(n)})):$(this).text(u);$(this).attr("data-base-value",$(this).text()),determineRoll($(this))}}),n.find(".stats tr").each(function(){var t=$(this).children("td").eq(1).text(),n=get_bonus(t);$(this).children("td").eq(1).text(t+(t!="--"?" ("+(n<0?n:"+"+n)+")":"")),$(this).attr("data-roll",JSON.stringify({Base:"1d20",Bonus:n})),$(this).attr("data-roll-for",$(this).children("td").eq(0).text())}),n.find(".cstats tr").each(function(){var n=parseInt($(this).children("td").eq(1).text());$(this).attr("data-roll",JSON.stringify({Base:"1d20",Bonus:n})),$(this).attr("data-roll-for",$(this).children("td").eq(0).text().trim())});for(u in t)if(u!="data"&&isNaN(parseInt(u))){if(f=$("#"+i+"_"+u+"_table"),f.length==0||t[u].length==0)continue;appendToTable(f,r.name,u,t[u]),f.append("<tr class='loaded' style='display: none;'><\/tr>")}o=r.size+" "+r.category,t.msubcat.length>0&&(e=[],$.each(t.msubcat,function(n,t){e.push(t.subcategory)}),e.length>0&&(o+=" ("+e.join(", ")+")")),$("#"+i+"_name").attr("title",o).tooltip(),setUpHp(n,i),rollInit($("#"+i+"_init"))}function setUpHp(n){var t=$("#dummyModifiable").html();t=t.split("1A").join(n),$("#health_"+n).popover({html:!0,placement:"bottom",content:t,title:"Modify HP"}).click(function(){$(".modify-hp").click(function(){var t=parseInt($$(n+"_hp_mod").val());$(this).hasClass("subtract")?modifyHp(n,-t):modifyHp(n,t)})})}function appendToTable(n,t,i,r){i!="mmove"&&n.empty();var u=n.attr("data-uid");$.each(r,function(f,e){var h,o,s;if(e.name!="Racial Grapple Bonus"){if((i=="mskill"||i=="mfeat"||i=="mqualit")&&e.name.indexOf("No ")!=-1||i=="mattack"&&e.aname.indexOf("No ")!=-1){n.append('<tr class="no-data"><td>None<\/td><\/tr>');return}e.hasOwnProperty("is_melee")&&e.hasOwnProperty("is_ranged")&&e.hasOwnProperty("wname")&&e.is_melee=="1"&&e.is_ranged!="0"?(o=e.wname.trim(),h=e.is_ranged,e.wname=o+" (Melee)",e.is_ranged="0",_createRow(n,t,i,r,f,e,u),e.is_ranged=h,e.is_melee="0",e.wname=o+" (Ranged)",_createRow(n,t,i,r,f,e,u)):e.hasOwnProperty("is_multi_handed")&&e.is_multi_handed=="1"?(o=e.wname.trim(),e.is_one_handed="1",e.wname=o+" (1H)",_createRow(n,t,i,r,f,e,u),s=jQuery.extend(!0,{},e),s.is_one_handed="0",s.wname=o+" (2H)",_createRow(n,t,i,r,f,s,u)):_createRow(n,t,i,r,f,e,u)}}),n.find("td.has-tooltip").each(function(){var n=$(this).text().trim();$(this).text(""),$(this).prepend('<i class="icon-bookmark"><\/i><a href="#" rel="tooltip" title="'+$(this).attr("data-desc")+'">'+n+"<\/a>"),manualTooltip($(this).find("a"))})}function manualTooltip(n){n.tooltip({html:!0,placement:"bottom",trigger:"manual"}),n.click(function(){var t=$(this),n=!0;$(".in").each(function(){$(this).siblings("a").is(t)&&(n=!1),$(this).siblings("a").tooltip("hide")}),n&&$(this).tooltip("show")})}function _createRow(n,t,i,r,u,f,e){var o=$("<tr/>"),l,s,w,ut,a;o.appendTo(n),i=="mfeat"&&(o.attr("data-times-taken",f.feat_level),o.attr("data-full-name",f.name));var v="",nt="",c=rollable.hasOwnProperty(i)?rollable[i](f,e,v,nt):null,y=attackRolls.hasOwnProperty(i)?attackRolls[i](f,e,v):null;if(c&&(o.attr("data-roll","0"),$("#"+e+"_"+i+"_table .loaded").livequery(function(){c!="{}"?o.attr("data-roll",c):o.unbind()}),l=mainStat[i](f),l.indexOf(t)!=-1&&(l=l.substring(t.length).trim()),o.attr("data-roll-for",l),(i=="mweapon"||i=="mattack"||i=="mspatk")&&(f.spatk!=null&&f.spatk.indexOf(t)!=-1&&(f.spatk=f.spatk.substring(t.length+1)),o.attr("data-spatk",f.spatk),v=f.is_ranged,nt=f.is_melee,o.attr("data-range",v),s=0,f.hasOwnProperty("critical")&&(f.critical.indexOf("-")!=-1?(w=f.critical.split("-"),o.attr("data-crit-mult",w[1].split("x")[1]),s=parseInt(w[0])):f.critical=="0"?(s=20,o.attr("data-crit-mult",2)):f.critical.indexOf("x")!=-1?(s=20,o.attr("data-crit-mult",f.critical.substring(1))):console.error("critical wasn't parseable: "+f.critical+" "+f.name)),$("#"+e+"_"+i+"_table .loaded").livequery(function(){hasFeat(e,"Improved Critical")&&(s=21-(21-s)*2),o.attr("data-min-crit",s)}))),y&&(f.class_mult!=null||i=="mspatk"||i=="mfatk")&&(o.attr("data-attack-roll","0"),$("#"+e+"_"+i+"_table .loaded").livequery(function(){o.attr("data-attack-roll",y)})),o.attr("data-how-many","1"),attackRolls.hasOwnProperty(i)&&f.how_many!=null&&o.attr("data-how-many",f.how_many),i=="mfatk"){var tt=[],b=[],p=[],k=[],d=[],ft=[],g=[],h=[],it=[],rt=[];$.each(f,function(n,i){var l,a,u,s;if(i.spatkname!=null&&i.spatkname.indexOf(t)!=-1&&(i.spatkname=i.spatkname.substring(t.length+1)),ft.push(parseInt(i.is_uses_bab)),tt.push(i.spatkname),g.push(i.mfa_class_mult=="0.50"?1:0),i.wir?b.push(i.wir):b.push(i.mfa_range),l=0,i.critical=i.atkct||i.wct,i.critical||(i.critical="0"),i.how_many=i.atkhm||i.whm,i.how_many||(i.how_many="1"),it.push(i.wname||i.aname),d.push(i.how_many),i.hasOwnProperty("critical")&&(i.critical.indexOf("-")!=-1?(a=i.critical.split("-"),p.push(a[1].split("x")[1]),l=parseInt(a[0])):i.critical=="0"?(l=20,p.push(2)):i.critical.indexOf("x")!=-1?(l=20,p.push(i.critical.substring(1))):console.error("critical wasn't parseable: "+f.critical+" "+f.name)),$("#"+e+"_mfeat_table .loaded").livequery(function(){hasFeat(e,"Improved Critical")&&(l=21-(21-l)*2),k.push(l),o.attr("data-min-crit",JSON.stringify(k))}),i.is_uses_bab=="1"){var v=parseInt($("#"+e+"_bab").text()),w=v/5,nt=v%5,ut=Math.max(Math.floor(w)+(nt!=0?1:0),1),r=1;for(s=0;s<ut;s++)u={damage:$.parseJSON(y)[n],tohit:$.parseJSON(c)[n],refIndex:n},r>1&&(u.damage["Attack "+r]=-(r-1)*5),g[n]?s==0?h.push(u):(hasFeat(e,"Greater Two-Weapon Fighting")||hasFeat(e,"Greater Multiweapon Fighting"))&&r==2?(h.push(u),r++):(hasFeat(e,"Improved Two-Weapon Fighting")||hasFeat(e,"Improved Multiweapon Fighting"))&&r==1&&(h.push(u),r++):(h.push(u),r++);rt.push(r)}else for(u={damage:$.parseJSON(y)[n],tohit:$.parseJSON(c)[n],refIndex:n},s=0;s<d[n];s++)h.push(u)}),ut={range:b,spatk:tt,names:it,critMult:p,howMany:d,atkCt:rt,minCrit:k,secondary:g,rolls:h},o.attr("data-fatk",JSON.stringify(ut)),f.descript=getFullAttackInfo(f)}a=formatting[i](f),a.indexOf(t)!=-1&&(a=a.substring(t.length+1)),o.append("<td"+(f.hasOwnProperty("descript")?" class='has-tooltip' data-desc='"+f.descript.split("\n").join("<br>")+"'":"")+">"+a+"<\/td>")}function getFullAttackInfo(n){var t="";return $.each(n,function(n,i){t+=(i.wname||i.aname)+": "+(i.whd||i.atkhd)+" x"+i.how_many+"<br>"}),t}function limitFeatNums(n){$("#"+n+"_mfeat_table .applyNum").each(function(){var t=$(this).closest("td").prev().text(),i=t=="Power Attack",r=t=="Cleave";$(this).change(function(){var u=parseInt($(this).val()),f=parseInt($("#"+n+"_bab").text()),e=i?f:r?4:5,o=clamp(0,e,parseInt($("#"+n+"_bab").attr("data-base-value")));u=clamp(0,o,u),$(this).val(u),t=="Combat Expertise"&&(incdecACStat(n,"ac","Combat Expertise",null,u),incdecACStat(n,"touch_ac","Combat Expertise",null,u))}),$(this).closest("td").attr("id",n+"_calc_"+(i?"pa":r?"cleave":"ce"))}),$(".inline-checkbox").each(function(){var t=checkboxName($(this).closest("td").prev().text()),i;$(this).attr("id",n+"_calc_"+t),t=="dodge"&&(i=$(this),$(this).click(function(){i.is(":checked")?(incdecACStat(n,"ac","Dodge",!0),incdecACStat(n,"touch_ac","Dodge",!0)):(incdecACStat(n,"ac","Dodge",!1),incdecACStat(n,"touch_ac","Dodge",!1))})),(t=="frenzy"||t=="rage")&&(i=$(this),$(this).click(function(){}))})}function incdecACStat(n,t,i,r,u,f){var o=$("#"+n+"_"+t),e;try{e=$.parseJSON(o.attr("data-ac"))}catch(s){console.error("an error happened when trying to inc or dec an ac stat "+s+" "+arguments)}e[i]=e[i]==undefined?0:parseInt(e[i]),e[i]=u!=null?u:r?e[i]+1:e[i]-1,!f&&e[i]<0&&(e[i]=0),o.attr("data-ac",JSON.stringify(e)),refreshAc(o)}function setupRoller(){$("#roll").keyup(function(n){if(n.keyCode==27&&$("#roll").val(""),n.which==13){n.preventDefault();var t=$(this).val(),i=rollDice(t);i!==0&&addToLog("Custom roll: "+t+" rolled "+i+".","customRoll")}}),$("#dice button").click(function(){var n=$("#roll").val()==""?"1"+$(this).text():"+1"+$(this).text();$("#roll").val($("#roll").val()+n)})}function setupRollables(n){var t=n.find("[data-uid]").attr("data-uid");n.find(".rollable").each(function(){var n=$("<i/>").addClass("icon-share-alt");n.click(function(){var n=$(this).parent().find(".info");if(n.length===0){bootbox.alert("Please select a feature to roll.");return}attack(n,$(this),t)}),$(this).append(n)})}function setupGrids(n){$(".sortable").sortable({sort:function(){setupGrids(n)}}),$(".sortable").disableSelection(),$(".draggable").not(".invisible").find(".minibox-content").each(function(){var t=$(this).niceScroll({horizrailenabled:!1,zindex:9});$("#"+t.id).attr("data-nice-uid",n),$("#"+t.id+"-hr").remove()}),resizeGrids()}function resizeGrids(){$(".minibox-content").each(function(){$(this).height($(this).parent().height()-22)})}function setupGenButton(){$("#seeMoreButton").button("loading"),$("#finalAddButton").button("loading"),$("#finalAddButton").click(function(){_addAllSuggestedMonsters($(this))}),$("#seeMoreButton").click(function(){_seeMoreButtonFunctionality($(this))}),$("#genButton").click(function(){_genButtonFunctionality($(this))})}function _addAllSuggestedMonsters(n){n.button("generating"),setTimeout(function(){n.attr("disabled","disabled").addClass("disabled")},10),$("#overlay").fadeIn(),$("#advGenFinalContainer tr").each(function(){var n=$(this).data("monster"),t=parseInt($(this).children(":nth-child(2)").text());_hidePopup(),setTimeout(function(){for(var i=0;i<t;i++)setTimeout(function(){addNewMonster(n)},100)},500)}),$("#overlay").fadeOut(),setTimeout(function(){n.removeAttr("disabled").removeClass("disabled")},10),n.button("reset")}function _seeMoreButtonFunctionality(n){n.button("generating"),setTimeout(function(){n.attr("disabled","disabled").addClass("disabled")},10);var i=0,t={orgs:[],singles:[]},r=[];if($("#advGenMonsters input[type='checkbox']").each(function(){if($(this).is(":checked")){var u=$(this).closest("tr"),n=u.find(".only-positive").val()||null,f=u.find("select").val();(n!=null&&n!="0"||f!="null")&&i++,n!=null&&n!="0"&&(r[u.attr("data-monster-name")]=n,t.singles.push(u.attr("data-monster-id"))),f!="null"&&t.orgs.push(f)}}),i==0){setTimeout(function(){n.removeAttr("disabled").removeClass("disabled")},10),n.button("reset"),bootbox.alert("Please select some monsters to create.");return}$.post("ajax.php",{action:"gen",orgs:JSON.stringify(t)},function(n){try{_parseSuggestedMonsters($.parseJSON(n),r)}catch(i){console.error("an issue parsing suggested monsters has occurred: monsters<"+n+"> orgs<"+t+">")}$("#finalAddButton").button("reset")}).always(function(){setTimeout(function(){n.removeAttr("disabled").removeClass("disabled")},10),n.button("reset")})}function _parseSuggestedMonsters(n,t){var r=$("#advGenFinalContainer"),i=$("#advGenFinal");r.children().not("#advGenFinal").remove(),i.empty(),Object.keys(t).length?(i.show(),i.append("<caption>Monsters<\/caption>")):i.hide(),$.each(n,function(n,u){var f,s;if(u.hasOwnProperty("name"))f=$("<table/>").addClass("table table-condensed table-striped").css("position","relative").appendTo(r),f.append("<caption>"+u.name+"<\/caption>"),$.each(u.monsters,function(n,t){var i=$("<tr/>").appendTo(f);i.attr("data-gen-min",t.minimum).attr("data-gen-max",t.maximum),i.append("<td>"+t.monster.data[0].name+"<\/td><td class='rightalign'><\/td>"),i.data("monster",t.monster)}),s=$("<i/>").addClass("icon-share-alt").appendTo(f),s.click(function(){_rerollTable(f)}),_rerollTable(f);else{var e=$("<tr/>"),h=u.data[0].name,o=t[h];e.append("<td>"+h+"<\/td><td class='rightalign'>"+o+"<\/td>").appendTo(i),e.attr("data-gen-min",o).attr("data-gen-max",o),e.data("monster",u)}}),$("#advGenFinalContainer").niceScroll({zindex:14,horizrailenabled:!1}),$("#advGenFinalContainer").css("overflow","hidden")}function _rerollTable(n){n.find("tr").each(function(){var t=parseInt($(this).attr("data-gen-max")),n=parseInt($(this).attr("data-gen-min")),i=Math.floor(Math.random()*(t-n+1))+n;$(this).children(":nth-child(2)").text(i)})}function _genButtonFunctionality(n){var t,i;n.button("loading"),t={},$(".inner-filter-container").each(function(){var n=$(this).attr("data-attr");t[n]=[],_gaq.push(["_trackEvent","Filter",n]),$(this).children(".badge").each(function(){t[n].push({sign:$(this).attr("data-sign"),value:$(this).attr("data-value")})})}),i=$("#extra").is(":visible"),$.post("ajax.php",{action:"gen",data:JSON.stringify(t),adv:i},function(t){if(n.button("reset"),t===""){bootbox.alert("No results were found with your filters. Try broadening your search.");return}if(!i){t=$.parseJSON(t);var r=addNewMonster(t);setupGrids(r);return}$("#advGenMonsters").empty(),$.each($.parseJSON(t),function(n,t){addNewSuggestedRow(n,t)}),$(".only-positive").change(function(){var n=parseInt($(this).val());n<0&&(n=0),$(this).val(n)}),$("tr[data-monster-name] select, tr[data-monster-name] .only-positive").change(function(){$(this).closest("tr").find("input[type='checkbox']").prop("checked",!0)}),$("#seeMoreButton").button("reset")})}function addNewSuggestedRow(n,t){var i=$("#advGenTemplate").html();$("#advGenMonsters").append("<tr data-monster-name='"+n+"' data-monster-id='"+t.id+"'><td>"+i+"<\/td><\/tr>"),_makeSelect(n,t.orgs),$("[data-monster-name='"+n+"'] .monsterName").attr("title",n).text(n).tooltip({delay:500}),$("#advGenContainer").niceScroll({zindex:14,horizrailenabled:!1}),$("#advGenContainer").css("overflow","hidden")}function _makeSelect(n,t){var i=$("[data-monster-name='"+n+"'] select");$.each(t,function(t,r){r.organization.indexOf(n)!=-1&&(r.organization=r.organization.substring(n.length+1)),i.append("<option value='"+r.id+"'>"+r.organization+"<\/option>")}),i.append("<option value='null' selected>No Org.<\/option>")}function _hideAllMiniboxScrollbars(){$("div[data-nice-uid]").hide()}function _showScrollbars(n){$("#"+n.attr("data-uid")).find(".minibox-content").each(function(){var t=$(this).niceScroll({horizrailenabled:!1,zindex:9});$("#"+t.id).attr("data-nice-uid",n.closest("tab-pane").attr("data-for")),$("#"+t.id).show()})}function tabChangeScrollbars(){$('a[data-toggle="tab"]').on("shown",function(){_hideAllMiniboxScrollbars(),_showScrollbars($(this));var n=$(this).attr("data-uid");$("#curMon > div[data-for='"+n+"']").show().siblings().hide(),_hidePopup()})}function setupAddButton(){$("#newFilter").click(addNewFilter)}function initializePopupToggler(){$("#medianArrowContainer").click(_togglePopupInsides)}function _togglePopupInsides(){$("#extra").is(":visible")?($("#popup").animate({width:defaultPopupSize}),$("#popupLeft").animate({width:defaultPopupSize}),$("#extra").animate({width:0},function(){$("#extra").css("display","none"),$("#extraToggle").attr("class","icon-arrow-right"),$("#medianArrowContainer").attr("title","More options")})):$("#popup").animate({width:extendPopupSize},function(){$("#popupLeft").animate({width:defaultPopupSize}),$("#extra").css("display","block"),$("#extra").animate({width:extendPopupSize-defaultPopupSize}),$("#extraToggle").attr("class","icon-arrow-left"),$("#medianArrowContainer").attr("title","Less options")})}function initializeArrowToggler(){$("#showFilters").click(_togglePopup)}function _togglePopup(){$("#popup").slideToggle(400,function(){$(this).is(":visible")?($("#filterIcon").attr("class","icon-arrow-up"),$("#popup").attr("display","inline-block"),$("#filterContainer").niceScroll({zindex:14}),$("#filterContainer").css("overflow","hidden")):$("#filterIcon").attr("class","icon-arrow-down")})}function _hidePopup(){$("#popup").slideUp(400,function(){$("#filterIcon").attr("class","icon-arrow-down")})}function timedResizeElements(){clearTimeout(resizeTimer),resizeTimer=setTimeout(resizeElements,100)}function handleResizing(){$(window).resize(timedResizeElements),resizeElements()}function resizeElements(){height=$(window).height(),$("#log").css("height",height-80-heightAdjust+"px"),$("#monsterListCont").css("height",height-50-heightAdjust+"px"),$("#monsterList").css("height",height-50-heightAdjust+"px"),$(".tab-content").css("height",$("#log").height()-38),$("#log .tab-pane > div").css("height",$("#log").height()-38),$("#monstersContainer > .row-fluid").first().css("height",$("#monsterListCont").height()),resizeGrids(),changeLogEntrySize()}function addToLog(n,t,i){var r="<div class='logInner'><div class='attackSide'><p class='pull-left "+t+"' data-uid='"+i+"'>"+n+"<\/p><\/div><div class='pull-right threat-status "+t+"'><\/div><div class='clearfix'><\/div><\/div>";$("#allInfo").append(r),$("#"+i+"_log").append(r),$("#log").find("a").tooltip({html:!0}),clearTimeout(logTimer),logTimer=setTimeout(function(){$("#allInfo").animate({scrollTop:$("#allInfo")[0].scrollHeight},50),$("#curMon").animate({scrollTop:$("#curMon")[0].scrollHeight},50)},100),$("#log .tab-pane > div").niceScroll({horizrailenabled:!1}),$("#log .tab-pane > div").css("overflow","hidden"),$(".attackSide").width(newLogEntryWidth)}function changeLogEntrySize(){newLogEntryWidth=$("#allInfo").width()-70}function ACModel(n,t){var i=this;i.sizeBonus=ko.observable(_getSizeModifier(n.stats.size())),i.dex=ko.observable(n.stats.dex.bonus()),n.stats.size.subscribe(function(n){i.sizeBonus(_getSizeModifier(n)),i.arrayProps()["Size Mod"]=i.sizeBonus()}),n.stats.dex.bonus.subscribe(function(n){i.dex(n),i.arrayProps()["DEX Bonus"]=i.dex()}),i.arrayProps=ko.observable(t),i.flatfoot=new ArrayValueCountModel(n.uid+"_flatfoot_ac",i,[]),i.touch=new ArrayValueCountModel(n.uid+"_touch_ac",i,["Natural AC"]),i.total=new ArrayValueCountModel(n.uid+"_ac",i,[])}function HPModel(n,t,i,r){var u=this;u.hp=ko.observable(new RollableNumberModel(n)),u.con=ko.observable(t.bonus()),u.mod=ko.observable(new ModifiableNumberModel(0)),u.feats=ko.observable(i.feats),u.uid=r,u.countToughness=ko.computed(function(){var n=0;return $.each(u.feats()(),function(t,i){i.name=="Toughness"&&(n=parseInt(i.feat_level))}),n}),t.bonus.subscribe(function(n){u.con(n)}),u.initTotal=ko.computed(function(){return u.hp().num().val()}),u.calcConBonus=ko.computed(function(){return u.con()*parseInt(n.split("d")[0])}),u.total=ko.computed(function(){return u.initTotal()+u.mod().val()+3*u.countToughness()+u.calcConBonus()}),u.toolTip=ko.computed(function(){var f=u.hp().num().val(),i=u.mod().val(),t="Base ("+n+"): "+f;return i!=0&&(t+="<br>Modification: "+i),u.calcConBonus()!=0&&(t+="<br>CON Bonus: "+u.calcConBonus()),u.countToughness()!=0&&(t+="<br>Toughness: "+3*u.countToughness()),$$(r+"_hp").attr("data-original-title",t),t})}function FullAttackModel(n){var t=this;n.length==0&&n.push({"0":{aname:"None"}}),t.fatks=ko.observableArray(n),t.formatName=function(n){var t=[];return $.each(n,function(n,i){t.push(i.aname||i.wname)}),t.join(", ")},t.toolTip=function(n){var t="";return $.each(n,function(n,i){var r=(i.aname||i.wname)+": ";var u=i.hitdc,f=(u=="0"?"":"+")+i.dmgred_hd+" "+i.dmgname,e=i.whm||i.atkhm;u!="0"&&(r+=u+"x"+e+" "),i.dmgname!=null&&(r+=f),r+="<br />",t+=r}),t}}function InitiativeModel(n,t,i){var r=this;r.init=new RollableNumberModel("1d20"),r.dex=ko.observable(n.bonus()),r.feats=ko.observable(t.feats),r.countImprovedInitiative=ko.computed(function(){var n=0;return $.each(r.feats()(),function(t,i){i.name=="Improved Initiative"&&(n=parseInt(i.feat_level))}),n}),r.toolTip=ko.computed(function(){var n="Base (1d20): "+r.init.num().val();return r.dex!=0&&(n+="<br>DEX: "+r.dex()),r.countImprovedInitiative()!=0&&(n+="<br>Improved Initiative: "+4*r.countImprovedInitiative()),$$(i+"_init").attr("data-original-title",n),n}),t.feats.subscribe(function(n){r.feats(n)}),n.bonus.subscribe(function(n){r.dex(n)}),r.totalInit=ko.computed(function(){return r.init.num().val()+r.dex()+4*r.countImprovedInitiative()})}function WeaponAttackModel(n,t){var r=this,i=[];$.each(n,function(n,t){var f,u,r;t.hasOwnProperty("is_melee")&&t.hasOwnProperty("is_ranged")&&t.hasOwnProperty("wname")&&t.is_melee=="1"&&t.is_ranged!="0"?(u=t.wname.trim(),f=t.is_ranged,t.wname=u+" (Melee)",t.is_ranged="0",i.push(t),r=$.extend(!0,{},t),r.is_ranged=f,r.is_melee="0",r.wname=u+" (Ranged)",i.push(r)):t.hasOwnProperty("is_multi_handed")&&t.is_multi_handed=="1"?(u=t.wname.trim(),t.is_one_handed="1",t.wname=u+" (1H)",i.push(t),r=$.extend(!0,{},t),r.is_one_handed="0",r.wname=u+" (2H)",i.push(r)):i.push(t)}),n.length==0&&i.push({name:"None",descript:"",hit_dice:"0"}),r.mname=t,r.damagers=ko.observableArray(i),r.countColumns=function(n){var t=3;return n.hitdc!="0"&&t--,n.dmgname!=null&&t--,t},r.formatElemental=function(n){var t="";return n.hitdc!="0"&&(t="+"),t+=n.dmgred_hd+" ",t+n.dmgname},r.formatName=function(n){return n==undefined?"ERROR":n.indexOf(t)!=-1?n.substring(t.length):n}}function SpeedModel(n){var t=this;this.speeds=ko.observableArray(n)}function SpecialAttackModel(n,t){var i=this;n.length==0&&n.push({name:"None",descript:"",hit_dice:"0"}),i.mname=t,i.spatks=ko.observableArray(n),i.countColumns=function(n){var t=3;return n.hit_dice!="0"&&t--,n.dmgred_nm!=null&&t--,t},i.formatElemental=function(n){var t="";return n.hit_dice!="0"&&(t="+"),t+=n.dmgred_hd+" ",t+n.dmgred_nm},i.formatName=function(n){return n.indexOf(t)!=-1?n.substring(t.length):n}}function ArmorModel(n){var t=this;n.length==0&&n.push({name:"None",descript:""}),this.armors=ko.observableArray(n)}function GrappleModel(n,t){typeof n!="number"&&(n=parseInt(n));var i=this;i.feats=ko.observable(t.feats),i.base=new ModifiableNumberModel(n),i.grappleBonus=ko.computed(function(){var n=0;return $.each(i.feats()(),function(t,i){i.name=="Racial Grapple Bonus"&&(n+=4),i.name=="Improved Grapple"&&(n+=4)}),n}),i.calc=ko.computed(function(){return i.base.val()+i.grappleBonus()})}function StatModel(n){typeof n!="number"&&(n=parseInt(n));var t=this;t.base=new ModifiableNumberModel(n),t.bonus=ko.computed(function(){return getBonus(t.base.val())}),t.format=ko.computed(function(){if(t.base.val()==0)return"--";var n=t.bonus();return n==0?t.base.val():(n>0&&(n="+"+n),t.base.val()+" ("+n+")")})}function ArrayValueCountModel(n,t,i){var r=this;r.tag=n,r.ignored=i,r.kvs=ko.observable(t.arrayProps),r.sum=ko.computed(function(){var n=0;return $.each(r.kvs()(),function(t,i){$.inArray(t,r.ignored)==-1&&(n+=typeof i!="number"?i():i)}),n}),r.toolTip=ko.computed(function(){var t="";return $.each(r.kvs()(),function(n,i){$.inArray(n,r.ignored)==-1&&i!=0&&(t+=n+": "+i+"<br>")}),$$(n).attr("data-original-title",t),t})}function SkillModel(n){var t=this;n.length==1&&n[0].name=="No Skills"&&n.pop(),n.length==0&&n.push({name:"None",sub_skill:"",descript:"",skill_level:0}),t.skills=ko.observableArray(n),t.formatName=function(n){return n.sub_skill!=""&&n.sub_skill!=null?n.name+" ("+n.sub_skill+")":n.name},t.formatNum=function(n){return n.skill_level==0?"":n.skill_level>0?"+"+n.skill_level:n.skill_level}}function FeatModel(n){var t=this;n.length==1&&n[0].name=="No Feats"&&n.pop(),n.length==0&&n.push({name:"None",descript:""}),this.feats=ko.observableArray(n),t.format=function(n){return n},t.canBeShown=function(n){return n!="Racial Grapple Bonus"}}function QualityModel(n,t){var i=this;n.length==1&&n[0].name=="No Qualities"&&n.pop(),n.length==0&&n.push({name:"None",descript:""}),i.mname=t,i.qualities=ko.observableArray(n),i.isMeasurable=function(n){return n!="Spell Resistance"&&n!="Regeneration"&&n!="Turn Resistance"},i.format=function(n){return n.value+(i.isMeasurable(n.name)?"ft":"")},i.formatName=function(n){return n.indexOf(t)!=-1?n.substring(t.length):n}}function DRModel(n){var t=this;n.length==0&&n.push({name:"None",reduction_amount:-1}),t.dr=ko.observableArray(n),t.format=function(n){return n=="0"||n==0?"Immune":n==-1?"":n}}function KVModel(n){var t=this;t.array=ko.observableArray(n)}function RollableNumberModel(n){var t=this;t.rollStr=n,t.num=ko.observable(new ModifiableNumberModel(roll(t.rollStr))),t.reroll=function(){t.num(new ModifiableNumberModel(roll(t.rollStr)))}}function ModifiableNumberModel(n){var t=this;t.init=n,t.val=ko.observable(n),t.reset=function(){t.val(t.init)},t.resetToVal=function(n){t.val(t.init),t.relative(n)},t.increment=function(){t.val(t.val()+1)},t.decrement=function(){t.val(t.val()-1)},t.relative=function(n){t.val(t.val()+n)},t.absolute=function(n){t.val(n)}}function hasFeat(n,t){return hasNeedle(n,"mfeat",t,"times-taken")}function fullFeatName(n,t){return hasNeedle(n,"mfeat",t,"full-name")}function hasSkill(n,t){return hasNeedle(n,"mskill",t)}function hasQuality(n,t){return hasNeedle(n,"mqualit",t)}function hasNeedle(n,t,i,r){var f=$("#"+n+"_"+t+"_table"),u=!1;return f.find("td a").each(function(){if($(this).text().indexOf(i)!=-1){u=r!=null?$(this).closest("tr").attr("data-"+r):!0;return}}),u}function modifyHp(n,t,i){if(!isNaN(t)&&t!=0){monsters[n].hp.mod().relative(t);var u=monsters[n].hp.total(),e=monsters[n].hp.initTotal(),r=$("[href=#"+n+"]"),o=r.html(),f=Math.round(u/e*100);f<15?r.attr("class","hp-critical"):f<50?r.attr("class","hp-warning"):r.attr("class","hp-good"),i||addToLog(o+(t<0?" lost ":" gained ")+Math.abs(t)+" hp. ("+u+"/"+e+") ["+f+"%]"),saveMonsters(),u<=0&&bootbox.confirm("It looks like "+r.text()+" has died. Would you like to mark it as 'killed'?",function(t){t&&remove(n,!0)})}}function rollHp(n,t,i,r){var o=$("#"+n+"_hp"),u="",f,e,s;i=parseInt(i),i==0&&(i=1),u+=o.attr("data-base-value")+": "+i+"<br>",(f=hasFeat(n,"Toughness"))&&(f=3*parseInt(f),u+="Toughness: "+f+"<br>"),e=get_bonus(parseInt($("#"+n+"_con").text()))*parseInt(o.attr("data-base-value").split("d")[0]),e!=0&&(u+="CON Modifier: "+e+"<br>"),u=u.slice(0,-4),o.attr("data-initial-roll",i),i+=e,i+=f,o.attr("data-mod-value",e+f),$("#"+n+"_hp").children(".hp_val").text(i),s=$("#"+n+"_hp").children(".hp_val").attr("data-original-title"),r||typeof s!="undefined"&&s!==!1?$("#"+n+"_hp").children(".hp_val").attr("data-original-title",u):$("#"+n+"_hp").children(".hp_val").attr("rel","tooltip").attr("title",u),$("#"+n+"_hp").children(".hp_val").tooltip({html:!0,placement:"bottom"})}function rollInit(n){var t=parseInt(rollExpression("1d20")),i=n.attr("data-uid");_rollInit(i,t),sortMonsters()}function _rollInit(n,t){var r=$("#"+n+"_init"),u="",f,i;u+="1d20: "+t+"<br>",f=get_bonus(parseInt($("#"+n+"_dex").attr("data-base-value"))),u+="Modifier: "+f+"<br>",i=0,(i=hasFeat(r.attr("data-uid"),"Improved Initiative"))&&(i=4*parseInt(i),u+="Improved Initiative: "+i+"<br>"),r.attr("data-initial-value",t),r.text(f+t+i),r.attr("rel","tooltip").attr("title",u).attr("data-original-title",u),r.tooltip({html:!0,placement:"bottom"})}function remove(n,t){var r=$("#monsterList a[href='#"+n+"']"),u=parseInt(r.find(".logCount").text()),f=0,i;$("#monsterList li").each(function(){f++}),i=$("#monsterList li a").first(),_showScrollbars(i),i.tab("show"),f>0?(console.log(u),i=$("#monsterList li:nth-child("+(u-1)+")").find("a"),_showScrollbars(i),i.tab("show")):(t?$("#winAlert").show():$("#genAlert").show(),$("#monsterList").hide()),r.parent().remove(),$(".tab-pane[data-for='"+n+"']").remove(),$("div[data-nice-uid='"+n+"']").hide(),$("#"+n+"_log").remove(),saveMonsters(),updateLogNumbers(n,t)}function updateLogNumbers(n,t){$("#allInfo div p span.logCount").each(function(){var i=$(this).closest("[data-uid]").attr("data-uid"),n;$(this).text()=="DEAD"||$(this).text()=="GONE",n=$("#monsterList a[href='#"+i+"']"),n.length==0&&$(this).text(t?"DEAD":"GONE")})}function getPrecedence(n){return"*/".indexOf(n)!=-1?2:"-+".indexOf(n)!=-1?1:void 0}function isOperator(n){return"+-/*".indexOf(n)!=-1}function isOperand(n){return!/[^0-9d]/.test(n)}function operateOn(op,left,right){return eval(left+op+right)}function toPostfix(n){var t=[],i="",u=getTokens(n),r;for(u.forEach(function(n){if(isOperand(n))n.indexOf("d")!=-1&&(n=roll(n)),i+=n+" ";else if(isOperator(n)){while(t.length>0){var r=t.pop();if(getPrecedence(r)>=getPrecedence(n))i+=r+" ";else{t.push(r);break}}t.push(n)}});t.length>0;)r=t.pop(),i+=r+" ";return i.trim()}function getTokens(n){n=n.split(" ").join("");var t="",i=[];return n.split("").forEach(function(n){isOperand(n)?t+=n:isOperator(n)&&(i.push(t),i.push(n),t="")}),t!=""&&i.push(t),i}function evalPostfix(n){var t=[],i=n.split(" ");return i.forEach(function(n){if(isOperand(n))t.push(n);else if(isOperator(n)){var i=t.pop(),r=t.pop();t.push(operateOn(n,r,i))}}),t.pop()}function evalExpression(n){var t=toPostfix(n);return evalPostfix(t)}function rollExpression(n){return evalExpression(n)}function roll(n){var i=n.split("d"),t=parseInt(i[0]),r=parseInt(i[1]);return t<=0||r<=0?0:Math.floor(Math.random()*(t*r-t+1))+t}function sizeModifier(n){switch(n){case 10:case"Fine":return 8;case 9:case"Diminutive":return 4;case 6:case"Tiny":return 2;case 1:case"Small":return 1;case 2:case"Medium":return 0;case 3:case"Large":return-1;case 5:case"Huge":return-2;case 7:case"Gargantuan":return-4;case 8:case"Colossal":return-8}}function maneuverModifier(n){switch(n){case 10:case"Fine":return-4;case 9:case"Diminutive":return-3;case 6:case"Tiny":return-2;case 1:case"Small":return-1;case 2:case"Medium":return 0;case 3:case"Large":return 1;case 5:case"Huge":return 2;case 7:case"Gargantuan":return 3;case 8:case"Colossal":return 4}}function saveMonsters(){if(loggedIn&&currentSessionId){var n=[];($("#monsterList li a").each(function(){var r=$(this).attr("data-uid"),t=monsters[r],i={id:t.id,modHp:t.hp.mod().val(),maxHp:t.hp.initTotal(),init:t.initiative.init.num().val()};i.id!=""&&n.push(i)}),n.length!=0)&&(Data.setVar("monsters_"+currentSessionId,n),saveSession(!1))}}function loadMonsters(n){if(loggedIn){$("#overlay").fadeIn();var t=[];$.each(n,function(n,i){t.push(i.id)}),$.post("ajax.php",{action:"gen",ids:JSON.stringify(t)},function(t){var i=$.parseJSON(t);$.eachAsync(i,{loop:function(t,i){setTimeout(function(){var f=i,r=addNewMonster(f),u;setupGrids(r),u=n[t],monsters[r].hp.mod().val(u.modHp),monsters[r].hp.hp().num().val(u.maxHp),monsters[r].initiative.init.num().val(u.init),saveMonsters()},1)},end:function(){$("#overlay").fadeOut()}})})}}function removeAllMonsters(){$("#allInfo").empty(),$("#monsterList").empty(),$("#monsterData .tab-pane").remove()}function startSession(){loggedIn&&(currentSessionId=now(),saveSession(!1))}function loadSession(n){if(loggedIn){removeAllMonsters(),currentSessionId=n;var t=Data.getVar("monsters_"+n);loadMonsters(t)}}function startNewSession(){loggedIn&&currentSessionId&&(saveSession(!1),removeAllMonsters(),startSession())}function deleteSession(n){loggedIn&&currentSessionId&&Data.clearVar("monsters_"+n)}function saveSession(n,t){if(loggedIn&&currentSessionId){Data.setVar(LAST_SESSION_VARIABLE,currentSessionId),Data.hasVar(SESSIONS_VARIABLE)||Data.setVar(SESSIONS_VARIABLE,{});var i=Data.getVar(SESSIONS_VARIABLE);n&&!i.hasOwnProperty(_currentSessionId())&&bootbox.confirm("Would you like to save this new session?",function(n){n&&saveNewSession()}),i.hasOwnProperty(_currentSessionId())?(t&&(i[_currentSessionId()]=t),i[_currentSessionId()].lastUpdate=now()):(i[_currentSessionId()]=t?t:saveNewSession(),i[_currentSessionId()].lastUpdate=now()),Data.setVar(SESSIONS_VARIABLE,i)}}function saveNewSession(){var n=Data.getVar(SESSIONS_VARIABLE),t=n[_currentSessionId()]={startTime:currentSessionId,name:"Nameless Campaign",lastUpdate:now()};return Data.setVar(SESSIONS_VARIABLE,n),t}function hasPreviousSession(){var n,t;if(loggedIn)return Data.hasVar(LAST_SESSION_VARIABLE)?(n=Data.getVar(LAST_SESSION_VARIABLE),!Data.hasVar("monsters_"+n))?!1:(t=Data.getVar("monsters_"+n),t.length==0)?!1:!0:!1}function getPreviousSession(){if(loggedIn)return Data.hasVar(LAST_SESSION_VARIABLE)?Data.getVar(LAST_SESSION_VARIABLE):null}function getCurrentSession(){var n=Data.getVar(SESSIONS_VARIABLE);return n[_currentSessionId()]}function getSessionById(n){var t=Data.getVar(SESSIONS_VARIABLE);return t[n]}function sessionManagement(){loggedIn&&(hasPreviousSession()?bootbox.confirm("It looks like you had a session open. Would you like to reload it?",function(n){if(!hasReloadedSession){if(!n){startSession();return}hasReloadedSession=!0,loadSession(getPreviousSession())}}):startSession())}function _currentSessionId(){return currentSessionId.toString()}function now(){return(new Date).getTime()}function changeStatus(n){switch(n){case"ok":updateTextIcon("icon-ok","Ready");return;case"syncing":updateTextIcon("icon-refresh","Syncing...");return;case"noconnection":updateTextIcon("icon-warning-sign","No connection");return}}function updateTextIcon(n,t){$("#noChangeColor").attr("class","").addClass(n),$("#statusText").text(t)}var bootbox=window.bootbox||function(n,t){function r(n,t){return null==t&&(t=o),"string"==typeof u[t][n]?u[t][n]:t!=s?r(n,s):n}var o="en",s="en",h=!0,e="static",c="",i={},f={setLocale:function(n){for(var t in u)if(t==n){o=n;return}throw Error("Invalid locale: "+n);},addLocale:function(n,t){"undefined"==typeof u[n]&&(u[n]={});for(var i in t)u[n][i]=t[i]},setIcons:function(n){i=n,("object"!=typeof i||null==i)&&(i={})},alert:function(){var n="",u=r("OK"),t=null;switch(arguments.length){case 1:n=arguments[0];break;case 2:n=arguments[0],"function"==typeof arguments[1]?t=arguments[1]:u=arguments[1];break;case 3:n=arguments[0],u=arguments[1],t=arguments[2];break;default:throw Error("Incorrect number of arguments: expected 1-3");}return f.dialog(n,{label:u,icon:i.OK,callback:t},{onEscape:t||!0})},confirm:function(){var t="",u=r("CANCEL"),e=r("CONFIRM"),n=null,o;switch(arguments.length){case 1:t=arguments[0];break;case 2:t=arguments[0],"function"==typeof arguments[1]?n=arguments[1]:u=arguments[1];break;case 3:t=arguments[0],u=arguments[1],"function"==typeof arguments[2]?n=arguments[2]:e=arguments[2];break;case 4:t=arguments[0],u=arguments[1],e=arguments[2],n=arguments[3];break;default:throw Error("Incorrect number of arguments: expected 1-4");}return o=function(){"function"==typeof n&&n(!1)},f.dialog(t,[{label:u,icon:i.CANCEL,callback:o},{label:e,icon:i.CONFIRM,callback:function(){"function"==typeof n&&n(!0)}}],{onEscape:o})},prompt:function(){var u="",s=r("CANCEL"),c=r("CONFIRM"),n=null,e="",o,h;switch(arguments.length){case 1:u=arguments[0];break;case 2:u=arguments[0],"function"==typeof arguments[1]?n=arguments[1]:s=arguments[1];break;case 3:u=arguments[0],s=arguments[1],"function"==typeof arguments[2]?n=arguments[2]:c=arguments[2];break;case 4:u=arguments[0],s=arguments[1],c=arguments[2],n=arguments[3];break;case 5:u=arguments[0],s=arguments[1],c=arguments[2],n=arguments[3],e=arguments[4];break;default:throw Error("Incorrect number of arguments: expected 1-5");}o=t("<form><\/form>"),o.append("<input autocomplete=off type=text value='"+e+"' />"),e=function(){"function"==typeof n&&n(null)},h=f.dialog(o,[{label:s,icon:i.CANCEL,callback:e},{label:c,icon:i.CONFIRM,callback:function(){"function"==typeof n&&n(o.find("input[type=text]").val())}}],{header:u,show:!1,onEscape:e});h.on("shown",function(){o.find("input[type=text]").focus();o.on("submit",function(n){n.preventDefault(),h.find(".btn-primary").click()})});return h.modal("show"),h},dialog:function(i,r,u){var s="",p=[],f,l,a,y,o;for(u=u||{},null==r?r=[]:"undefined"==typeof r.length&&(r=[r]),f=r.length;f--;){var l=null,a=null,v=null,w="",b=null;if("undefined"==typeof r[f].label&&"undefined"==typeof r[f]["class"]&&"undefined"==typeof r[f].callback){l=0,a=null;for(y in r[f])if(a=y,1<++l)break;1==l&&"function"==typeof r[f][y]&&(r[f].label=a,r[f].callback=r[f][y])}"function"==typeof r[f].callback&&(b=r[f].callback),r[f]["class"]?v=r[f]["class"]:f==r.length-1&&2>=r.length&&(v="btn-primary"),l=r[f].label?r[f].label:"Option "+(f+1),r[f].icon&&(w="<i class='"+r[f].icon+"'><\/i> "),a=r[f].href?r[f].href:"javascript:;",s="<a data-handler='"+f+"' class='btn "+v+"' href='"+a+"'>"+w+""+l+"<\/a>"+s,p[f]=b}f=["<div class='bootbox modal' tabindex='-1' style='overflow:hidden;'>"],u.header&&(v="",("undefined"==typeof u.headerCloseButton||u.headerCloseButton)&&(v="<a href='javascript:;' class='close'>&times;<\/a>"),f.push("<div class='modal-header'>"+v+"<h3>"+u.header+"<\/h3><\/div>")),f.push("<div class='modal-body'><\/div>"),s&&f.push("<div class='modal-footer'>"+s+"<\/div>"),f.push("<\/div>"),o=t(f.join("\n")),("undefined"==typeof u.animate?h:u.animate)&&o.addClass("fade"),(s="undefined"==typeof u.classes?c:u.classes)&&o.addClass(s),o.find(".modal-body").html(i);o.on("hidden",function(){o.remove()});o.on("keyup.dismiss.modal",function(n){27==n.which&&u.onEscape&&("function"==typeof u.onEscape&&u.onEscape(),o.modal("hide"))});o.on("shown",function(){o.find("a.btn-primary:first").focus()});o.on("click",".modal-footer a, a.close",function(n){var i=t(this).data("handler"),u=p[i],f=null;"undefined"!=typeof i&&"undefined"!=typeof r[i].href||(n.preventDefault(),"function"==typeof u&&(f=u()),!1!==f&&o.modal("hide"))});t("body").append(o),o.modal({backdrop:"undefined"==typeof u.backdrop?e:u.backdrop,keyboard:!1,show:!1});o.on("show",function(){t(n).off("focusin.modal")});return("undefined"==typeof u.show||!0===u.show)&&o.modal("show"),o},modal:function(){var i,r,n,u={onEscape:null,keyboard:!0,backdrop:e};switch(arguments.length){case 1:i=arguments[0];break;case 2:i=arguments[0],"object"==typeof arguments[1]?n=arguments[1]:r=arguments[1];break;case 3:i=arguments[0],r=arguments[1],n=arguments[2];break;default:throw Error("Incorrect number of arguments: expected 1-3");}return u.header=r,n="object"==typeof n?t.extend(u,n):u,f.dialog(i,[],n)},hideAll:function(){t(".bootbox").modal("hide")},animate:function(n){h=n},backdrop:function(n){e=n},classes:function(n){c=n}},u={en:{OK:"OK",CANCEL:"Cancel",CONFIRM:"OK"},fr:{OK:"OK",CANCEL:"Annuler",CONFIRM:"D'accord"},de:{OK:"OK",CANCEL:"Abbrechen",CONFIRM:"Akzeptieren"},es:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Aceptar"},br:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Sim"},nl:{OK:"OK",CANCEL:"Annuleren",CONFIRM:"Accepteren"},ru:{OK:"OK",CANCEL:"Отмена",CONFIRM:"Применить"},it:{OK:"OK",CANCEL:"Annulla",CONFIRM:"Conferma"}};return f}(document,window.jQuery),dateFormat,defaultFunction,formatting,monsterCount,tempMon,monsters,logTimer,newLogEntryWidth,logMessages,MonsterModel,Roller,currentSessionId;window.bootbox=bootbox,dateFormat=function(){var t=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,i=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,r=/[^-+\dA-Z]/g,n=function(n,t){for(n=String(n),t=t||2;n.length<t;)n="0"+n;return n};return function(u,f,e){var h=dateFormat;if(arguments.length!=1||Object.prototype.toString.call(u)!="[object String]"||/\d/.test(u)||(f=u,u=undefined),u=u?new Date(u):new Date,isNaN(u))throw SyntaxError("invalid date");f=String(h.masks[f]||f||h.masks["default"]),f.slice(0,4)=="UTC:"&&(f=f.slice(4),e=!0);var o=e?"getUTC":"get",c=u[o+"Date"](),y=u[o+"Day"](),l=u[o+"Month"](),p=u[o+"FullYear"](),s=u[o+"Hours"](),w=u[o+"Minutes"](),b=u[o+"Seconds"](),a=u[o+"Milliseconds"](),v=e?0:u.getTimezoneOffset(),k={d:c,dd:n(c),ddd:h.i18n.dayNames[y],dddd:h.i18n.dayNames[y+7],m:l+1,mm:n(l+1),mmm:h.i18n.monthNames[l],mmmm:h.i18n.monthNames[l+12],yy:String(p).slice(2),yyyy:p,h:s%12||12,hh:n(s%12||12),H:s,HH:n(s),M:w,MM:n(w),s:b,ss:n(b),l:n(a,3),L:n(a>99?Math.round(a/10):a),t:s<12?"a":"p",tt:s<12?"am":"pm",T:s<12?"A":"P",TT:s<12?"AM":"PM",Z:e?"UTC":(String(u).match(i)||[""]).pop().replace(r,""),o:(v>0?"-":"+")+n(Math.floor(Math.abs(v)/60)*100+Math.abs(v)%60,4),S:["th","st","nd","rd"][c%10>3?0:(c%100-c%10!=10)*c%10]};return f.replace(t,function(n){return n in k?k[n]:n.slice(1,n.length-1)})}}(),dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format=function(n,t){return dateFormat(this,n,t)},defaultFunction=function(){return"THIS IS AN ERROR"},formatting={madvanc:defaultFunction,malign:defaultFunction,marmor:function(n){return n.aname+(n.enchantment_bonus!="0"?" +"+n.enchantment_bonus:"")},mattack:function(n){return n.aname+"<\/td><td>"+(n.hitdc!="0"?n.hitdc:"")+"<\/td><td class='rightalign'>"+(n.dmgname!=null?"+"+n.dmgred_hd+" "+n.dmgname:"")},mdmgred:function(n){return n.name+"<\/td><td>"+(n.reduction_amount=="0"?"Immune":n.reduction_amount)},mfeat:function(n){return n.name+(n.feat_level>1?" (x"+n.feat_level+")":"")+"<\/td><td>"+(n.name=="Power Attack"||n.name=="Combat Expertise"||n.name=="Cleave"?'<input class="input-mini-inline applyNum" type="number" placeholder="#"><\/input>':"")+(checkboxName(n.name)?'<input class="inline-checkbox" type="checkbox"><\/input>':"")+"<\/td>"},mfatk:function(n){var t=[];return $.each(n,function(n,i){i.wname&&t.push(i.wname),i.atkname&&t.push(i.atkname)}),t.join(", ")},mlang:defaultFunction,mmove:function(n){return n.movement_type+"<\/td><td>"+n.movement_speed+"ft"},morgani:defaultFunction,mqualit:function(n){return n.name+"<\/td><td>"+(n.value!="0"?n.value+(n.name!="Spell Resistance"&&n.name!="Regeneration"&&n.name!="Turn Resistance"?"ft":""):"")},mskill:function(n){return n.name+(n.sub_skill!=""&&n.sub_skill!=null?" ("+n.sub_skill+")":"")+"<\/td><td>"+(parseInt(n.skill_level)<0?n.skill_level:"+"+n.skill_level)},mspatk:function(n){return n.name+"<\/td><td>"+(n.range!="0"?n.range+"ft":"")+"<\/td><td class='rightalign'>"+(checkboxName(n.name)?'<input class="inline-checkbox" type="checkbox"><\/input>':"")+(n.hit_dice!="0"?n.hit_dice:"")+" "+(n.dmgred_hd!="0"&&n.dmgred_hd!=null?"+"+n.dmgred_hd+" "+n.dmgred_nm:"")},msubcat:defaultFunction,mterr:defaultFunction,mtype:defaultFunction,mweapon:function(n){return n.extra_wsize+" "+n.wname+(n.enchantment_bonus!="0"?" +"+n.enchantment_bonus:"")+"<\/td><td>"+n.hitdc+"<\/td><td class='rightalign'>"+(n.dmgname!=null?"+"+n.dmgred_hd+" "+n.dmgname:"")}};var rollable={mfatk:function(n,t){var i=[];return $.each(n,function(n,r){var u={},f,e;r.atkhd&&(f=rollable.mattack(r,t),e=$.parseJSON(f),u=collect(u,e)),r.wname&&(r.mfa_strict=r.mfa_strict=="0"?"1":"0",f=rollable.mweapon(r,t,r.wir||r.mfa_range,r.mfa_strict),e=$.parseJSON(f),u=collect(u,e)),i.push(u)}),JSON.stringify(i)},mattack:function(n,t){var i={},r;return i.Base=n.hitdc,n.dmgname!=null&&(i[n.dmgname+" ("+n.dmgred_hd+")"]=n.dmgred_hd),r=get_bonus(parseInt($("#"+t+"_str").attr("data-base-value"))),i["STR Mod"]=Math.floor(r*parseFloat(n.max_str_mod)),JSON.stringify(i)},mskill:function(n){var t={};return t.Base="1d20",t.Bonus=n.skill_level,JSON.stringify(t)},mweapon:function(n,t,i,r){var u={},f,e;return u.Base=n.hitdc,n.dmgname!=null&&(u[n.dmgname+" ("+n.dmgred_hd+")"]=n.dmgred_hd),f=get_bonus(parseInt($("#"+t+"_str").attr("data-base-value"))),e=parseFloat(n.max_str_mod)||0,u["STR Mod"]=f,r=="1"?n.is_uses_str_mod=="1"&&n.is_one_handed=="0"&&f!=0&&(u["STR Mod"]=f*1.5):(n.wname.toLowerCase().indexOf("composite")!=-1&&(u["STR Mod"]=clamp(0,e,f)),f<0&&n.wname.toLowerCase().indexOf("crossbow")==-1&&(u["STR Mod"]=f)),n.enchantment_bonus!="0"&&(u.Enchantment=parseInt(n.enchantment_bonus)),JSON.stringify(u)},mspatk:function(n,t){var i={},r;return n.hit_dice!="0"&&(i.Base=n.hit_dice),n.dmgred_hd!="0"&&(i[n.dmgred_nm]=n.dmgred_hd),r=get_bonus(parseInt($("#"+t+"_str").attr("data-base-value")))*parseFloat(n.max_str_mod),r!=0&&(i["STR Mod"]=r),JSON.stringify(i)}},attackRolls={mfatk:function(n,t){var i=[],r=[],u,f;return $.each(n,function(n,u){var f={},e,o;u.atkhd&&(e=attackRolls.mattack(u,t),o=$.parseJSON(e),f=collect(f,o),parseFloat(u.mfa_class_mult)!=.5||hasTwoWeapons(t)||(f["Secondary Penalty"]=hasFeat(t,"Multiattack")?-2:-5),u.wlight="1",u.mfa_class_mult=="0.50"),u.wname&&(e=attackRolls.mweapon(u,t,u.mfa_range),o=$.parseJSON(e),f=collect(f,o)),r.push(u),i.push(f)}),r.length>1&&(u=!1,$.each(r,function(n,t){(t.aname!=null&&t.wlight=="1"||t.wlight=="1"&&t.mfa_class_mult=="0.50")&&(u=!0)}),f=hasTwoWeapons(t),f&&$.each(r,function(n,t){var r=0;t.mfa_class_mult=="1.00"?(r=-6,f&&(r+=2),u&&(r+=2),i[n]["Multiweapon Penalty (Primary)"]=r):(r=-10,f&&(r+=6),u&&(r+=2),i[n]["Multiweapon Penalty (Secondary)"]=r)})),JSON.stringify(i)},mattack:function(n,t){var i={},u,f,e,o,r;return i.Base="1d20",hasWeaponFocus(n,t)&&(i["Weapon Focus"]=1),u=parseInt($("#"+t+"_bab").attr("data-base-value")),u!=0&&(i.BAB=u),f=$("#"+t+"_size").attr("data-base-value"),e=sizeModifier(f),e!=0&&(i["Size ("+f+")"]=e),n.is_strictly_melee=="0"?hasFeat(t,"Weapon Finesse")?(r=get_bonus(parseInt($("#"+t+"_dex").attr("data-base-value"))),i["DEX Mod"]=r):(o=get_bonus(parseInt($("#"+t+"_str").attr("data-base-value"))),o!=0&&(i["STR Mod"]=o)):(r=get_bonus(parseInt($("#"+t+"_dex").attr("data-base-value"))),r!=0&&(i["DEX Mod"]=r)),JSON.stringify(i)},mweapon:function(n,t,i){var r={},e,o,s,f,h,u;return r.Base="1d20",hasWeaponFocus(n,t)&&(r["Weapon Focus"]=1),e=parseInt($("#"+t+"_bab").attr("data-base-value")),e!=0&&(r.BAB=e),o=$("#"+t+"_size").attr("data-base-value"),s=sizeModifier(o),s!=0&&(r["Size ("+o+")"]=s),i=="0"?(hasFeat(t,"Weapon Finesse")?(u=get_bonus(parseInt($("#"+t+"_dex").attr("data-base-value"))),r["DEX Mod"]=u):(f=get_bonus(parseInt($("#"+t+"_str").attr("data-base-value"))),f!=0&&(r["STR Mod"]=f)),n.wname.indexOf("Javelin")!=-1&&(r.Javelin=-4)):(n.wname.toLowerCase().indexOf("composite")!=-1&&(h=parseFloat(n.max_str_mod)||0,f<h&&(r["Composite Proficiency"]=-2)),u=get_bonus(parseInt($("#"+t+"_dex").attr("data-base-value"))),u!=0&&(r["DEX Mod"]=u)),n.enchantment_bonus!="0"&&(r.Enchantment=parseInt(n.enchantment_bonus)),JSON.stringify(r)},mspatk:function(n,t,i){var r={},u,f;return r.Base="1d20",i=="0"?(u=get_bonus(parseInt($("#"+t+"_str").attr("data-base-value"))),u!=0&&(r["STR Mod"]=u)):(f=get_bonus(parseInt($("#"+t+"_dex").attr("data-base-value"))),f!=0&&(r["DEX Mod"]=f)),JSON.stringify(r)}},mainStat={mattack:function(n){return n.aname},mskill:function(n){return n.name},mweapon:function(n){return n.wname},mspatk:function(n){return n.name},mfatk:function(n){return formatting.mfatk(n)}};$(function(){$("#ie").length==0&&(handleResizing(),initializeArrowToggler(),initializePopupToggler(),initializeFilterSelect(),makeSpansRemovable(),initializeAutocomplete(),setupAddButton(),setupGenButton(),$("#filters").find('option[value="Challenge Rating"]').attr("selected","selected"),$("#hasScript").show(),setupGrids(),setupRoller(),bodyBinding(),loadFilters(),sessionManagement(),changeLogEntrySize(),overlayLoadingGif())}),monsterCount=0,monsters={};var defaultPopupSize=500,extendPopupSize=1200,height=360,heightAdjust=140,resizeTimer;(function(n){n.whileAsync=function(n){var i=Math.abs(n.delay)||10,t=isNaN(n.bulk)?500:Math.abs(n.bulk),r=n.test||function(){return!0},u=n.loop||function(){},f=n.end||function(){};(function(){for(var n=!1,e=new Date;n=r();)if(u(),t===0||new Date-e>t)break;n?setTimeout(arguments.callee,i):f()})()},n.eachAsync=function(t,i){var r=0,u=t.length,f=i.loop||function(){};n.whileAsync(n.extend(i,{test:function(){return r<u},loop:function(){var n=t[r];return f.call(n,r++,n)}}))},n.fn.eachAsync=function(t){return n.eachAsync(this,t),this}})(jQuery),jQuery(function(n,t){function u(){var t=n("script:first"),i=t.css("color"),r=!1;if(/^rgba/.test(i))r=!0;else try{r=i!=t.css("color","rgba(0, 0, 0, 0.5)").css("color"),t.css("color",i)}catch(u){}return r}function f(t,i,r){var u=[],f;return t.b&&u.push("inset"),typeof i.left!="undefined"&&u.push(parseInt(t.left+r*(i.left-t.left),10)+"px "+parseInt(t.top+r*(i.top-t.top),10)+"px"),typeof i.blur!="undefined"&&u.push(parseInt(t.blur+r*(i.blur-t.blur),10)+"px"),typeof i.a!="undefined"&&u.push(parseInt(t.a+r*(i.a-t.a),10)+"px"),typeof i.color!="undefined"&&(f="rgb"+(n.support.rgba?"a":"")+"("+parseInt(t.color[0]+r*(i.color[0]-t.color[0]),10)+","+parseInt(t.color[1]+r*(i.color[1]-t.color[1]),10)+","+parseInt(t.color[2]+r*(i.color[2]-t.color[2]),10),n.support.rgba&&(f+=","+parseFloat(t.color[3]+r*(i.color[3]-t.color[3]))),f+=")",u.push(f)),u.join(" ")}function r(n){var t,i,r={};return(t=/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})/.exec(n))?i=[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),1]:(t=/#([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])/.exec(n))?i=[parseInt(t[1],16)*17,parseInt(t[2],16)*17,parseInt(t[3],16)*17,1]:(t=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(n))?i=[parseInt(t[1],10),parseInt(t[2],10),parseInt(t[3],10),1]:(t=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9\.]*)\s*\)/.exec(n))&&(i=[parseInt(t[1],10),parseInt(t[2],10),parseInt(t[3],10),parseFloat(t[4])]),r=(t=/(-?[0-9]+)(?:px)?\s+(-?[0-9]+)(?:px)?(?:\s+(-?[0-9]+)(?:px)?)?(?:\s+(-?[0-9]+)(?:px)?)?/.exec(n))?{left:parseInt(t[1],10),top:parseInt(t[2],10),blur:t[3]?parseInt(t[3],10):0,a:t[4]?parseInt(t[4],10):0}:{left:0,top:0,blur:0,a:0},r.b=/inset/.test(n),r.color=i,r}n.extend(!0,n,{support:{rgba:u()}});var e=n("html").prop("style"),i;n.each(["boxShadow","MozBoxShadow","WebkitBoxShadow"],function(n,t){if(typeof e[t]!="undefined")return i=t,!1}),i&&(n.Tween.propHooks.boxShadow={get:function(t){return n(t.elem).css(i)},set:function(u){var s=u.elem.style,e=r(n(u.elem).get(0).style[i]||n(u.elem).css(i)),o=n.extend({},e,r(u.end));e.color==t&&(e.color=o.color||[0,0,0]),u.run=function(n){s[i]=f(e,o,n)}}})}),function(n){typeof define=="function"&&define.amd&&define.amd.jQuery?define(["jquery"],n):n(jQuery)}(function(n){function u(n){return n}function f(n){return decodeURIComponent(n.replace(r," "))}function i(n){n.indexOf('"')===0&&(n=n.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return t.json?JSON.parse(n):n}catch(i){}}var r=/\+/g,t=n.cookie=function(r,e,o){var l,h,s,y;if(e!==undefined)return o=n.extend({},t.defaults,o),typeof o.expires=="number"&&(l=o.expires,h=o.expires=new Date,h.setDate(h.getDate()+l)),e=t.json?JSON.stringify(e):String(e),document.cookie=[encodeURIComponent(r),"=",t.raw?e:encodeURIComponent(e),o.expires?"; expires="+o.expires.toUTCString():"",o.path?"; path="+o.path:"",o.domain?"; domain="+o.domain:"",o.secure?"; secure":""].join("");var a=t.raw?u:f,v=document.cookie.split("; "),c=r?undefined:{};for(s=0,y=v.length;s<y;s++){var p=v[s].split("="),w=a(p.shift()),b=a(p.join("="));if(r&&r===w){c=i(b);break}r||(c[w]=i(b))}return c};t.defaults={},n.removeCookie=function(t,i){return n.cookie(t)!==undefined?(n.cookie(t,"",n.extend(i,{expires:-1})),!0):!1}}),function(n){n.extend(n.fn,{livequery:function(t,i,r){var f=this,u;return n.isFunction(t)&&(r=i,i=t,t=undefined),n.each(n.livequery.queries,function(n,e){if(f.selector==e.selector&&f.context==e.context&&t==e.type&&(!i||i.$lqguid==e.fn.$lqguid)&&(!r||r.$lqguid==e.fn2.$lqguid))return(u=e)&&!1}),u=u||new n.livequery(this.selector,this.context,t,i,r),u.stopped=!1,u.run(),this},expire:function(t,i,r){var u=this;return n.isFunction(t)&&(r=i,i=t,t=undefined),n.each(n.livequery.queries,function(f,e){u.selector!=e.selector||u.context!=e.context||t&&t!=e.type||i&&i.$lqguid!=e.fn.$lqguid||r&&r.$lqguid!=e.fn2.$lqguid||this.stopped||n.livequery.stop(e.id)}),this}}),n.livequery=function(t,i,r,u,f){return this.selector=t,this.context=i,this.type=r,this.fn=u,this.fn2=f,this.elements=[],this.stopped=!1,this.id=n.livequery.queries.push(this)-1,u.$lqguid=u.$lqguid||n.livequery.guid++,f&&(f.$lqguid=f.$lqguid||n.livequery.guid++),this},n.livequery.prototype={stop:function(){var n=this;this.type?this.elements.unbind(this.type,this.fn):this.fn2&&this.elements.each(function(t,i){n.fn2.apply(i)}),this.elements=[],this.stopped=!0},run:function(){if(!this.stopped){var i=this,t=this.elements,r=n(this.selector,this.context),u=r.not(t);this.elements=r,this.type?(u.bind(this.type,this.fn),t.length>0&&n.each(t,function(t,u){n.inArray(u,r)<0&&n.event.remove(u,i.type,i.fn)})):(u.each(function(){i.fn.apply(this)}),this.fn2&&t.length>0&&n.each(t,function(t,u){n.inArray(u,r)<0&&i.fn2.apply(u)}))}}},n.extend(n.livequery,{guid:0,queries:[],queue:[],running:!1,timeout:null,checkQueue:function(){if(n.livequery.running&&n.livequery.queue.length)for(var t=n.livequery.queue.length;t--;)n.livequery.queries[n.livequery.queue.shift()].run()},pause:function(){n.livequery.running=!1},play:function(){n.livequery.running=!0,n.livequery.run()},registerPlugin:function(){n.each(arguments,function(t,i){if(n.fn[i]){var r=n.fn[i];n.fn[i]=function(){var t=r.apply(this,arguments);return n.livequery.run(),t}}})},run:function(t){t!=undefined?n.inArray(t,n.livequery.queue)<0&&n.livequery.queue.push(t):n.each(n.livequery.queries,function(t){n.inArray(t,n.livequery.queue)<0&&n.livequery.queue.push(t)}),n.livequery.timeout&&clearTimeout(n.livequery.timeout),n.livequery.timeout=setTimeout(n.livequery.checkQueue,20)},stop:function(t){t!=undefined?n.livequery.queries[t].stop():n.each(n.livequery.queries,function(t){n.livequery.queries[t].stop()})}}),n.livequery.registerPlugin("append","prepend","after","before","wrap","attr","removeAttr","addClass","removeClass","toggleClass","empty","remove","html"),n(function(){n.livequery.play()})}(jQuery),function(n){var f=!1,o=!1,c=5e3,l=2e3,v=function(){var n=document.getElementsByTagName("script"),n=n[n.length-1].src.split("?")[0];return n.split("/").length>0?n.split("/").slice(0,-1).join("/")+"/":""}(),t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||!1,i=window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||!1,s=!1,y=function(){var r,n,i,t;if(s)return s;for(r=document.createElement("DIV"),n={haspointerlock:"pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document},n.isopera=("opera"in window),n.isopera12=n.isopera&&("getUserMedia"in navigator),n.isie=("all"in document)&&("attachEvent"in r)&&!n.isopera,n.isieold=n.isie&&!("msInterpolationMode"in r.style),n.isie7=n.isie&&!n.isieold&&(!("documentMode"in document)||document.documentMode==7),n.isie8=n.isie&&("documentMode"in document)&&document.documentMode==8,n.isie9=n.isie&&("performance"in window)&&document.documentMode>=9,n.isie10=n.isie&&("performance"in window)&&document.documentMode>=10,n.isie9mobile=/iemobile.9/i.test(navigator.userAgent),n.isie9mobile&&(n.isie9=!1),n.isie7mobile=!n.isie9mobile&&n.isie7&&/iemobile/i.test(navigator.userAgent),n.ismozilla=("MozAppearance"in r.style),n.iswebkit=("WebkitAppearance"in r.style),n.ischrome=("chrome"in window),n.ischrome22=n.ischrome&&n.haspointerlock,n.cantouch=("ontouchstart"in document.documentElement),n.hasmstouch=window.navigator.msPointerEnabled||!1,n.ismac=/^mac$/i.test(navigator.platform),n.isios=n.cantouch&&/iphone|ipad|ipod/i.test(navigator.platform),n.isios4=n.isios&&!("seal"in Object),n.isandroid=/android/i.test(navigator.userAgent),n.trstyle=!1,n.hastransform=!1,n.hastranslate3d=!1,n.transitionstyle=!1,n.hastransition=!1,n.transitionend=!1,i=["transform","msTransform","webkitTransform","MozTransform","OTransform"],t=0;t<i.length;t++)if(typeof r.style[i[t]]!="undefined"){n.trstyle=i[t];break}n.hastransform=n.trstyle!=!1,n.hastransform&&(r.style[n.trstyle]="translate3d(1px,2px,3px)",n.hastranslate3d=/translate3d/.test(r.style[n.trstyle])),n.transitionstyle=!1,n.prefixstyle="",n.transitionend=!1;for(var i="transition,webkitTransition,MozTransition,OTransition,OTransition,msTransition,KhtmlTransition".split(","),u=",-webkit-,-moz-,-o-,-o,-ms-,-khtml-".split(","),f="transitionend,webkitTransitionEnd,transitionend,otransitionend,oTransitionEnd,msTransitionEnd,KhtmlTransitionEnd".split(","),t=0;t<i.length;t++)if(i[t]in r.style){n.transitionstyle=i[t],n.prefixstyle=u[t],n.transitionend=f[t];break}n.hastransition=n.transitionstyle;n:{for(i=["-moz-grab","-webkit-grab","grab"],(n.ischrome&&!n.ischrome22||n.isie)&&(i=[]),t=0;t<i.length;t++)if(u=i[t],r.style.cursor=u,r.style.cursor==u){i=u;break n}i="url(http://www.google.com/intl/en_ALL/mapfiles/openhand.cur),n-resize"}return n.cursorgrabvalue=i,n.hasmousecapture="setCapture"in r,s=n},p=function(r,u){function a(n,t,i){return t=n.css(t),n=parseFloat(t),isNaN(n)?(n=k[t]||0,i=n==3?i?e.win.outerHeight()-e.win.innerHeight():e.win.outerWidth()-e.win.innerWidth():1,e.isie8&&n&&(n+=1),i?n:0):n}function b(n,t){var i=0,r=0,u;"wheelDeltaY"in n?(i=Math.floor(n.wheelDeltaX/2),r=Math.floor(n.wheelDeltaY/2)):(u=n.detail?n.detail*-1:n.wheelDelta/40,u&&(t?i=Math.floor(u*e.opt.mousescrollstep):r=Math.floor(u*e.opt.mousescrollstep))),i&&(e.scrollmom&&e.scrollmom.stop(),e.lastdeltax+=i,e.synched("mousewheelx",function(){var n=e.lastdeltax;e.lastdeltax=0,e.rail.drag||e.doScrollLeftBy(n)})),r&&(e.scrollmom&&e.scrollmom.stop(),e.lastdeltay+=r,e.synched("mousewheely",function(){var n=e.lastdeltay;e.lastdeltay=0,e.rail.drag||e.doScrollBy(n)}))}var e=this,p,s,w,k;if(this.version="3.0.0",this.name="nicescroll",this.me=u,this.opt={doc:n("body"),win:!1,zindex:9e3,cursoropacitymin:0,cursoropacitymax:1,cursorcolor:"#424242",cursorwidth:"5px",cursorborder:"1px solid #fff",cursorborderradius:"5px",scrollspeed:60,mousescrollstep:24,touchbehavior:!1,hwacceleration:!0,usetransition:!0,boxzoom:!1,dblclickzoom:!0,gesturezoom:!0,grabcursorenabled:!0,autohidemode:!0,background:"",iframeautoresize:!0,cursorminheight:32,preservenativescrolling:!0,railoffset:!1,bouncescroll:!0,spacebarenabled:!0,railpadding:{top:0,right:0,left:0,bottom:0},disableoutline:!0,horizrailenabled:!0,railalign:"right",railvalign:"bottom",enabletranslate3d:!0,enablemousewheel:!0,enablekeyboard:!0,smoothscroll:!0,sensitiverail:!0},this.opt.snapbackspeed=80,r)for(p in e.opt)typeof r[p]!="undefined"&&(e.opt[p]=r[p]);this.iddoc=(this.doc=e.opt.doc)&&this.doc[0]?this.doc[0].id||"":"",this.ispage=/BODY|HTML/.test(e.opt.win?e.opt.win[0].nodeName:this.doc[0].nodeName),this.haswrapper=e.opt.win!==!1,this.win=e.opt.win||(this.ispage?n(window):this.doc),this.docscroll=this.ispage&&!this.haswrapper?n(window):this.win,this.body=n("body"),this.iframe=this.isfixed=!1,this.isiframe=this.doc[0].nodeName=="IFRAME"&&this.win[0].nodeName=="IFRAME",this.istextarea=this.win[0].nodeName=="TEXTAREA",this.forcescreen=!1,this.canshowonmouseevent=e.opt.autohidemode!="scroll",this.page=this.view=this.onzoomout=this.onzoomin=this.onscrollcancel=this.onscrollend=this.onscrollstart=this.onclick=this.ongesturezoom=this.onkeypress=this.onmousewheel=this.onmousemove=this.onmouseup=this.onmousedown=!1,this.scroll={x:0,y:0},this.scrollratio={x:0,y:0},this.cursorheight=20,this.scrollvaluemax=0,this.observer=this.scrollmom=this.scrollrunning=!1;do this.id="ascrail"+l++;while(document.getElementById(this.id));this.hasmousefocus=this.hasfocus=this.zoomactive=this.zoom=this.cursorfreezed=this.cursor=this.rail=!1,this.visibility=!0,this.hidden=this.locked=!1,this.cursoractive=!0,this.nativescrollingarea=!1,this.events=[],this.saved={},this.delaylist={},this.synclist={},this.lastdeltay=this.lastdeltax=0,s=this.detected=y(),this.ishwscroll=(this.canhwscroll=s.hastransform&&e.opt.hwacceleration)&&e.haswrapper,this.istouchcapable=!1,s.cantouch&&s.ischrome&&!s.isios&&!s.isandroid&&(this.istouchcapable=!0,s.cantouch=!1),s.cantouch&&s.ismozilla&&!s.isios&&(this.istouchcapable=!0,s.cantouch=!1),this.delayed=function(n,t,i,r){var u=e.delaylist[n],f=(new Date).getTime();if(!r&&u&&u.tt)return!1;u&&u.tt&&clearTimeout(u.tt),u&&u.last+i>f&&!u.tt?e.delaylist[n]={last:f+i,tt:setTimeout(function(){e.delaylist[n].tt=0,t.call()},i)}:u&&u.tt||(e.delaylist[n]={last:f,tt:0},setTimeout(function(){t.call()},0))},this.synched=function(n,i){return e.synclist[n]=i,function(){e.onsync||(t(function(){e.onsync=!1;for(n in e.synclist){var t=e.synclist[n];t&&t.call(e),e.synclist[n]=!1}}),e.onsync=!0)}(),n},this.unsynched=function(n){e.synclist[n]&&(e.synclist[n]=!1)},this.css=function(n,t){for(var i in t)e.saved.css.push([n,i,n.css(i)]),n.css(i,t[i])},this.scrollTop=function(n){return typeof n=="undefined"?e.getScrollTop():e.setScrollTop(n)},this.scrollLeft=function(n){return typeof n=="undefined"?e.getScrollLeft():e.setScrollLeft(n)},BezierClass=function(n,t,i,r,u,f,e){this.st=n,this.ed=t,this.spd=i,this.p1=r||0,this.p2=u||1,this.p3=f||0,this.p4=e||1,this.ts=(new Date).getTime(),this.df=this.ed-this.st},BezierClass.prototype={B2:function(n){return 3*n*n*(1-n)},B3:function(n){return 3*n*(1-n)*(1-n)},B4:function(n){return(1-n)*(1-n)*(1-n)},getNow:function(){var n=1-((new Date).getTime()-this.ts)/this.spd,t=this.B2(n)+this.B3(n)+this.B4(n);return n<0?this.ed:this.st+Math.round(this.df*t)},update:function(n,t){return this.st=this.getNow(),this.ed=n,this.spd=t,this.ts=(new Date).getTime(),this.df=this.ed-this.st,this}},this.ishwscroll?(this.doc.translate={x:0,y:0,tx:"0px",ty:"0px"},s.hastranslate3d&&s.isios&&this.doc.css("-webkit-backface-visibility","hidden"),w=function(){var n=e.doc.css(s.trstyle);return n&&n.substr(0,6)=="matrix"?n.replace(/^.*\((.*)\)$/g,"$1").replace(/px/g,"").split(/, +/):!1},this.getScrollTop=function(n){if(!n){if(n=w())return n.length==16?-n[13]:-n[5];if(e.timerscroll&&e.timerscroll.bz)return e.timerscroll.bz.getNow()}return e.doc.translate.y},this.getScrollLeft=function(n){if(!n){if(n=w())return n.length==16?-n[12]:-n[4];if(e.timerscroll&&e.timerscroll.bh)return e.timerscroll.bh.getNow()}return e.doc.translate.x},this.notifyScrollEvent=document.createEvent?function(n){var t=document.createEvent("UIEvents");t.initUIEvent("scroll",!1,!0,window,1),n.dispatchEvent(t)}:document.fireEvent?function(n){var t=document.createEventObject();n.fireEvent("onscroll"),t.cancelBubble=!0}:function(){},s.hastranslate3d&&e.opt.enabletranslate3d?(this.setScrollTop=function(n,t){e.doc.translate.y=n,e.doc.translate.ty=n*-1+"px",e.doc.css(s.trstyle,"translate3d("+e.doc.translate.tx+","+e.doc.translate.ty+",0px)"),t||e.notifyScrollEvent(e.win[0])},this.setScrollLeft=function(n,t){e.doc.translate.x=n,e.doc.translate.tx=n*-1+"px",e.doc.css(s.trstyle,"translate3d("+e.doc.translate.tx+","+e.doc.translate.ty+",0px)"),t||e.notifyScrollEvent(e.win[0])}):(this.setScrollTop=function(n,t){e.doc.translate.y=n,e.doc.translate.ty=n*-1+"px",e.doc.css(s.trstyle,"translate("+e.doc.translate.tx+","+e.doc.translate.ty+")"),t||e.notifyScrollEvent(e.win[0])},this.setScrollLeft=function(n,t){e.doc.translate.x=n,e.doc.translate.tx=n*-1+"px",e.doc.css(s.trstyle,"translate("+e.doc.translate.tx+","+e.doc.translate.ty+")"),t||e.notifyScrollEvent(e.win[0])})):(this.getScrollTop=function(){return e.docscroll.scrollTop()},this.setScrollTop=function(n){return e.docscroll.scrollTop(n)},this.getScrollLeft=function(){return e.docscroll.scrollLeft()},this.setScrollLeft=function(n){return e.docscroll.scrollLeft(n)}),this.getTarget=function(n){return n?n.target?n.target:n.srcElement?n.srcElement:!1:!1},this.hasParent=function(n,t){if(!n)return!1;for(var i=n.target||n.srcElement||n||!1;i&&i.id!=t;)i=i.parentNode||!1;return i!==!1},k={thin:1,medium:3,thick:5},this.updateScrollBar=function(n){var r;if(e.ishwscroll)e.rail.css({height:e.win.innerHeight()}),e.railh&&e.railh.css({width:e.win.innerWidth()});else{var u=e.isfixed?{top:parseFloat(e.win.css("top")),left:parseFloat(e.win.css("left"))}:e.win.offset(),i=u.top,t=u.left;i+=a(e.win,"border-top-width",!0),e.win.outerWidth(),e.win.innerWidth(),t+=e.rail.align?e.win.outerWidth()-a(e.win,"border-right-width")-e.rail.width:a(e.win,"border-left-width"),r=e.opt.railoffset,r&&(r.top&&(i+=r.top),e.rail.align&&r.left&&(t+=r.left)),e.locked||e.rail.css({top:i,left:t,height:n?n.h:e.win.innerHeight()}),e.zoom&&e.zoom.css({top:i+1,left:e.rail.align==1?t-20:t+e.rail.width+4}),e.railh&&!e.locked&&(i=u.top,t=u.left,n=e.railh.align?i+a(e.win,"border-top-width",!0)+e.win.innerHeight()-e.railh.height:i+a(e.win,"border-top-width",!0),t+=a(e.win,"border-left-width"),e.railh.css({top:n,left:t,width:e.railh.width}))}},this.doRailClick=function(n,t,i){var r;e.rail.drag&&e.rail.drag.pt!=1||e.locked||e.rail.drag||(e.cancelScroll(),e.cancelEvent(n),t?(t=i?e.doScrollLeft:e.doScrollTop,r=i?(n.pageX-e.railh.offset().left-e.cursorwidth/2)*e.scrollratio.x:(n.pageY-e.rail.offset().top-e.cursorheight/2)*e.scrollratio.y,t(r)):(t=i?e.doScrollLeftBy:e.doScrollBy,r=i?e.scroll.x:e.scroll.y,n=i?n.pageX-e.railh.offset().left:n.pageY-e.rail.offset().top,i=i?e.view.w:e.view.h,r>=n?t(i):t(-i)))},e.hasanimationframe=t,e.hascancelanimationframe=i,e.hasanimationframe?e.hascancelanimationframe||(i=function(){e.cancelAnimationFrame=!0}):(t=function(n){return setTimeout(n,16)},i=clearInterval),this.init=function(){var u,r,p,l,a,w,i,b,k,t,y;if(e.saved.css=[],s.isie7mobile)return!0;if(s.hasmstouch&&e.css(e.ispage?n("html"):e.win,{"-ms-touch-action":"none"}),!e.ispage||!s.cantouch&&!s.isieold&&!s.isie9mobile){u=e.docscroll,e.ispage&&(u=e.haswrapper?e.win:e.doc),s.isie9mobile||e.css(u,{"overflow-y":"hidden"}),e.ispage&&s.isie7&&(e.doc[0].nodeName=="BODY"?e.css(n("html"),{"overflow-y":"hidden"}):e.doc[0].nodeName=="HTML"&&e.css(n("body"),{"overflow-y":"hidden"})),!s.isios||e.ispage||e.haswrapper||e.css(n("body"),{"-webkit-overflow-scrolling":"touch"}),r=n(document.createElement("div")),r.css({position:"relative",top:0,float:"right",width:e.opt.cursorwidth,height:"0px","background-color":e.opt.cursorcolor,border:e.opt.cursorborder,"background-clip":"padding-box","-webkit-border-radius":e.opt.cursorborderradius,"-moz-border-radius":e.opt.cursorborderradius,"border-radius":e.opt.cursorborderradius}),r.hborder=parseFloat(r.outerHeight()-r.innerHeight()),e.cursor=r,t=n(document.createElement("div")),t.attr("id",e.id),a=["left","right"];for(w in a)l=a[w],(p=e.opt.railpadding[l])?t.css("padding-"+l,p+"px"):e.opt.railpadding[l]=0;t.append(r),t.width=Math.max(parseFloat(e.opt.cursorwidth),r.outerWidth())+e.opt.railpadding.left+e.opt.railpadding.right,t.css({width:t.width+"px",zIndex:e.ispage?e.opt.zindex:e.opt.zindex+2,background:e.opt.background}),t.visibility=!0,t.scrollable=!0,t.align=e.opt.railalign=="left"?0:1,e.rail=t,r=e.rail.drag=!1,e.opt.boxzoom&&!e.ispage&&!s.isieold&&(r=document.createElement("div"),e.bind(r,"click",e.doZoom),e.zoom=n(r),e.zoom.css({cursor:"pointer","z-index":e.opt.zindex,backgroundImage:"url("+v+"zoomico.png)",height:18,width:18,backgroundPosition:"0px 0px"}),e.opt.dblclickzoom&&e.bind(e.win,"dblclick",e.doZoom),s.cantouch&&e.opt.gesturezoom)&&(e.ongesturezoom=function(n){return n.scale>1.5&&e.doZoomIn(n),n.scale<.8&&e.doZoomOut(n),e.cancelEvent(n)},e.bind(e.win,"gestureend",e.ongesturezoom)),e.railh=!1,e.opt.horizrailenabled&&(e.css(u,{"overflow-x":"hidden"}),r=n(document.createElement("div")),r.css({position:"relative",top:0,height:e.opt.cursorwidth,width:"0px","background-color":e.opt.cursorcolor,border:e.opt.cursorborder,"background-clip":"padding-box","-webkit-border-radius":e.opt.cursorborderradius,"-moz-border-radius":e.opt.cursorborderradius,"border-radius":e.opt.cursorborderradius}),r.wborder=parseFloat(r.outerWidth()-r.innerWidth()),e.cursorh=r,i=n(document.createElement("div")),i.attr("id",e.id+"-hr"),i.height=1+Math.max(parseFloat(e.opt.cursorwidth),r.outerHeight()),i.css({height:i.height+"px",zIndex:e.ispage?e.opt.zindex:e.opt.zindex+2,background:e.opt.background}),i.append(r),i.visibility=!0,i.scrollable=!0,i.align=e.opt.railvalign=="top"?0:1,e.railh=i,e.railh.drag=!1),e.ispage?(t.css({position:"fixed",top:"0px",height:"100%"}),t.align?t.css({right:"0px"}):t.css({left:"0px"}),e.body.append(t),e.railh&&(i.css({position:"fixed",left:"0px",width:"100%"}),i.align?i.css({bottom:"0px"}):i.css({top:"0px"}),e.body.append(i))):(e.ishwscroll?(e.win.css("position")=="static"&&e.css(e.win,{position:"relative"}),u=e.win[0].nodeName=="HTML"?e.body:e.win,e.zoom&&(e.zoom.css({position:"absolute",top:1,right:0,"margin-right":t.width+4}),u.append(e.zoom)),t.css({position:"absolute",top:0}),t.align?t.css({right:0}):t.css({left:0}),u.append(t),i&&(i.css({position:"absolute",left:0,bottom:0}),i.align?i.css({bottom:0}):i.css({top:0}),u.append(i))):(e.isfixed=e.win.css("position")=="fixed",u=e.isfixed?"fixed":"absolute",t.css({position:u}),e.zoom&&e.zoom.css({position:u}),e.updateScrollBar(),e.body.append(t),e.zoom&&e.body.append(e.zoom),e.railh&&(i.css({position:u}),e.body.append(i))),s.isios&&e.css(e.win,{"-webkit-tap-highlight-color":"rgba(0,0,0,0)","-webkit-touch-callout":"none"}),s.isie&&e.opt.disableoutline&&e.win.attr("hideFocus","true"),s.iswebkit&&e.opt.disableoutline&&e.win.css({outline:"none"})),e.opt.autohidemode===!1?e.autohidedom=!1:e.opt.autohidemode===!0?(e.autohidedom=n().add(e.rail),e.railh)&&(e.autohidedom=e.autohidedom.add(e.railh)):e.opt.autohidemode=="scroll"?(e.autohidedom=n().add(e.rail),e.railh)&&(e.autohidedom=e.autohidedom.add(e.railh)):e.opt.autohidemode=="cursor"?(e.autohidedom=n().add(e.cursor),e.railh)&&(e.autohidedom=e.autohidedom.add(e.railh.cursor)):e.opt.autohidemode=="hidden"&&(e.autohidedom=!1,e.hide(),e.locked=!1),s.isie9mobile?(e.scrollmom=new h(e),e.onmangotouch=function(){var n=e.getScrollTop(),t=e.getScrollLeft(),i,r;if(n==e.scrollmom.lastscrolly&&t==e.scrollmom.lastscrollx)return!0;if(i=n-e.mangotouch.sy,r=t-e.mangotouch.sx,Math.round(Math.sqrt(Math.pow(r,2)+Math.pow(i,2)))!=0){var f=i<0?-1:1,o=r<0?-1:1,u=+new Date;e.mangotouch.lazy&&clearTimeout(e.mangotouch.lazy),u-e.mangotouch.tm>80||e.mangotouch.dry!=f||e.mangotouch.drx!=o?(e.scrollmom.stop(),e.scrollmom.reset(t,n),e.mangotouch.sy=n,e.mangotouch.ly=n,e.mangotouch.sx=t,e.mangotouch.lx=t,e.mangotouch.dry=f,e.mangotouch.drx=o,e.mangotouch.tm=u):(e.scrollmom.stop(),e.scrollmom.update(e.mangotouch.sx-r,e.mangotouch.sy-i),e.mangotouch.tm=u,i=Math.max(Math.abs(e.mangotouch.ly-n),Math.abs(e.mangotouch.lx-t)),e.mangotouch.ly=n,e.mangotouch.lx=t,i>2)&&(e.mangotouch.lazy=setTimeout(function(){e.mangotouch.lazy=!1,e.mangotouch.dry=0,e.mangotouch.drx=0,e.mangotouch.tm=0,e.scrollmom.doMomentum(30)},100))}},t=e.getScrollTop(),i=e.getScrollLeft(),e.mangotouch={sy:t,ly:t,dry:0,sx:i,lx:i,drx:0,lazy:!1,tm:0},e.bind(e.docscroll,"scroll",e.onmangotouch)):((s.cantouch||e.istouchcapable||e.opt.touchbehavior||s.hasmstouch)&&(e.scrollmom=new h(e),e.ontouchstart=function(t){var i,r;if(t.pointerType&&t.pointerType!=2)return!1;if(!e.locked){if(s.hasmstouch)for(i=t.target?t.target:!1;i;){if(r=n(i).getNiceScroll(),r.length>0&&r[0].me==e.me)break;if(r.length>0)return!1;if(i.nodeName=="DIV"&&i.id==e.id)break;i=i.parentNode?i.parentNode:!1}if(e.cancelScroll(),(i=e.getTarget(t))&&/INPUT/i.test(i.nodeName)&&/range/i.test(i.type))return e.stopPropagation(t);if(e.forcescreen&&(r=t,t={original:t.original?t.original:t},t.clientX=r.screenX,t.clientY=r.screenY),e.rail.drag={x:t.clientX,y:t.clientY,sx:e.scroll.x,sy:e.scroll.y,st:e.getScrollTop(),sl:e.getScrollLeft(),pt:2},e.opt.touchbehavior&&e.isiframe&&s.isie&&(r=e.win.position(),e.rail.drag.x+=r.left,e.rail.drag.y+=r.top),e.hasmoving=!1,e.lastmouseup=!1,e.scrollmom.reset(t.clientX,t.clientY),!s.cantouch&&!this.istouchcapable&&!s.hasmstouch){if(!i||!/INPUT|SELECT|TEXTAREA/i.test(i.nodeName))return!e.ispage&&s.hasmousecapture&&i.setCapture(),e.cancelEvent(t);/SUBMIT|CANCEL|BUTTON/i.test(n(i).attr("type"))&&(pc={tg:i,click:!1},e.preventclick=pc)}}},e.ontouchend=function(n){return n.pointerType&&n.pointerType!=2?!1:e.rail.drag&&e.rail.drag.pt==2&&(e.scrollmom.doMomentum(),e.rail.drag=!1,e.hasmoving&&(e.hasmoving=!1,e.lastmouseup=!0,e.hideCursor(),s.hasmousecapture&&document.releaseCapture(),!s.cantouch))?e.cancelEvent(n):void 0},b=e.opt.touchbehavior&&e.isiframe&&!s.hasmousecapture,e.ontouchmove=function(n,t){var n,h,u,f,i,o,r;return n.pointerType&&n.pointerType!=2?!1:e.rail.drag&&e.rail.drag.pt==2?s.cantouch&&typeof n.original=="undefined"?!0:(e.hasmoving=!0,e.preventclick&&!e.preventclick.click&&(e.preventclick.click=e.preventclick.tg.onclick||!1,e.preventclick.tg.onclick=e.onpreventclick),e.forcescreen&&(u=n,n={original:n.original?n.original:n},n.clientX=u.screenX,n.clientY=u.screenY),u=ofy=0,b&&!t&&(h=e.win.position(),u=-h.left,ofy=-h.top),f=n.clientY+ofy,i=e.rail.drag.st-(f-e.rail.drag.y),e.ishwscroll&&e.opt.bouncescroll?i<0?i=Math.round(i/2):i>e.page.maxh&&(i=e.page.maxh+Math.round((i-e.page.maxh)/2)):(i<0&&(f=i=0),i>e.page.maxh)&&(i=e.page.maxh,f=0),o=n.clientX+u,e.railh&&e.railh.scrollable&&(r=e.rail.drag.sl-(o-e.rail.drag.x),e.ishwscroll&&e.opt.bouncescroll?r<0?r=Math.round(r/2):r>e.page.maxw&&(r=e.page.maxw+Math.round((r-e.page.maxw)/2)):(r<0&&(o=r=0),r>e.page.maxw)&&(r=e.page.maxw,o=0)),e.synched("touchmove",function(){e.rail.drag&&e.rail.drag.pt==2&&(e.prepareTransition&&e.prepareTransition(0),e.rail.scrollable&&e.setScrollTop(i),e.scrollmom.update(o,f),e.railh&&e.railh.scrollable?(e.setScrollLeft(r),e.showCursor(i,r)):e.showCursor(i),s.isie10&&document.selection.clear())}),e.cancelEvent(n)):void 0}),s.cantouch||e.opt.touchbehavior?(e.onpreventclick=function(n){if(e.preventclick)return e.preventclick.tg.onclick=e.preventclick.click,e.preventclick=!1,e.cancelEvent(n)},e.onmousedown=e.ontouchstart,e.onmouseup=e.ontouchend,e.onclick=s.isios?!1:function(n){return e.lastmouseup?(e.lastmouseup=!1,e.cancelEvent(n)):!0},e.onmousemove=e.ontouchmove,s.cursorgrabvalue&&(e.css(e.ispage?e.doc:e.win,{cursor:s.cursorgrabvalue}),e.css(e.rail,{cursor:s.cursorgrabvalue}))):(e.onmousedown=function(n,t){if(!(e.rail.drag&&e.rail.drag.pt!=1)){if(e.locked)return e.cancelEvent(n);e.cancelScroll(),e.rail.drag={x:n.clientX,y:n.clientY,sx:e.scroll.x,sy:e.scroll.y,pt:1,hr:!!t};var i=e.getTarget(n);return!e.ispage&&s.hasmousecapture&&i.setCapture(),e.isiframe&&!s.hasmousecapture&&(e.saved.csspointerevents=e.doc.css("pointer-events"),e.css(e.doc,{"pointer-events":"none"})),e.cancelEvent(n)}},e.onmouseup=function(n){if(e.rail.drag&&(s.hasmousecapture&&document.releaseCapture(),e.isiframe&&!s.hasmousecapture&&e.doc.css("pointer-events",e.saved.csspointerevents),e.rail.drag.pt==1))return e.rail.drag=!1,e.cancelEvent(n)},e.onmousemove=function(n){if(e.rail.drag){if(e.rail.drag.pt==1){if(s.ischrome&&n.which==0)return e.onmouseup(n);if(e.cursorfreezed=!0,e.rail.drag.hr){e.scroll.x=e.rail.drag.sx+(n.clientX-e.rail.drag.x),e.scroll.x<0&&(e.scroll.x=0);var t=e.scrollvaluemaxw;e.scroll.x>t&&(e.scroll.x=t)}else e.scroll.y=e.rail.drag.sy+(n.clientY-e.rail.drag.y),e.scroll.y<0&&(e.scroll.y=0),t=e.scrollvaluemax,e.scroll.y>t&&(e.scroll.y=t);return e.synched("mousemove",function(){e.rail.drag&&e.rail.drag.pt==1&&(e.showCursor(),e.rail.drag.hr?e.doScrollLeft(Math.round(e.scroll.x*e.scrollratio.x)):e.doScrollTop(Math.round(e.scroll.y*e.scrollratio.y)))}),e.cancelEvent(n)}}else e.checkarea=!0}),(s.cantouch||e.opt.touchbehavior)&&e.bind(e.win,"mousedown",e.onmousedown),s.hasmstouch&&(e.css(e.rail,{"-ms-touch-action":"none"}),e.css(e.cursor,{"-ms-touch-action":"none"}),e.bind(e.win,"MSPointerDown",e.ontouchstart),e.bind(document,"MSPointerUp",e.ontouchend),e.bind(document,"MSPointerMove",e.ontouchmove),e.bind(e.cursor,"MSGestureHold",function(n){n.preventDefault()}),e.bind(e.cursor,"contextmenu",function(n){n.preventDefault()})),this.istouchcapable&&(e.bind(e.win,"touchstart",e.ontouchstart),e.bind(document,"touchend",e.ontouchend),e.bind(document,"touchmove",e.ontouchmove)),e.bind(e.cursor,"mousedown",e.onmousedown),e.bind(e.cursor,"mouseup",e.onmouseup),e.railh&&(e.bind(e.cursorh,"mousedown",function(n){e.onmousedown(n,!0)}),e.bind(e.cursorh,"mouseup",function(n){if(!e.rail.drag||e.rail.drag.pt!=2)return e.rail.drag=!1,e.hasmoving=!1,e.hideCursor(),s.hasmousecapture&&document.releaseCapture(),e.cancelEvent(n)})),e.bind(document,"mouseup",e.onmouseup),s.hasmousecapture&&e.bind(e.win,"mouseup",e.onmouseup),e.bind(document,"mousemove",e.onmousemove),e.onclick&&e.bind(document,"click",e.onclick),s.cantouch||e.opt.touchbehavior||(e.rail.mouseenter(function(){e.canshowonmouseevent&&e.showCursor(),e.rail.active=!0}),e.rail.mouseleave(function(){e.rail.active=!1,e.rail.drag||e.hideCursor()}),e.opt.sensitiverail&&(e.rail.click(function(n){e.doRailClick(n,!1,!1)}),e.rail.dblclick(function(n){e.doRailClick(n,!0,!1)}),e.cursor.click(function(n){e.cancelEvent(n)}),e.cursor.dblclick(function(n){e.cancelEvent(n)})),e.railh&&(e.railh.mouseenter(function(){e.canshowonmouseevent&&e.showCursor(),e.rail.active=!0}),e.railh.mouseleave(function(){e.rail.active=!1,e.rail.drag||e.hideCursor()})),e.zoom&&(e.zoom.mouseenter(function(){e.canshowonmouseevent&&e.showCursor(),e.rail.active=!0}),e.zoom.mouseleave(function(){e.rail.active=!1,e.rail.drag||e.hideCursor()}))),e.opt.enablemousewheel&&(e.isiframe||e.bind(s.isie&&e.ispage?document:e.docscroll,"mousewheel",e.onmousewheel),e.bind(e.rail,"mousewheel",e.onmousewheel),e.railh&&e.bind(e.railh,"mousewheel",e.onmousewheelhr)),e.ispage||s.cantouch||/HTML|BODY/.test(e.win[0].nodeName)||(e.win.attr("tabindex")||e.win.attr({tabindex:c++}),e.win.focus(function(n){f=e.getTarget(n).id||!0,e.hasfocus=!0,e.canshowonmouseevent&&e.noticeCursor()}),e.win.blur(function(){f=!1,e.hasfocus=!1}),e.win.mouseenter(function(n){o=e.getTarget(n).id||!0,e.hasmousefocus=!0,e.canshowonmouseevent&&e.noticeCursor()}),e.win.mouseleave(function(){o=!1,e.hasmousefocus=!1}))),e.onkeypress=function(n){var n,i,r,t;if(e.locked&&e.page.maxh==0||(n=n?n:window.e,i=e.getTarget(n),i&&/INPUT|TEXTAREA|SELECT|OPTION/.test(i.nodeName)&&(!i.getAttribute("type")&&!i.type||!/submit|button|cancel/i.tp)))return!0;if(e.hasfocus||e.hasmousefocus&&!f||e.ispage&&!f&&!o){if(i=n.keyCode,r=n.ctrlKey||!1,e.locked&&i!=27)return e.cancelEvent(n);t=!1;switch(i){case 38:case 63233:e.doScrollBy(72),t=!0;break;case 40:case 63235:e.doScrollBy(-72),t=!0;break;case 37:case 63232:e.railh&&(r?e.doScrollLeft(0):e.doScrollLeftBy(72),t=!0);break;case 39:case 63234:e.railh&&(r?e.doScrollLeft(e.page.maxw):e.doScrollLeftBy(-72),t=!0);break;case 33:case 63276:e.doScrollBy(e.view.h),t=!0;break;case 34:case 63277:e.doScrollBy(-e.view.h),t=!0;break;case 36:case 63273:e.railh&&r?e.doScrollPos(0,0):e.doScrollTo(0),t=!0;break;case 35:case 63275:e.railh&&r?e.doScrollPos(e.page.maxw,e.page.maxh):e.doScrollTo(e.page.maxh),t=!0;break;case 32:e.opt.spacebarenabled&&(e.doScrollBy(-e.view.h),t=!0);break;case 27:e.zoomactive&&(e.doZoom(),t=!0)}if(t)return e.cancelEvent(n)}},e.opt.enablekeyboard&&e.bind(document,s.isopera&&!s.isopera12?"keypress":"keydown",e.onkeypress),e.bind(window,"resize",e.resize),e.bind(window,"orientationchange",e.resize),e.bind(window,"load",e.resize),!s.ischrome||e.ispage||e.haswrapper||(k=e.win.attr("style"),t=parseFloat(e.win.css("width"))+1,e.win.css("width",t),e.synched("chromefix",function(){e.win.attr("style",k)})),e.onAttributeChange=function(){e.lazyResize()},e.ispage||e.haswrapper||("WebKitMutationObserver"in window?(e.observer=new WebKitMutationObserver(function(n){n.forEach(e.onAttributeChange)}),e.observer.observe(e.win[0],{attributes:!0,subtree:!1})):(e.bind(e.win,s.isie&&!s.isie9?"propertychange":"DOMAttrModified",e.onAttributeChange),s.isie9&&e.win[0].attachEvent("onpropertychange",e.onAttributeChange))),!e.ispage&&e.opt.boxzoom&&e.bind(window,"resize",e.resizeZoom),e.istextarea&&e.bind(e.win,"mouseup",e.resize),e.resize()}this.doc[0].nodeName=="IFRAME"&&(y=function(){var t,i;e.iframexd=!1;try{t="contentDocument"in this?this.contentDocument:this.contentWindow.document}catch(r){e.iframexd=!0,t=!1}if(e.iframexd)return"console"in window&&console.log("NiceScroll error: policy restriced iframe"),!0;e.forcescreen=!0,e.isiframe&&(e.iframe={doc:n(t),html:e.doc.contents().find("html")[0],body:e.doc.contents().find("body")[0]},e.getContentSize=function(){return{w:Math.max(e.iframe.html.scrollWidth,e.iframe.body.scrollWidth),h:Math.max(e.iframe.html.scrollHeight,e.iframe.body.scrollHeight)}},e.docscroll=n(e.iframe.body)),s.isios||!e.opt.iframeautoresize||e.isiframe||(e.win.scrollTop(0),e.doc.height(""),i=Math.max(t.getElementsByTagName("html")[0].scrollHeight,t.body.scrollHeight),e.doc.height(i)),e.resize(),s.isie7&&e.css(n(e.iframe.html),{"overflow-y":"hidden"}),e.css(n(e.iframe.body),{"overflow-y":"hidden"}),"contentWindow"in this?e.bind(this.contentWindow,"scroll",e.onscroll):e.bind(t,"scroll",e.onscroll),e.opt.enablemousewheel&&e.bind(t,"mousewheel",e.onmousewheel),e.opt.enablekeyboard&&e.bind(t,s.isopera?"keypress":"keydown",e.onkeypress),(s.cantouch||e.opt.touchbehavior)&&(e.bind(t,"mousedown",e.onmousedown),e.bind(t,"mousemove",function(n){e.onmousemove(n,!0)}),s.cursorgrabvalue&&e.css(n(t.body),{cursor:s.cursorgrabvalue})),e.bind(t,"mouseup",e.onmouseup),e.zoom&&(e.opt.dblclickzoom&&e.bind(t,"dblclick",e.doZoom),e.ongesturezoom&&e.bind(t,"gestureend",e.ongesturezoom))},this.doc[0].readyState&&this.doc[0].readyState=="complete"&&setTimeout(function(){y.call(e.doc[0],!1)},500),e.bind(this.doc,"load",y))},this.showCursor=function(n,t){e.cursortimeout&&(clearTimeout(e.cursortimeout),e.cursortimeout=0),e.rail&&(e.autohidedom&&(e.autohidedom.stop().css({opacity:e.opt.cursoropacitymax}),e.cursoractive=!0),typeof n!="undefined"&&n!==!1&&(e.scroll.y=Math.round(n*1/e.scrollratio.y)),typeof t!="undefined"&&(e.scroll.x=Math.round(t*1/e.scrollratio.x)),e.cursor.css({height:e.cursorheight,top:e.scroll.y}),e.cursorh&&(!e.rail.align&&e.rail.visibility?e.cursorh.css({width:e.cursorwidth,left:e.scroll.x+e.rail.width}):e.cursorh.css({width:e.cursorwidth,left:e.scroll.x}),e.cursoractive=!0),e.zoom&&e.zoom.stop().css({opacity:e.opt.cursoropacitymax}))},this.hideCursor=function(n){!e.cursortimeout&&e.rail&&e.autohidedom&&(e.cursortimeout=setTimeout(function(){e.rail.active&&e.showonmouseevent||(e.autohidedom.stop().animate({opacity:e.opt.cursoropacitymin}),e.zoom&&e.zoom.stop().animate({opacity:e.opt.cursoropacitymin}),e.cursoractive=!1),e.cursortimeout=0},n||400))},this.noticeCursor=function(n,t,i){e.showCursor(t,i),e.rail.active||e.hideCursor(n)},this.getContentSize=e.ispage?function(){return{w:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),h:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}}:e.haswrapper?function(){return{w:e.doc.outerWidth()+parseInt(e.win.css("paddingLeft"))+parseInt(e.win.css("paddingRight")),h:e.doc.outerHeight()+parseInt(e.win.css("paddingTop"))+parseInt(e.win.css("paddingBottom"))}}:function(){return{w:e.docscroll[0].scrollWidth,h:e.docscroll[0].scrollHeight}},this.onResize=function(n,t){if(!e.win)return!1;if(!e.haswrapper&&!e.ispage){if(e.win.css("display")=="none")return e.visibility&&e.hideRail().hideRailHr(),!1;e.hidden||e.visibility||e.showRail().showRailHr()}var i=e.page.maxh,r=e.page.maxw,u=e.view.w;if(e.view={w:e.ispage?e.win.width():parseInt(e.win[0].clientWidth),h:e.ispage?e.win.height():parseInt(e.win[0].clientHeight)},e.page=t?t:e.getContentSize(),e.page.maxh=Math.max(0,e.page.h-e.view.h),e.page.maxw=Math.max(0,e.page.w-e.view.w),e.page.maxh==i&&e.page.maxw==r&&e.view.w==u){if(e.ispage||(i=e.win.offset(),e.lastposition&&(r=e.lastposition,r.top==i.top&&r.left==i.left)))return e;e.lastposition=i}return(e.page.maxh==0?(e.hideRail(),e.scrollvaluemax=0,e.scroll.y=0,e.scrollratio.y=0,e.cursorheight=0,e.setScrollTop(0),e.rail.scrollable=!1):e.rail.scrollable=!0,e.page.maxw==0?(e.hideRailHr(),e.scrollvaluemaxw=0,e.scroll.x=0,e.scrollratio.x=0,e.cursorwidth=0,e.setScrollLeft(0),e.railh.scrollable=!1):e.railh.scrollable=!0,e.locked=e.page.maxh==0&&e.page.maxw==0,e.locked)?(e.ispage||e.updateScrollBar(e.view),!1):(!e.hidden&&!e.visibility?e.showRail().showRailHr():!e.hidden&&!e.railh.visibility&&e.showRailHr(),e.istextarea&&e.win.css("resize")&&e.win.css("resize")!="none"&&(e.view.h-=20),e.ispage||e.updateScrollBar(e.view),e.cursorheight=Math.min(e.view.h,Math.round(e.view.h*(e.view.h/e.page.h))),e.cursorheight=Math.max(e.opt.cursorminheight,e.cursorheight),e.cursorwidth=Math.min(e.view.w,Math.round(e.view.w*(e.view.w/e.page.w))),e.cursorwidth=Math.max(e.opt.cursorminheight,e.cursorwidth),e.scrollvaluemax=e.view.h-e.cursorheight-e.cursor.hborder,e.railh&&(e.railh.width=e.page.maxh>0?e.view.w-e.rail.width:e.view.w,e.scrollvaluemaxw=e.railh.width-e.cursorwidth-e.cursorh.wborder),e.scrollratio={x:e.page.maxw/e.scrollvaluemaxw,y:e.page.maxh/e.scrollvaluemax},e.getScrollTop()>e.page.maxh?e.doScroll(e.page.maxh):(e.scroll.y=Math.round(e.getScrollTop()*(1/e.scrollratio.y)),e.scroll.x=Math.round(e.getScrollLeft()*(1/e.scrollratio.x)),e.cursoractive&&e.noticeCursor()),e.scroll.y&&e.getScrollTop()==0&&e.doScrollTo(Math.floor(e.scroll.y*e.scrollratio.y)),e)},this.resize=function(){return e.delayed("resize",e.onResize,30),e},this.lazyResize=function(){e.delayed("resize",e.resize,250)},this._bind=function(n,t,i,r){e.events.push({e:n,n:t,f:i,b:r}),n.addEventListener?n.addEventListener(t,i,r||!1):n.attachEvent?n.attachEvent("on"+t,i):n["on"+t]=i},this.bind=function(n,t,i,r){var u="jquery"in n?n[0]:n;u.addEventListener?(s.cantouch&&/mouseup|mousedown|mousemove/.test(t)&&e._bind(u,t=="mousedown"?"touchstart":t=="mouseup"?"touchend":"touchmove",function(n){if(n.touches){if(n.touches.length<2){var t=n.touches.length?n.touches[0]:n;t.original=n,i.call(this,t)}}else n.changedTouches&&(t=n.changedTouches[0],t.original=n,i.call(this,t))},r||!1),e._bind(u,t,i,r||!1),t=="mousewheel"&&e._bind(u,"DOMMouseScroll",i,r||!1),s.cantouch&&t=="mouseup"&&e._bind(u,"touchcancel",i,r||!1)):e._bind(u,t,function(n){return(n=n||window.event||!1)&&n.srcElement&&(n.target=n.srcElement),i.call(u,n)===!1||r===!1?e.cancelEvent(n):!0})},this._unbind=function(n,t,i,r){n.removeEventListener?n.removeEventListener(t,i,r):n.detachEvent?n.detachEvent("on"+t,i):n["on"+t]=!1},this.unbindAll=function(){for(var n,t=0;t<e.events.length;t++)n=e.events[t],e._unbind(n.e,n.n,n.f,n.b)},this.cancelEvent=function(n){return(n=n.original?n.original:n?n:window.event||!1,!n)?!1:(n.preventDefault&&n.preventDefault(),n.stopPropagation&&n.stopPropagation(),n.preventManipulation&&n.preventManipulation(),n.cancelBubble=!0,n.cancel=!0,n.returnValue=!1)},this.stopPropagation=function(n){return(n=n.original?n.original:n?n:window.event||!1,!n)?!1:n.stopPropagation?n.stopPropagation():(n.cancelBubble&&(n.cancelBubble=!0),!1)},this.showRail=function(){return e.page.maxh!=0&&(e.ispage||e.win.css("display")!="none")&&(e.visibility=!0,e.rail.visibility=!0,e.rail.css("display","block")),e},this.showRailHr=function(){return e.railh?(e.page.maxw!=0&&(e.ispage||e.win.css("display")!="none")&&(e.railh.visibility=!0,e.railh.css("display","block")),e):e},this.hideRail=function(){return e.visibility=!1,e.rail.visibility=!1,e.rail.css("display","none"),e},this.hideRailHr=function(){return e.railh?(e.railh.visibility=!1,e.railh.css("display","none"),e):e},this.show=function(){return e.hidden=!1,e.locked=!1,e.showRail().showRailHr()},this.hide=function(){return e.hidden=!0,e.locked=!0,e.hideRail().hideRailHr()},this.remove=function(){var t,n;for(e.doZoomOut(),e.unbindAll(),e.observer!==!1&&e.observer.disconnect(),e.events=[],e.cursor&&(e.cursor.remove(),e.cursor=null),e.cursorh&&(e.cursorh.remove(),e.cursorh=null),e.rail&&(e.rail.remove(),e.rail=null),e.railh&&(e.railh.remove(),e.railh=null),e.zoom&&(e.zoom.remove(),e.zoom=null),t=0;t<e.saved.css.length;t++)n=e.saved.css[t],n[0].css(n[1],typeof n[2]=="undefined"?"":n[2]);return e.saved=!1,e.me.data("__nicescroll",""),e.me=null,e.doc=null,e.docscroll=null,e.win=null,e},this.scrollstart=function(n){return this.onscrollstart=n,e},this.scrollend=function(n){return this.onscrollend=n,e},this.scrollcancel=function(n){return this.onscrollcancel=n,e},this.zoomin=function(n){return this.onzoomin=n,e},this.zoomout=function(n){return this.onzoomout=n,e},this.isScrollable=function(t){for(t=t.target?t.target:t;t&&t.nodeType==1&&!/BODY|HTML/.test(t.nodeName);){var i=n(t);if(/scroll|auto/.test(i.css("overflowY")||i.css("overflowX")||i.css("overflow")||""))return t.clientHeight!=t.scrollHeight;t=t.parentNode?t.parentNode:!1}return!1},this.onmousewheel=function(n){return e.locked?!0:e.rail.scrollable?(e.opt.preservenativescrolling&&e.checkarea&&(e.checkarea=!1,e.nativescrollingarea=e.isScrollable(n)),e.nativescrollingarea)?!0:e.locked?e.cancelEvent(n):e.rail.drag?e.cancelEvent(n):(b(n,!1),e.cancelEvent(n)):e.railh&&e.railh.scrollable?e.onmousewheelhr(n):!0},this.onmousewheelhr=function(n){return e.locked||!e.railh.scrollable?!0:(e.opt.preservenativescrolling&&e.checkarea&&(e.checkarea=!1,e.nativescrollingarea=e.isScrollable(n)),e.nativescrollingarea)?!0:e.locked?e.cancelEvent(n):e.rail.drag?e.cancelEvent(n):(b(n,!0),e.cancelEvent(n))},this.stop=function(){return e.cancelScroll(),e.scrollmon&&e.scrollmon.stop(),e.cursorfreezed=!1,e.scroll.y=Math.round(e.getScrollTop()*(1/e.scrollratio.y)),e.noticeCursor(),e},this.getTransitionSpeed=function(n){var t=Math.round(e.opt.scrollspeed*10),n=Math.min(t,Math.round(n/20*e.opt.scrollspeed));return n>20?n:0},e.opt.smoothscroll?e.ishwscroll&&s.hastransition&&e.opt.usetransition?(this.prepareTransition=function(n,t){var i=t?n>20?n:0:e.getTransitionSpeed(n),r=i?s.prefixstyle+"transform "+i+"ms ease-out":"";return e.lasttransitionstyle&&e.lasttransitionstyle==r||(e.lasttransitionstyle=r,e.doc.css(s.transitionstyle,r)),i},this.doScrollLeft=function(n,t){var i=e.scrollrunning?e.newscrolly:e.getScrollTop();e.doScrollPos(n,i,t)},this.doScrollTop=function(n,t){var i=e.scrollrunning?e.newscrollx:e.getScrollLeft();e.doScrollPos(i,n,t)},this.doScrollPos=function(n,t,i){var r=e.getScrollTop(),u=e.getScrollLeft();if(((e.newscrolly-r)*(t-r)<0||(e.newscrollx-u)*(n-u)<0)&&e.cancelScroll(),e.newscrolly=t,e.newscrollx=n,e.newscrollspeed=i||!1,e.timer)return!1;e.timer=setTimeout(function(){var r=e.getScrollTop(),u=e.getScrollLeft(),i,f;i=n-u,f=t-r,i=Math.round(Math.sqrt(Math.pow(i,2)+Math.pow(f,2))),i=e.prepareTransition(e.newscrollspeed?e.newscrollspeed:i),e.timerscroll&&e.timerscroll.tm&&clearInterval(e.timerscroll.tm),i>0&&(!e.scrollrunning&&e.onscrollstart&&e.onscrollstart.call(e,{type:"scrollstart",current:{x:u,y:r},request:{x:n,y:t},end:{x:e.newscrollx,y:e.newscrolly},speed:i}),s.transitionend?e.scrollendtrapped||(e.scrollendtrapped=!0,e.bind(e.doc,s.transitionend,e.onScrollEnd,!1)):(e.scrollendtrapped&&clearTimeout(e.scrollendtrapped),e.scrollendtrapped=setTimeout(e.onScrollEnd,i)),e.timerscroll={bz:new BezierClass(r,e.newscrolly,i,0,0,.58,1),bh:new BezierClass(u,e.newscrollx,i,0,0,.58,1)},e.cursorfreezed||(e.timerscroll.tm=setInterval(function(){e.showCursor(e.getScrollTop(),e.getScrollLeft())},60))),e.synched("doScroll-set",function(){e.timer=0,e.scrollendtrapped&&(e.scrollrunning=!0),e.setScrollTop(e.newscrolly),e.setScrollLeft(e.newscrollx),e.scrollendtrapped||e.onScrollEnd()})},50)},this.cancelScroll=function(){if(!e.scrollendtrapped)return!0;var n=e.getScrollTop(),t=e.getScrollLeft();return e.scrollrunning=!1,s.transitionend||clearTimeout(s.transitionend),e.scrollendtrapped=!1,e._unbind(e.doc,s.transitionend,e.onScrollEnd),e.prepareTransition(0),e.setScrollTop(n),e.railh&&e.setScrollLeft(t),e.timerscroll&&e.timerscroll.tm&&clearInterval(e.timerscroll.tm),e.timerscroll=!1,e.cursorfreezed=!1,e.showCursor(n,t),e},this.onScrollEnd=function(){e.scrollendtrapped&&e._unbind(e.doc,s.transitionend,e.onScrollEnd),e.scrollendtrapped=!1,e.prepareTransition(0),e.timerscroll&&e.timerscroll.tm&&clearInterval(e.timerscroll.tm),e.timerscroll=!1;var n=e.getScrollTop(),t=e.getScrollLeft();if(e.setScrollTop(n),e.railh&&e.setScrollLeft(t),e.noticeCursor(!1,n,t),e.cursorfreezed=!1,n<0?n=0:n>e.page.maxh&&(n=e.page.maxh),t<0?t=0:t>e.page.maxw&&(t=e.page.maxw),n!=e.newscrolly||t!=e.newscrollx)return e.doScrollPos(t,n,e.opt.snapbackspeed);e.onscrollend&&e.scrollrunning&&e.onscrollend.call(e,{type:"scrollend",current:{x:t,y:n},end:{x:e.newscrollx,y:e.newscrolly}}),e.scrollrunning=!1}):(this.doScrollLeft=function(n){var t=e.scrollrunning?e.newscrolly:e.getScrollTop();e.doScrollPos(n,t)},this.doScrollTop=function(n){var t=e.scrollrunning?e.newscrollx:e.getScrollLeft();e.doScrollPos(t,n)},this.doScrollPos=function(n,r){function c(){var r,n,u,i;if(e.cancelAnimationFrame)return!0;if(e.scrollrunning=!0,l=1-l)return e.timer=t(c)||1;r=0,n=sy=e.getScrollTop(),e.dst.ay?(n=e.bzscroll?e.dst.py+e.bzscroll.getNow()*e.dst.ay:e.newscrolly,u=n-sy,(u<0&&n<e.newscrolly||u>0&&n>e.newscrolly)&&(n=e.newscrolly),e.setScrollTop(n),n==e.newscrolly&&(r=1)):r=1,i=sx=e.getScrollLeft(),e.dst.ax?(i=e.bzscroll?e.dst.px+e.bzscroll.getNow()*e.dst.ax:e.newscrollx,u=i-sx,(u<0&&i<e.newscrollx||u>0&&i>e.newscrollx)&&(i=e.newscrollx),e.setScrollLeft(i),i==e.newscrollx&&(r+=1)):r+=1,r==2?(e.timer=0,e.cursorfreezed=!1,e.bzscroll=!1,e.scrollrunning=!1,n<0?n=0:n>e.page.maxh&&(n=e.page.maxh),i<0?i=0:i>e.page.maxw&&(i=e.page.maxw),i!=e.newscrollx||n!=e.newscrolly?e.doScrollPos(i,n):e.onscrollend&&e.onscrollend.call(e,{type:"scrollend",current:{x:sx,y:sy},end:{x:e.newscrollx,y:e.newscrolly}})):e.timer=t(c)||1}var u,f,o,h,s,l;if(r=typeof r=="undefined"||r===!1?e.getScrollTop(!0):r,e.timer&&e.newscrolly==r&&e.newscrollx==n)return!0;e.timer&&i(e.timer),e.timer=0,u=e.getScrollTop(),f=e.getScrollLeft(),((e.newscrolly-u)*(r-u)<0||(e.newscrollx-f)*(n-f)<0)&&e.cancelScroll(),e.newscrolly=r,e.newscrollx=n,e.bouncescroll&&e.rail.visibility||(e.newscrolly<0?e.newscrolly=0:e.newscrolly>e.page.maxh&&(e.newscrolly=e.page.maxh)),e.bouncescroll&&e.railh.visibility||(e.newscrollx<0?e.newscrollx=0:e.newscrollx>e.page.maxw&&(e.newscrollx=e.page.maxw)),e.dst={},e.dst.x=n-f,e.dst.y=r-u,e.dst.px=f,e.dst.py=u,o=Math.round(Math.sqrt(Math.pow(e.dst.x,2)+Math.pow(e.dst.y,2))),e.dst.ax=e.dst.x/o,e.dst.ay=e.dst.y/o,h=0,s=o,e.dst.x==0?(h=u,s=r,e.dst.ay=1,e.dst.py=0):e.dst.y==0&&(h=f,s=n,e.dst.ax=1,e.dst.px=0),o=e.getTransitionSpeed(o),e.bzscroll=o>0?e.bzscroll?e.bzscroll.update(s,o):new BezierClass(h,s,o,0,1,0,1):!1,e.timer||((u==e.page.maxh&&r>=e.page.maxh||f==e.page.maxw&&n>=e.page.maxw)&&e.checkContentSize(),l=1,e.cancelAnimationFrame=!1,e.timer=1,e.onscrollstart&&!e.scrollrunning&&e.onscrollstart.call(e,{type:"scrollstart",current:{x:f,y:u},request:{x:n,y:r},end:{x:e.newscrollx,y:e.newscrolly},speed:o}),c(),(u==e.page.maxh&&r>=u||f==e.page.maxw&&n>=f)&&e.checkContentSize(),e.noticeCursor())},this.cancelScroll=function(){return e.timer&&i(e.timer),e.timer=0,e.bzscroll=!1,e.scrollrunning=!1,e}):(this.doScrollLeft=function(n,t){var i=e.getScrollTop();e.doScrollPos(n,i,t)},this.doScrollTop=function(n,t){var i=e.getScrollLeft();e.doScrollPos(i,n,t)},this.doScrollPos=function(n,t){var r=n>e.page.maxw?e.page.maxw:n,i;r<0&&(r=0),i=t>e.page.maxh?e.page.maxh:t,i<0&&(i=0),e.synched("scroll",function(){e.setScrollTop(i),e.setScrollLeft(r)})},this.cancelScroll=function(){}),this.doScrollBy=function(n,t){var i=0,i=t?Math.floor((e.scroll.y-n)*e.scrollratio.y):(e.timer?e.newscrolly:e.getScrollTop(!0))-n,r;if(e.bouncescroll&&(r=Math.round(e.view.h/2),i<-r?i=-r:i>e.page.maxh+r&&(i=e.page.maxh+r)),e.cursorfreezed=!1,py=e.getScrollTop(!0),i<0&&py<=0)return e.noticeCursor();if(i>e.page.maxh&&py>=e.page.maxh)return e.checkContentSize(),e.noticeCursor();e.doScrollTop(i)},this.doScrollLeftBy=function(n,t){var i=0,i=t?Math.floor((e.scroll.x-n)*e.scrollratio.x):(e.timer?e.newscrollx:e.getScrollLeft(!0))-n,r;if((e.bouncescroll&&(r=Math.round(e.view.w/2),i<-r?i=-r:i>e.page.maxw+r&&(i=e.page.maxw+r)),e.cursorfreezed=!1,px=e.getScrollLeft(!0),i<0&&px<=0)||i>e.page.maxw&&px>=e.page.maxw)return e.noticeCursor();e.doScrollLeft(i)},this.doScrollTo=function(n,t){t&&Math.round(n*e.scrollratio.y),e.cursorfreezed=!1,e.doScrollTop(n)},this.checkContentSize=function(){var n=e.getContentSize();(n.h!=e.page.h||n.w!=e.page.w)&&e.resize(!1,n)},e.onscroll=function(){e.rail.drag||e.cursorfreezed||e.synched("scroll",function(){e.scroll.y=Math.round(e.getScrollTop()*(1/e.scrollratio.y)),e.railh&&(e.scroll.x=Math.round(e.getScrollLeft()*(1/e.scrollratio.x))),e.noticeCursor()})},e.bind(e.docscroll,"scroll",e.onscroll),this.doZoomIn=function(t){var i,u,f,r;if(!e.zoomactive){e.zoomactive=!0,e.zoomrestore={style:{}},i="position,top,left,zIndex,backgroundColor,marginTop,marginBottom,marginLeft,marginRight".split(","),u=e.win[0].style;for(f in i)r=i[f],e.zoomrestore.style[r]=typeof u[r]!="undefined"?u[r]:"";return e.zoomrestore.style.width=e.win.css("width"),e.zoomrestore.style.height=e.win.css("height"),e.zoomrestore.padding={w:e.win.outerWidth()-e.win.width(),h:e.win.outerHeight()-e.win.height()},s.isios4&&(e.zoomrestore.scrollTop=n(window).scrollTop(),n(window).scrollTop(0)),e.win.css({position:s.isios4?"absolute":"fixed",top:0,left:0,"z-index":e.opt.zindex+100,margin:"0px"}),i=e.win.css("backgroundColor"),(i==""||/transparent|rgba\(0, 0, 0, 0\)|rgba\(0,0,0,0\)/.test(i))&&e.win.css("backgroundColor","#fff"),e.rail.css({"z-index":e.opt.zindex+110}),e.zoom.css({"z-index":e.opt.zindex+112}),e.zoom.css("backgroundPosition","0px -18px"),e.resizeZoom(),e.onzoomin&&e.onzoomin.call(e),e.cancelEvent(t)}},this.doZoomOut=function(t){if(e.zoomactive)return e.zoomactive=!1,e.win.css("margin",""),e.win.css(e.zoomrestore.style),s.isios4&&n(window).scrollTop(e.zoomrestore.scrollTop),e.rail.css({"z-index":e.ispage?e.opt.zindex:e.opt.zindex+2}),e.zoom.css({"z-index":e.opt.zindex}),e.zoomrestore=!1,e.zoom.css("backgroundPosition","0px 0px"),e.onResize(),e.onzoomout&&e.onzoomout.call(e),e.cancelEvent(t)},this.doZoom=function(n){return e.zoomactive?e.doZoomOut(n):e.doZoomIn(n)},this.resizeZoom=function(){if(e.zoomactive){var t=e.getScrollTop();e.win.css({width:n(window).width()-e.zoomrestore.padding.w+"px",height:n(window).height()-e.zoomrestore.padding.h+"px"}),e.onResize(),e.setScrollTop(Math.min(e.page.maxh,t))}},this.init(),n.nicescroll.push(this)},h=function(n){var t=this;this.nc=n,this.steptime=this.lasttime=this.speedy=this.speedx=this.lasty=this.lastx=0,this.snapy=this.snapx=!1,this.demuly=this.demulx=0,this.lastscrolly=this.lastscrollx=-1,this.timer=this.chky=this.chkx=0,this.time=function(){return+new Date},this.reset=function(n,i){t.stop();var r=t.time();t.steptime=0,t.lasttime=r,t.speedx=0,t.speedy=0,t.lastx=n,t.lasty=i,t.lastscrollx=-1,t.lastscrolly=-1},this.update=function(n,i){var r=t.time();t.steptime=r-t.lasttime,t.lasttime=r;var r=i-t.lasty,e=n-t.lastx,u=t.nc.getScrollTop(),f=t.nc.getScrollLeft();u+=r,f+=e,t.snapx=f<0||f>t.nc.page.maxw,t.snapy=u<0||u>t.nc.page.maxh,t.speedx=e,t.speedy=r,t.lastx=n,t.lasty=i},this.stop=function(){t.nc.unsynched("domomentum2d"),t.timer&&clearTimeout(t.timer),t.timer=0,t.lastscrollx=-1,t.lastscrolly=-1},this.doSnapy=function(n,i){var r=!1;i<0?(i=0,r=!0):i>t.nc.page.maxh&&(i=t.nc.page.maxh,r=!0),n<0?(n=0,r=!0):n>t.nc.page.maxw&&(n=t.nc.page.maxw,r=!0),r&&t.nc.doScrollPos(n,i,t.nc.opt.snapbackspeed)},this.doMomentum=function(n){var e=t.time(),u=n?e+n:t.lasttime,n=t.nc.getScrollLeft(),h=t.nc.getScrollTop(),o=t.nc.page.maxh,s=t.nc.page.maxw,f;if(t.speedx=s>0?Math.min(60,t.speedx):0,t.speedy=o>0?Math.min(60,t.speedy):0,u=u&&e-u<=50,(h<0||h>o||n<0||n>s)&&(u=!1),n=t.speedx&&u?t.speedx:!1,t.speedy&&u&&t.speedy||n){f=Math.max(16,t.steptime),f>50&&(n=f/50,t.speedx*=n,t.speedy*=n,f=50),t.demulxy=0,t.lastscrollx=t.nc.getScrollLeft(),t.chkx=t.lastscrollx,t.lastscrolly=t.nc.getScrollTop(),t.chky=t.lastscrolly;var i=t.lastscrollx,r=t.lastscrolly,c=function(){var n=t.time()-e>600?.04:.02;t.speedx&&(i=Math.floor(t.lastscrollx-t.speedx*(1-t.demulxy)),t.lastscrollx=i,i<0||i>s)&&(n=.1),t.speedy&&(r=Math.floor(t.lastscrolly-t.speedy*(1-t.demulxy)),t.lastscrolly=r,r<0||r>o)&&(n=.1),t.demulxy=Math.min(1,t.demulxy+n),t.nc.synched("domomentum2d",function(){t.speedx&&(t.nc.getScrollLeft()!=t.chkx&&t.stop(),t.chkx=i,t.nc.setScrollLeft(i)),t.speedy&&(t.nc.getScrollTop()!=t.chky&&t.stop(),t.chky=r,t.nc.setScrollTop(r)),t.timer||(t.nc.hideCursor(),t.doSnapy(i,r))}),t.demulxy<1?t.timer=setTimeout(c,f):(t.stop(),t.nc.hideCursor(),t.doSnapy(i,r))};c()}else t.doSnapy(t.nc.getScrollLeft(),t.nc.getScrollTop())}},e=n.fn.scrollTop,r,u;n.cssHooks.pageYOffset={get:function(t){var i=n.data(t,"__nicescroll")||!1;return i&&i.ishwscroll?i.getScrollTop():e.call(t)},set:function(t,i){var r=n.data(t,"__nicescroll")||!1;return r&&r.ishwscroll?r.setScrollTop(parseInt(i)):e.call(t,i),this}},n.fn.scrollTop=function(t){if(typeof t=="undefined"){var i=this[0]?n.data(this[0],"__nicescroll")||!1:!1;return i&&i.ishwscroll?i.getScrollTop():e.call(this)}return this.each(function(){var i=n.data(this,"__nicescroll")||!1;i&&i.ishwscroll?i.setScrollTop(parseInt(t)):e.call(n(this),t)})},r=n.fn.scrollLeft,n.cssHooks.pageXOffset={get:function(t){var i=n.data(t,"__nicescroll")||!1;return i&&i.ishwscroll?i.getScrollLeft():r.call(t)},set:function(t,i){var u=n.data(t,"__nicescroll")||!1;return u&&u.ishwscroll?u.setScrollLeft(parseInt(i)):r.call(t,i),this}},n.fn.scrollLeft=function(t){if(typeof t=="undefined"){var i=this[0]?n.data(this[0],"__nicescroll")||!1:!1;return i&&i.ishwscroll?i.getScrollLeft():r.call(this)}return this.each(function(){var i=n.data(this,"__nicescroll")||!1;i&&i.ishwscroll?i.setScrollLeft(parseInt(t)):r.call(n(this),t)})},u=function(t){var i=this,r;if(this.length=0,this.name="nicescrollarray",this.each=function(n){for(var t=0;t<i.length;t++)n.call(i[t]);return i},this.push=function(n){i[i.length]=n,i.length++},this.eq=function(n){return i[n]},t)for(a=0;a<t.length;a++)r=n.data(t[a],"__nicescroll")||!1,r&&(this[this.length]=r,this.length++);return this},function(n,t,i){for(var r=0;r<t.length;r++)i(n,t[r])}(u.prototype,"show,hide,onResize,resize,remove,stop,doScrollPos".split(","),function(n,t){n[t]=function(){var n=arguments;return this.each(function(){this[t].apply(this,n)})}}),n.fn.getNiceScroll=function(t){return typeof t=="undefined"?new u(this):n.data(this[t],"__nicescroll")||!1},n.extend(n.expr[":"],{nicescroll:function(t){return n.data(t,"__nicescroll")?!0:!1}}),n.fn.niceScroll=function(t,i){var r,f;return typeof i!="undefined"||typeof t!="object"||"jquery"in t||(i=t,t=!1),r=new u,typeof i=="undefined"&&(i={}),t&&(i.doc=n(t),i.win=n(this)),f=!("doc"in i),f||"win"in i||(i.win=n(this)),this.each(function(){var t=n(this).data("__nicescroll")||!1;t||(i.doc=f?n(this):i.doc,t=new p(i,n(this)),n(this).data("__nicescroll",t)),r.push(t)}),r.length==1?r[0]:r},window.NiceScroll={getjQuery:function(){return n}},n.nicescroll||(n.nicescroll=new u)}(jQuery),function(){function u(n){throw n;}function s(n){return function(){return n}}function h(h){function gt(n,i,u,f,e){var o=[];return n=l.j(function(){var n=i(u,e)||[];0<o.length&&(l.a.Ya(k(o),n),f&&l.r.K(f,t,[u,n,e])),o.splice(0,o.length),l.a.P(o,n)},t,{W:n,Ka:function(){return 0==o.length||!l.a.X(o[0])}}),{M:o,j:n.pa()?n:r}}function k(n){for(;n.length&&!l.a.X(n[0]);)n.splice(0,1);if(1<n.length){for(var t=n[0],r=n[n.length-1],i=[t];t!==r;){if(t=t.nextSibling,!t)return;i.push(t)}Array.prototype.splice.apply(n,[0,n.length].concat(i))}return n}function ut(n,t,i,r,u){for(var o=Math.min,l=Math.max,s=[],a=n.length,f,h=t.length,c=h-a||1,w=a+h+1,v,p,b,y,e=0;e<=a;e++)for(p=v,s.push(v=[]),b=o(h,e+c),f=l(0,e-1);f<=b;f++)v[f]=f?e?n[e-1]===t[f-1]?p[f-1]:o(p[f]||w,v[f-1]||w)+1:f+1:e+1;for(o=[],l=[],c=[],e=a,f=h;e||f;)h=s[e][f]-1,f&&h===s[e][f-1]?l.push(o[o.length]={status:i,value:t[--f],index:f}):e&&h===s[e-1][f]?c.push(o[o.length]={status:r,value:n[--e],index:e}):(o.push({status:"retained",value:t[--f]}),--e);if(l.length&&c.length)for(n=10*a,t=i=0;(u||t<n)&&(y=l[i]);i++){for(r=0;s=c[r];r++)if(y.value===s.value){y.moved=s.index,s.moved=y.index,c.splice(r,1),t=r=0;break}t+=r}return o.reverse()}function ft(r,f,e,o,s){s=s||{};var h=r&&d(r),h=h&&h.ownerDocument,c=s.templateEngine||rt;l.za.vb(e,c,h),e=c.renderTemplate(e,o,s,h),("number"!=typeof e.length||0<e.length&&"number"!=typeof e[0].nodeType)&&u(Error("Template engine must return an array of DOM nodes")),h=i;switch(f){case"replaceChildren":l.e.N(r,e),h=n;break;case"replaceNode":l.a.Ya(r,e),h=n;break;case"ignoreTargetNode":break;default:u(Error("Unknown renderMode: "+f))}return h&&(et(e,o),s.afterRender&&l.r.K(s.afterRender,t,[e,o.$data])),e}function d(n){return n.nodeType?n:0<n.length?n[0]:t}function et(n,t){if(n.length){var i=n[0],r=n[n.length-1];ot(i,r,function(n){l.Da(t,n)}),ot(i,r,function(n){l.s.ib(n,[t])})}}function ot(n,t,i){var r;for(t=l.e.nextSibling(t);n&&(r=n)!==t;)n=l.e.nextSibling(r),(1===r.nodeType||8===r.nodeType)&&i(r)}function st(n,t,i){var o,f,r,e;for(n=l.g.aa(n),o=l.g.Q,f=0;f<n.length;f++)r=n[f].key,o.hasOwnProperty(r)&&(e=o[r],"function"==typeof e?(r=e(n[f].value))&&u(Error(r)):e||u(Error("This template engine does not support the '"+r+"' binding within its templates")));return n="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+l.g.ba(n)+" } })()})",i.createJavaScriptEvaluatorBlock(n)+t}function ht(n,i,f,e){function c(n){return function(){return o[n]}}function a(){return o}var s=0,o,h;return l.j(function(){var y=f&&f instanceof l.z?f:new l.z(l.a.d(f)),p=y.$data,t,v;if(e&&l.eb(n,y),o=("function"==typeof i?i(y,n):i)||l.J.instance.getBindings(n,y)){if(0===s){s=1;for(t in o)v=l.c[t],v&&8===n.nodeType&&!l.e.I[t]&&u(Error("The binding '"+t+"' cannot be used with virtual elements")),v&&"function"==typeof v.init&&(v=v.init(n,c(t),a,p,y))&&v.controlsDescendantBindings&&(h!==r&&u(Error("Multiple bindings ("+h+" and "+t+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.")),h=t);s=2}if(2===s)for(t in o)(v=l.c[t])&&"function"==typeof v.update&&v.update(n,c(t),a,p,y)}},t,{W:n}),{Nb:h===r}}function ct(i,r,u){var e=n,f=1===r.nodeType;f&&l.e.Ta(r),(f&&u||l.J.instance.nodeHasBindings(r))&&(e=ht(r,t,i,u).Nb),e&&lt(i,r,!f)}function lt(n,t,i){for(var r=l.e.firstChild(t);t=r;)r=l.e.nextSibling(t),ct(n,t,i)}function at(n,i){var r=vt(n,i);return r?0<r.length?r[r.length-1].nextSibling:n.nextSibling:t}function vt(n,i){for(var r=n,f=1,e=[];r=r.nextSibling;){if(p(r)&&(f--,0===f))return e;e.push(r),a(r)&&f++}return i||u(Error("Cannot find closing comment tag to match: "+n.nodeValue)),t}function p(n){return 8==n.nodeType&&(b?n.text:n.nodeValue).match(fi)}function a(n){return 8==n.nodeType&&(b?n.text:n.nodeValue).match(ui)}function g(n,i){for(var r=t;n!=r;)r=n,n=n.replace(ti,function(n,t){return i[t]});return n}function ni(){var n=[],t=[];this.save=function(i,r){var u=l.a.i(n,i);0<=u?t[u]=r:(n.push(i),t.push(r))},this.get=function(i){return i=l.a.i(n,i),0<=i?t[i]:r}}function yt(n,i,u){function s(t){var f=i(n[t]),o;switch(typeof f){case"boolean":case"number":case"string":case"function":e[t]=f;break;case"object":case"undefined":o=u.get(f),e[t]=o!==r?o:yt(f,i,u)}}var e,o,f;if(u=u||new ni,n=i(n),!("object"==typeof n&&n!==t&&n!==r&&!(n instanceof Date)))return n;if(e=n instanceof Array?[]:{},u.save(n,e),o=n,o instanceof Array){for(f=0;f<o.length;f++)s(f);"function"==typeof o.toJSON&&s("toJSON")}else for(f in o)s(f);return e}function pt(n,i){var r;if(n)if(8==n.nodeType)r=l.s.Ua(n.nodeValue),r!=t&&i.push({sb:n,Fb:r});else if(1==n.nodeType)for(var r=0,u=n.childNodes,f=u.length;r<f;r++)pt(u[r],i)}function nt(t,r,u,f){l.c[t]={init:function(t){return l.a.f.set(t,it,{}),{controlsDescendantBindings:n}},update:function(t,i,e,o,s){e=l.a.f.get(t,it),i=l.a.d(i()),o=!u!=!i;var h=!e.Za;(h||r||o!==e.qb)&&(h&&(e.Za=l.a.Ia(l.e.childNodes(t),n)),o?(h||l.e.N(t,l.a.Ia(e.Za)),l.Ea(f?f(s,i):s,t)):l.e.Y(t),e.qb=o)}},l.g.Q[t]=i,l.e.I[t]=n}function wt(n,i,r){r&&i!==l.k.q(n)&&l.k.T(n,i),i!==l.k.q(n)&&l.r.K(l.a.Ba,t,[n,"change"])}var l="undefined"!=typeof h?h:{},w,v,bt,y,tt,it,kt,dt,rt;l.b=function(n,t){for(var i=n.split("."),r=l,u=0;u<i.length-1;u++)r=r[i[u]];r[i[i.length-1]]=t},l.p=function(n,t,i){n[t]=i},l.version="2.2.1",l.b("version",l.version),l.a=new function(){function p(n,t){if("input"!==l.a.u(n)||!n.type||"click"!=t.toLowerCase())return i;var r=n.type;return"checkbox"==r||"radio"==r}var d=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,s={},w={},a,v,y,b,k,h;s[/Firefox\/2/i.test(c.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"],s.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" ");for(a in s)if(v=s[a],v.length)for(y=0,b=v.length;y<b;y++)w[v[y]]=a;for(k={propertychange:n},s=3,a=e.createElement("div"),v=a.getElementsByTagName("i");a.innerHTML="<!--[if gt IE "+ ++s+"]><i><\/i><![endif]-->",v[0];);return h=4<s?s:r,{Na:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],o:function(n,t){for(var i=0,r=n.length;i<r;i++)t(n[i])},i:function(n,t){if("function"==typeof Array.prototype.indexOf)return Array.prototype.indexOf.call(n,t);for(var i=0,r=n.length;i<r;i++)if(n[i]===t)return i;return-1},lb:function(n,i,r){for(var u=0,f=n.length;u<f;u++)if(i.call(r,n[u]))return n[u];return t},ga:function(n,t){var i=l.a.i(n,t);0<=i&&n.splice(i,1)},Ga:function(n){n=n||[];for(var i=[],t=0,r=n.length;t<r;t++)0>l.a.i(i,n[t])&&i.push(n[t]);return i},V:function(n,t){n=n||[];for(var r=[],i=0,u=n.length;i<u;i++)r.push(t(n[i]));return r},fa:function(n,t){n=n||[];for(var r=[],i=0,u=n.length;i<u;i++)t(n[i])&&r.push(n[i]);return r},P:function(n,t){if(t instanceof Array)n.push.apply(n,t);else for(var i=0,r=t.length;i<r;i++)n.push(t[i]);return n},extend:function(n,t){if(t)for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n},ka:function(n){for(;n.firstChild;)l.removeNode(n.firstChild)},Hb:function(n){n=l.a.L(n);for(var i=e.createElement("div"),t=0,r=n.length;t<r;t++)i.appendChild(l.A(n[t]));return i},Ia:function(t,i){for(var u,r=0,e=t.length,f=[];r<e;r++)u=t[r].cloneNode(n),f.push(i?l.A(u):u);return f},N:function(n,t){if(l.a.ka(n),t)for(var i=0,r=t.length;i<r;i++)n.appendChild(t[i])},Ya:function(n,t){var r=n.nodeType?[n]:n;if(0<r.length){for(var f=r[0],e=f.parentNode,i=0,u=t.length;i<u;i++)e.insertBefore(t[i],f);for(i=0,u=r.length;i<u;i++)l.removeNode(r[i])}},bb:function(n,t){7>h?n.setAttribute("selected",t):n.selected=t},D:function(n){return(n||"").replace(d,"")},Rb:function(n,t){for(var r,u=[],f=(n||"").split(t),i=0,e=f.length;i<e;i++)r=l.a.D(f[i]),""!==r&&u.push(r);return u},Ob:function(n,t){return n=n||"",t.length>n.length?i:n.substring(0,t.length)===t},tb:function(r,u){if(u.compareDocumentPosition)return 16==(u.compareDocumentPosition(r)&16);for(;r!=t;){if(r==u)return n;r=r.parentNode}return i},X:function(n){return l.a.tb(n,n.ownerDocument)},u:function(n){return n&&n.tagName&&n.tagName.toLowerCase()},n:function(t,r,e){var o=h&&k[r],s;o||"undefined"==typeof f?!o&&"function"==typeof t.addEventListener?t.addEventListener(r,e,i):"undefined"!=typeof t.attachEvent?t.attachEvent("on"+r,function(n){e.call(t,n)}):u(Error("Browser doesn't support addEventListener or attachEvent")):(p(t,r)&&(s=e,e=function(t,i){var r=this.checked;i&&(this.checked=i.nb!==n),s.call(this,t),this.checked=r}),f(t).bind(r,e))},Ba:function(t,r){if(t&&t.nodeType||u(Error("element must be a DOM node when calling triggerEvent")),"undefined"!=typeof f){var s=[];p(t,r)&&s.push({nb:t.checked}),f(t).trigger(r,s)}else"function"==typeof e.createEvent?"function"==typeof t.dispatchEvent?(s=e.createEvent(w[r]||"HTMLEvents"),s.initEvent(r,n,n,o,0,0,0,0,0,i,i,i,i,0,t),t.dispatchEvent(s)):u(Error("The supplied element doesn't support dispatchEvent")):"undefined"!=typeof t.fireEvent?(p(t,r)&&(t.checked=t.checked!==n),t.fireEvent("on"+r)):u(Error("Browser doesn't support triggering events"))},d:function(n){return l.$(n)?n():n},ua:function(n){return l.$(n)?n.t():n},da:function(n,t,i){if(t){var u=/[\w-]+/g,r=n.className.match(u)||[];l.a.o(t.match(u),function(n){var t=l.a.i(r,n);0<=t?i||r.splice(t,1):i&&r.push(n)}),n.className=r.join(" ")}},cb:function(n,i){var u=l.a.d(i),f;(u===t||u===r)&&(u=""),3===n.nodeType?n.data=u:(f=l.e.firstChild(n),!f||3!=f.nodeType||l.e.nextSibling(f)?l.e.N(n,[e.createTextNode(u)]):f.data=u,l.a.wb(n))},ab:function(n,t){if(n.name=t,7>=h)try{n.mergeAttributes(e.createElement("<input name='"+n.name+"'/>"),i)}catch(r){}},wb:function(n){9<=h&&(n=1==n.nodeType?n:n.parentNode,n.style&&(n.style.zoom=n.style.zoom))},ub:function(n){if(9<=h){var t=n.style.width;n.style.width=0,n.style.width=t}},Lb:function(n,t){n=l.a.d(n),t=l.a.d(t);for(var r=[],i=n;i<=t;i++)r.push(i);return r},L:function(n){for(var i=[],t=0,r=n.length;t<r;t++)i.push(n[t]);return i},Pb:6===h,Qb:7===h,Z:h,Oa:function(n,t){for(var r=l.a.L(n.getElementsByTagName("input")).concat(l.a.L(n.getElementsByTagName("textarea"))),f="string"==typeof t?function(n){return n.name===t}:function(n){return t.test(n.name)},u=[],i=r.length-1;0<=i;i--)f(r[i])&&u.push(r[i]);return u},Ib:function(n){return"string"==typeof n&&(n=l.a.D(n))?o.JSON&&o.JSON.parse?o.JSON.parse(n):new Function("return "+n)():t},xa:function(n,t,i){return("undefined"==typeof JSON||"undefined"==typeof JSON.stringify)&&u(Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js")),JSON.stringify(l.a.d(n),t,i)},Jb:function(n,t,i){var c,o,s,f,r,u;i=i||{};var h=i.params||{},a=i.includeFields||this.Na,c=n;if("object"==typeof n&&"form"===l.a.u(n))for(c=n.action,o=a.length-1;0<=o;o--)for(s=l.a.Oa(n,a[o]),f=s.length-1;0<=f;f--)h[s[f].name]=s[f].value;t=l.a.d(t),r=e.createElement("form"),r.style.display="none",r.action=c,r.method="post";for(u in t)n=e.createElement("input"),n.name=u,n.value=l.a.xa(l.a.d(t[u])),r.appendChild(n);for(u in h)n=e.createElement("input"),n.name=u,n.value=h[u],r.appendChild(n);e.body.appendChild(r),i.submitter?i.submitter(r):r.submit(),setTimeout(function(){r.parentNode.removeChild(r)},0)}}},l.b("utils",l.a),l.b("utils.arrayForEach",l.a.o),l.b("utils.arrayFirst",l.a.lb),l.b("utils.arrayFilter",l.a.fa),l.b("utils.arrayGetDistinctValues",l.a.Ga),l.b("utils.arrayIndexOf",l.a.i),l.b("utils.arrayMap",l.a.V),l.b("utils.arrayPushAll",l.a.P),l.b("utils.arrayRemoveItem",l.a.ga),l.b("utils.extend",l.a.extend),l.b("utils.fieldsIncludedWithJsonPost",l.a.Na),l.b("utils.getFormFields",l.a.Oa),l.b("utils.peekObservable",l.a.ua),l.b("utils.postJson",l.a.Jb),l.b("utils.parseJson",l.a.Ib),l.b("utils.registerEventHandler",l.a.n),l.b("utils.stringifyJson",l.a.xa),l.b("utils.range",l.a.Lb),l.b("utils.toggleDomNodeCssClass",l.a.da),l.b("utils.triggerEvent",l.a.Ba),l.b("utils.unwrapObservable",l.a.d),Function.prototype.bind||(Function.prototype.bind=function(n){var i=this,t=Array.prototype.slice.call(arguments);return n=t.shift(),function(){return i.apply(n,t.concat(Array.prototype.slice.call(arguments)))}}),l.a.f=new function(){var e=0,u="__ko__"+(new Date).getTime(),f={};return{get:function(n,t){var u=l.a.f.la(n,i);return u===r?r:u[t]},set:function(t,u,f){f===r&&l.a.f.la(t,i)===r||(l.a.f.la(t,n)[u]=f)},la:function(n,t){var i=n[u];if(!i||!("null"!==i&&f[i])){if(!t)return r;i=n[u]="ko"+e++,f[i]={}}return f[i]},clear:function(r){var e=r[u];return e?(delete f[e],r[u]=t,n):i}}},l.b("utils.domData",l.a.f),l.b("utils.domData.clear",l.a.f.clear),l.a.F=new function(){function t(n,t){var i=l.a.f.get(n,o);return i===r&&t&&(i=[],l.a.f.set(n,o,i)),i}function e(n){var r=t(n,i),u;if(r)for(r=r.slice(0),u=0;u<r.length;u++)r[u](n);if(l.a.f.clear(n),"function"==typeof f&&"function"==typeof f.cleanData&&f.cleanData([n]),s[n.nodeType])for(r=n.firstChild;n=r;)r=n.nextSibling,8===n.nodeType&&e(n)}var o="__ko_domNodeDisposal__"+(new Date).getTime(),h={1:n,8:n,9:n},s={1:n,9:n};return{Ca:function(i,r){"function"!=typeof r&&u(Error("Callback must be a function")),t(i,n).push(r)},Xa:function(n,u){var f=t(n,i);f&&(l.a.ga(f,u),0==f.length&&l.a.f.set(n,o,r))},A:function(n){var t,i,r;if(h[n.nodeType]&&(e(n),s[n.nodeType]))for(t=[],l.a.P(t,n.getElementsByTagName("*")),i=0,r=t.length;i<r;i++)e(t[i]);return n},removeNode:function(n){l.A(n),n.parentNode&&n.parentNode.removeChild(n)}}},l.A=l.a.F.A,l.removeNode=l.a.F.removeNode,l.b("cleanNode",l.A),l.b("removeNode",l.removeNode),l.b("utils.domNodeDisposal",l.a.F),l.b("utils.domNodeDisposal.addDisposeCallback",l.a.F.Ca),l.b("utils.domNodeDisposal.removeDisposeCallback",l.a.F.Xa),l.a.ta=function(n){var t,i;if("undefined"!=typeof f){if(f.parseHTML)t=f.parseHTML(n);else if((t=f.clean([n]))&&t[0]){for(n=t[0];n.parentNode&&11!==n.parentNode.nodeType;)n=n.parentNode;n.parentNode&&n.parentNode.removeChild(n)}}else{for(i=l.a.D(n).toLowerCase(),t=e.createElement("div"),i=i.match(/^<(thead|tbody|tfoot)/)&&[1,"<table>","<\/table>"]||!i.indexOf("<tr")&&[2,"<table><tbody>","<\/tbody><\/table>"]||(!i.indexOf("<td")||!i.indexOf("<th"))&&[3,"<table><tbody><tr>","<\/tr><\/tbody><\/table>"]||[0,"",""],n="ignored<div>"+i[1]+n+i[2]+"<\/div>","function"==typeof o.innerShiv?t.appendChild(o.innerShiv(n)):t.innerHTML=n;i[0]--;)t=t.lastChild;t=l.a.L(t.lastChild.childNodes)}return t},l.a.ca=function(n,i){if(l.a.ka(n),i=l.a.d(i),i!==t&&i!==r)if("string"!=typeof i&&(i=i.toString()),"undefined"!=typeof f)f(n).html(i);else for(var e=l.a.ta(i),u=0;u<e.length;u++)n.appendChild(e[u])},l.b("utils.parseHtmlFragment",l.a.ta),l.b("utils.setHtml",l.a.ca),w={},l.s={ra:function(n){"function"!=typeof n&&u(Error("You can only pass a function to ko.memoization.memoize()"));var t=(4294967296*(1+Math.random())|0).toString(16).substring(1)+(4294967296*(1+Math.random())|0).toString(16).substring(1);return w[t]=n,"<!--[ko_memo:"+t+"]-->"},hb:function(i,f){var e=w[i];e===r&&u(Error("Couldn't find any memo with ID "+i+". Perhaps it's already been unmemoized."));try{return e.apply(t,f||[]),n}finally{delete w[i]}},ib:function(n,t){var u=[],r,e,i,f;for(pt(n,u),r=0,e=u.length;r<e;r++)i=u[r].sb,f=[i],t&&l.a.P(f,t),l.s.hb(u[r].Fb,f),i.nodeValue="",i.parentNode&&i.parentNode.removeChild(i)},Ua:function(n){return(n=n.match(/^\[ko_memo\:(.*?)\]$/))?n[1]:t}},l.b("memoization",l.s),l.b("memoization.memoize",l.s.ra),l.b("memoization.unmemoize",l.s.hb),l.b("memoization.parseMemoText",l.s.Ua),l.b("memoization.unmemoizeDomNodeAndDescendants",l.s.ib),l.Ma={throttle:function(n,i){n.throttleEvaluation=i;var r=t;return l.j({read:n,write:function(t){clearTimeout(r),r=setTimeout(function(){n(t)},i)}})},notify:function(n,t){return n.equalityComparer="always"==t?s(i):l.m.fn.equalityComparer,n}},l.b("extenders",l.Ma),l.fb=function(n,t,i){this.target=n,this.ha=t,this.rb=i,l.p(this,"dispose",this.B)},l.fb.prototype.B=function(){this.Cb=n,this.rb()},l.S=function(){this.w={},l.a.extend(this,l.S.fn),l.p(this,"subscribe",this.ya),l.p(this,"extend",this.extend),l.p(this,"getSubscriptionsCount",this.yb)},l.S.fn={ya:function(n,t,i){i=i||"change";var r=new l.fb(this,t?n.bind(t):n,function(){l.a.ga(this.w[i],r)}.bind(this));return this.w[i]||(this.w[i]=[]),this.w[i].push(r),r},notifySubscribers:function(t,i){i=i||"change",this.w[i]&&l.r.K(function(){l.a.o(this.w[i].slice(0),function(i){i&&i.Cb!==n&&i.ha(t)})},this)},yb:function(){var t=0,n;for(n in this.w)this.w.hasOwnProperty(n)&&(t+=this.w[n].length);return t},extend:function(n){var t=this,i,r;if(n)for(i in n)r=l.Ma[i],"function"==typeof r&&(t=r(t,n[i]));return t}},l.Qa=function(n){return"function"==typeof n.ya&&"function"==typeof n.notifySubscribers},l.b("subscribable",l.S),l.b("isSubscribable",l.Qa),v=[],l.r={mb:function(n){v.push({ha:n,La:[]})},end:function(){v.pop()},Wa:function(n){if(l.Qa(n)||u(Error("Only subscribable things can act as dependencies")),0<v.length){var t=v[v.length-1];!t||0<=l.a.i(t.La,n)||(t.La.push(n),t.ha(n))}},K:function(n,i,r){try{return v.push(t),n.apply(i,r||[])}finally{v.pop()}}},bt={undefined:n,boolean:n,number:n,string:n},l.m=function(n){function t(){return 0<arguments.length?(t.equalityComparer&&t.equalityComparer(i,arguments[0])||(t.H(),i=arguments[0],t.G()),this):(l.r.Wa(t),i)}var i=n;return l.S.call(t),t.t=function(){return i},t.G=function(){t.notifySubscribers(i)},t.H=function(){t.notifySubscribers(i,"beforeChange")},l.a.extend(t,l.m.fn),l.p(t,"peek",t.t),l.p(t,"valueHasMutated",t.G),l.p(t,"valueWillMutate",t.H),t},l.m.fn={equalityComparer:function(n,r){return n===t||typeof n in bt?n===r:i}},y=l.m.Kb="__ko_proto__",l.m.fn[y]=l.m,l.ma=function(u,f){return u===t||u===r||u[y]===r?i:u[y]===f?n:l.ma(u[y],f)},l.$=function(n){return l.ma(n,l.m)},l.Ra=function(t){return"function"==typeof t&&t[y]===l.m||"function"==typeof t&&t[y]===l.j&&t.zb?n:i},l.b("observable",l.m),l.b("isObservable",l.$),l.b("isWriteableObservable",l.Ra),l.R=function(n){0==arguments.length&&(n=[]),n===t||n===r||"length"in n||u(Error("The argument passed when initializing an observable array must be an array, or null, or undefined."));var i=l.m(n);return l.a.extend(i,l.R.fn),i},l.R.fn={remove:function(n){for(var u,r=this.t(),i=[],f="function"==typeof n?n:function(t){return t===n},t=0;t<r.length;t++)u=r[t],f(u)&&(0===i.length&&this.H(),i.push(u),r.splice(t,1),t--);return i.length&&this.G(),i},removeAll:function(n){if(n===r){var t=this.t(),i=t.slice(0);return this.H(),t.splice(0,t.length),this.G(),i}return n?this.remove(function(t){return 0<=l.a.i(n,t)}):[]},destroy:function(t){var r=this.t(),u="function"==typeof t?t:function(n){return n===t},i;for(this.H(),i=r.length-1;0<=i;i--)u(r[i])&&(r[i]._destroy=n);this.G()},destroyAll:function(t){return t===r?this.destroy(s(n)):t?this.destroy(function(n){return 0<=l.a.i(t,n)}):[]},indexOf:function(n){var t=this();return l.a.i(t,n)},replace:function(n,t){var i=this.indexOf(n);0<=i&&(this.H(),this.t()[i]=t,this.G())}},l.a.o("pop push reverse shift sort splice unshift".split(" "),function(n){l.R.fn[n]=function(){var t=this.t();return this.H(),t=t[n].apply(t,arguments),this.G(),t}}),l.a.o(["slice"],function(n){l.R.fn[n]=function(){var t=this();return t[n].apply(t,arguments)}}),l.b("observableArray",l.R),l.j=function(f,e,o){function g(){l.a.o(a,function(n){n.B()}),a=[]}function ut(){var n=h.throttleEvaluation;n&&0<=n?(clearTimeout(it),it=setTimeout(v,n)):v()}function v(){var t,f,u;if(!d)if(p&&k())w();else{d=n;try{for(t=l.a.V(a,function(n){return n.target}),l.r.mb(function(n){var i;0<=(i=l.a.i(t,n))?t[i]=r:a.push(n.ya(ut))}),f=c.call(e),u=t.length-1;0<=u;u--)t[u]&&a.splice(u,1)[0].B();p=n,h.notifySubscribers(y,"beforeChange"),y=f}finally{l.r.end()}h.notifySubscribers(y),d=i,a.length||w()}}function h(){return 0<arguments.length?("function"==typeof tt?tt.apply(e,arguments):u(Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.")),this):(p||v(),l.r.Wa(h),y)}function nt(){return!p||0<a.length}var y,p=i,d=i,c=f,rt,k;c&&"object"==typeof c?(o=c,c=o.read):(o=o||{},c||(c=o.read)),"function"!=typeof c&&u(Error("Pass a function that returns the value of the ko.computed"));var tt=o.write,b=o.disposeWhenNodeIsRemoved||o.W||t,k=o.disposeWhen||o.Ka||s(i),w=g,a=[],it=t;return e||(e=o.owner),h.t=function(){return p||v(),y},h.xb=function(){return a.length},h.zb="function"==typeof o.write,h.B=function(){w()},h.pa=nt,l.S.call(h),l.a.extend(h,l.j.fn),l.p(h,"peek",h.t),l.p(h,"dispose",h.B),l.p(h,"isActive",h.pa),l.p(h,"getDependenciesCount",h.xb),o.deferEvaluation!==n&&v(),b&&nt()&&(w=function(){l.a.F.Xa(b,arguments.callee),g()},l.a.F.Ca(b,w),rt=k,k=function(){return!l.a.X(b)||rt()}),h},l.Bb=function(n){return l.ma(n,l.j)},h=l.m.Kb,l.j[h]=l.m,l.j.fn={},l.j.fn[h]=l.j,l.b("dependentObservable",l.j),l.b("computed",l.j),l.b("isComputed",l.Bb),l.gb=function(n){return 0==arguments.length&&u(Error("When calling ko.toJS, pass the object you want to convert.")),yt(n,function(n){for(var t=0;l.$(n)&&10>t;t++)n=n();return n})},l.toJSON=function(n,t,i){return n=l.gb(n),l.a.xa(n,t,i)},l.b("toJS",l.gb),l.b("toJSON",l.toJSON),l.k={q:function(t){switch(l.a.u(t)){case"option":return t.__ko__hasDomDataOptionValue__===n?l.a.f.get(t,l.c.options.sa):7>=l.a.Z?t.getAttributeNode("value").specified?t.value:t.text:t.value;case"select":return 0<=t.selectedIndex?l.k.q(t.options[t.selectedIndex]):r;default:return t.value}},T:function(i,u){switch(l.a.u(i)){case"option":switch(typeof u){case"string":l.a.f.set(i,l.c.options.sa,r),"__ko__hasDomDataOptionValue__"in i&&delete i.__ko__hasDomDataOptionValue__,i.value=u;break;default:l.a.f.set(i,l.c.options.sa,u),i.__ko__hasDomDataOptionValue__=n,i.value="number"==typeof u?u:""}break;case"select":for(var f=i.options.length-1;0<=f;f--)if(l.k.q(i.options[f])==u){i.selectedIndex=f;break}break;default:(u===t||u===r)&&(u=""),i.value=u}}},l.b("selectExtensions",l.k),l.b("selectExtensions.readValue",l.k.q),l.b("selectExtensions.writeValue",l.k.T);var ti=/\@ko_token_(\d+)\@/g,ii=["true","false"],ri=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i;l.g={Q:[],aa:function(n){var i=l.a.D(n),f,e,r,u;if(3>i.length)return[];for("{"===i.charAt(0)&&(i=i.substring(1,i.length-1)),n=[],f=t,r=0;r<i.length;r++)if(u=i.charAt(r),f===t)switch(u){case'"':case"'":case"/":f=r,e=u}else if(u==e&&"\\"!==i.charAt(r-1)){u=i.substring(f,r+1),n.push(u);var h="@ko_token_"+(n.length-1)+"@",i=i.substring(0,f)+h+i.substring(r+1),r=r-(u.length-h.length),f=t}e=f=t;for(var o=0,s=t,r=0;r<i.length;r++){if(u=i.charAt(r),f===t)switch(u){case"{":f=r,s=u,e="}";break;case"(":f=r,s=u,e=")";break;case"[":f=r,s=u,e="]"}u===s?o++:u===e&&(o--,0===o&&(u=i.substring(f,r+1),n.push(u),h="@ko_token_"+(n.length-1)+"@",i=i.substring(0,f)+h+i.substring(r+1),r-=u.length-h.length,f=t))}for(e=[],i=i.split(","),f=0,r=i.length;f<r;f++)o=i[f],s=o.indexOf(":"),0<s&&s<o.length-1?(u=o.substring(s+1),e.push({key:g(o.substring(0,s),n),value:g(u,n)})):e.push({unknown:g(o,n)});return e},ba:function(n){var e="string"==typeof n?l.g.aa(n):n,f=[],r,s,o,u;for(n=[],s=0;r=e[s];s++)if(0<f.length&&f.push(","),r.key){n:{o=r.key,u=l.a.D(o);switch(u.length&&u.charAt(0)){case"'":case'"':break n;default:o="'"+u+"'"}}r=r.value,f.push(o),f.push(":"),f.push(r),r=l.a.D(r),0<=l.a.i(ii,l.a.D(r).toLowerCase())?r=i:(u=r.match(ri),r=u===t?i:u[1]?"Object("+u[1]+")"+u[2]:r),r&&(0<n.length&&n.push(", "),n.push(o+" : function(__ko_value) { "+r+" = __ko_value; }"))}else r.unknown&&f.push(r.unknown);return e=f.join(""),0<n.length&&(e=e+", '_ko_property_writers' : { "+n.join("")+" } "),e},Eb:function(t,r){for(var u=0;u<t.length;u++)if(l.a.D(t[u].key)==r)return n;return i},ea:function(n,t,i,r,u){n&&l.Ra(n)?u&&n.t()===r||n(r):(n=t()._ko_property_writers)&&n[i]&&n[i](r)}},l.b("expressionRewriting",l.g),l.b("expressionRewriting.bindingRewriteValidators",l.g.Q),l.b("expressionRewriting.parseObjectLiteral",l.g.aa),l.b("expressionRewriting.preProcessBindings",l.g.ba),l.b("jsonExpressionRewriting",l.g),l.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",l.g.ba);var b="<!--test-->"===e.createComment("test").text,ui=b?/^\x3c!--\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*--\x3e$/:/^\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*$/,fi=b?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/,ei={ul:n,ol:n};l.e={I:{},childNodes:function(n){return a(n)?vt(n):n.childNodes},Y:function(n){if(a(n)){n=l.e.childNodes(n);for(var t=0,i=n.length;t<i;t++)l.removeNode(n[t])}else l.a.ka(n)},N:function(n,t){if(a(n)){l.e.Y(n);for(var r=n.nextSibling,i=0,u=t.length;i<u;i++)r.parentNode.insertBefore(t[i],r)}else l.a.N(n,t)},Va:function(n,t){a(n)?n.parentNode.insertBefore(t,n.nextSibling):n.firstChild?n.insertBefore(t,n.firstChild):n.appendChild(t)},Pa:function(n,t,i){i?a(n)?n.parentNode.insertBefore(t,i.nextSibling):i.nextSibling?n.insertBefore(t,i.nextSibling):n.appendChild(t):l.e.Va(n,t)},firstChild:function(n){return a(n)?!n.nextSibling||p(n.nextSibling)?t:n.nextSibling:n.firstChild},nextSibling:function(n){return a(n)&&(n=at(n)),n.nextSibling&&p(n.nextSibling)?t:n.nextSibling},jb:function(n){return(n=a(n))?n[1]:t},Ta:function(i){var e,r,u,f;if(ei[l.a.u(i)]&&(e=i.firstChild,e))do if(1===e.nodeType){if(r=e.firstChild,u=t,r)do u?u.push(r):a(r)?(f=at(r,n),f?r=f:u=[r]):p(r)&&(u=[r]);while(r=r.nextSibling);if(r=u)for(u=e.nextSibling,f=0;f<r.length;f++)u?i.insertBefore(r[f],u):i.appendChild(r[f])}while(e=e.nextSibling)}},l.b("virtualElements",l.e),l.b("virtualElements.allowedBindings",l.e.I),l.b("virtualElements.emptyNode",l.e.Y),l.b("virtualElements.insertAfter",l.e.Pa),l.b("virtualElements.prepend",l.e.Va),l.b("virtualElements.setDomNodeChildren",l.e.N),l.J=function(){this.Ha={}},l.a.extend(l.J.prototype,{nodeHasBindings:function(n){switch(n.nodeType){case 1:return n.getAttribute("data-bind")!=t;case 8:return l.e.jb(n)!=t;default:return i}},getBindings:function(n,i){var r=this.getBindingsString(n,i);return r?this.parseBindingsString(r,i,n):t},getBindingsString:function(n){switch(n.nodeType){case 1:return n.getAttribute("data-bind");case 8:return l.e.jb(n);default:return t}},parseBindingsString:function(n,t,i){var r,f,e,o;try{return(r=this.Ha[n])||(f=this.Ha,o="with($context){with($data||{}){return{"+l.g.ba(n)+"}}}",e=new Function("$context","$element",o),r=f[n]=e),r(t,i)}catch(s){u(Error("Unable to parse bindings.\nMessage: "+s+";\nBindings value: "+n))}}}),l.J.instance=new l.J,l.b("bindingProvider",l.J),l.c={},l.z=function(n,t,i){t?(l.a.extend(this,t),this.$parentContext=t,this.$parent=t.$data,this.$parents=(t.$parents||[]).slice(0),this.$parents.unshift(this.$parent)):(this.$parents=[],this.$root=n,this.ko=l),this.$data=n,i&&(this[i]=n)},l.z.prototype.createChildContext=function(n,t){return new l.z(n,this,t)},l.z.prototype.extend=function(n){var t=l.a.extend(new l.z,this);return l.a.extend(t,n)},l.eb=function(n,t){if(2==arguments.length)l.a.f.set(n,"__ko_bindingContext__",t);else return l.a.f.get(n,"__ko_bindingContext__")},l.Fa=function(t,i,r){return 1===t.nodeType&&l.e.Ta(t),ht(t,i,r,n)},l.Ea=function(t,i){(1===i.nodeType||8===i.nodeType)&&lt(t,i,n)},l.Da=function(t,i){i&&1!==i.nodeType&&8!==i.nodeType&&u(Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node")),i=i||o.document.body,ct(t,i,n)},l.ja=function(n){switch(n.nodeType){case 1:case 8:var t=l.eb(n);if(t)return t;if(n.parentNode)return l.ja(n.parentNode)}return r},l.pb=function(n){return(n=l.ja(n))?n.$data:r},l.b("bindingHandlers",l.c),l.b("applyBindings",l.Da),l.b("applyBindingsToDescendants",l.Ea),l.b("applyBindingsToNode",l.Fa),l.b("contextFor",l.ja),l.b("dataFor",l.pb),tt={"class":"className","for":"htmlFor"},l.c.attr={update:function(n,u){var s=l.a.d(u())||{},f,e,o;for(f in s)"string"==typeof f&&(e=l.a.d(s[f]),o=e===i||e===t||e===r,o&&n.removeAttribute(f),8>=l.a.Z&&f in tt?(f=tt[f],o?n.removeAttribute(f):n[f]=e):o||n.setAttribute(f,e.toString()),"name"===f&&l.a.ab(n,o?"":e.toString()))}},l.c.checked={init:function(t,i,r){l.a.n(t,"click",function(){var u,f,e;if("checkbox"==t.type)u=t.checked;else if("radio"==t.type&&t.checked)u=t.value;else return;f=i(),e=l.a.d(f),"checkbox"==t.type&&e instanceof Array?(u=l.a.i(e,t.value),t.checked&&0>u?f.push(t.value):!t.checked&&0<=u&&f.splice(u,1)):l.g.ea(f,r,"checked",u,n)}),"radio"!=t.type||t.name||l.c.uniqueName.init(t,s(n))},update:function(n,t){var i=l.a.d(t());"checkbox"==n.type?n.checked=i instanceof Array?0<=l.a.i(i,n.value):i:"radio"==n.type&&(n.checked=n.value==i)}},l.c.css={update:function(t,r){var u=l.a.d(r()),f,e;if("object"==typeof u)for(f in u)e=l.a.d(u[f]),l.a.da(t,f,e);else u=String(u||""),l.a.da(t,t.__ko__cssValue,i),t.__ko__cssValue=u,l.a.da(t,u,n)}},l.c.enable={update:function(t,i){var r=l.a.d(i());r&&t.disabled?t.removeAttribute("disabled"):!r&&!t.disabled&&(t.disabled=n)}},l.c.disable={update:function(n,t){l.c.enable.update(n,function(){return!l.a.d(t())})}},l.c.event={init:function(t,r,u,f){var o=r()||{},e;for(e in o)(function(){var o=e;"string"==typeof o&&l.a.n(t,o,function(t){var s,h=r()[o],c,e;if(h){c=u();try{e=l.a.L(arguments),e.unshift(f),s=h.apply(f,e)}finally{s!==n&&(t.preventDefault?t.preventDefault():t.returnValue=i)}c[o+"Bubble"]===i&&(t.cancelBubble=n,t.stopPropagation&&t.stopPropagation())}})})()}},l.c.foreach={Sa:function(n){return function(){var i=n(),t=l.a.ua(i);return!t||"number"==typeof t.length?{foreach:i,templateEngine:l.C.oa}:(l.a.d(i),{foreach:t.data,as:t.as,includeDestroyed:t.includeDestroyed,afterAdd:t.afterAdd,beforeRemove:t.beforeRemove,afterRender:t.afterRender,beforeMove:t.beforeMove,afterMove:t.afterMove,templateEngine:l.C.oa})}},init:function(n,t){return l.c.template.init(n,l.c.foreach.Sa(t))},update:function(n,t,i,r,u){return l.c.template.update(n,l.c.foreach.Sa(t),i,r,u)}},l.g.Q.foreach=i,l.e.I.foreach=n,l.c.hasfocus={init:function(r,u,f){function e(t){r.__ko_hasfocusUpdating=n;var e=r.ownerDocument;"activeElement"in e&&(t=e.activeElement===r),e=u(),l.g.ea(e,f,"hasfocus",t,n),r.__ko_hasfocusUpdating=i}var o=e.bind(t,n),s=e.bind(t,i);l.a.n(r,"focus",o),l.a.n(r,"focusin",o),l.a.n(r,"blur",s),l.a.n(r,"focusout",s)},update:function(n,i){var r=l.a.d(i());n.__ko_hasfocusUpdating||(r?n.focus():n.blur(),l.r.K(l.a.Ba,t,[n,r?"focusin":"focusout"]))}},l.c.html={init:function(){return{controlsDescendantBindings:n}},update:function(n,t){l.a.ca(n,t())}},it="__ko_withIfBindingData",nt("if"),nt("ifnot",i,n),nt("with",n,i,function(n,t){return n.createChildContext(t)}),l.c.options={update:function(t,i,f){var c,s,a,h;"select"!==l.a.u(t)&&u(Error("options binding applies only to SELECT elements"));for(var p=0==t.length,w=l.a.V(l.a.fa(t.childNodes,function(n){return n.tagName&&"option"===l.a.u(n)&&n.selected}),function(n){return l.k.q(n)||n.innerText||n.textContent}),b=t.scrollTop,o=l.a.d(i());0<t.length;)l.A(t.options[0]),t.remove(0);if(o){for(f=f(),c=f.optionsIncludeDestroyed,"number"!=typeof o.length&&(o=[o]),f.optionsCaption&&(s=e.createElement("option"),l.a.ca(s,f.optionsCaption),l.k.T(s,r),t.appendChild(s)),i=0,a=o.length;i<a;i++)if(h=o[i],!h||!h._destroy||c){var s=e.createElement("option"),v=function(n,t,i){var r=typeof t;return"function"==r?t(n):"string"==r?n[t]:i},y=v(h,f.optionsValue,h);l.k.T(s,l.a.d(y)),h=v(h,f.optionsText,y),l.a.cb(s,h),t.appendChild(s)}for(o=t.getElementsByTagName("option"),i=c=0,a=o.length;i<a;i++)0<=l.a.i(w,l.k.q(o[i]))&&(l.a.bb(o[i],n),c++);t.scrollTop=b,p&&"value"in f&&wt(t,l.a.ua(f.value),n),l.a.ub(t)}}},l.c.options.sa="__ko.optionValueDomData__",l.c.selectedOptions={init:function(n,t,i){l.a.n(n,"change",function(){var u=t(),r=[];l.a.o(n.getElementsByTagName("option"),function(n){n.selected&&r.push(l.k.q(n))}),l.g.ea(u,i,"value",r)})},update:function(n,t){"select"!=l.a.u(n)&&u(Error("values binding applies only to SELECT elements"));var i=l.a.d(t());i&&"number"==typeof i.length&&l.a.o(n.getElementsByTagName("option"),function(n){var t=0<=l.a.i(i,l.k.q(n));l.a.bb(n,t)})}},l.c.style={update:function(n,t){var r=l.a.d(t()||{}),i,u;for(i in r)"string"==typeof i&&(u=l.a.d(r[i]),n.style[i]=u||"")}},l.c.submit={init:function(t,r,f,e){"function"!=typeof r()&&u(Error("The value for a submit binding must be a function")),l.a.n(t,"submit",function(u){var f,o=r();try{f=o.call(e,t)}finally{f!==n&&(u.preventDefault?u.preventDefault():u.returnValue=i)}})}},l.c.text={update:function(n,t){l.a.cb(n,t())}},l.e.I.text=n,l.c.uniqueName={init:function(n,t){if(t()){var i="ko_unique_"+ ++l.c.uniqueName.ob;l.a.ab(n,i)}}},l.c.uniqueName.ob=0,l.c.value={init:function(t,r,u){function o(){s=i;var n=r(),f=l.k.q(t);l.g.ea(n,u,"value",f)}var f=["change"],e=u().valueUpdate,s=i;e&&("string"==typeof e&&(e=[e]),l.a.P(f,e),f=l.a.Ga(f)),l.a.Z&&"input"==t.tagName.toLowerCase()&&"text"==t.type&&"off"!=t.autocomplete&&(!t.form||"off"!=t.form.autocomplete)&&-1==l.a.i(f,"propertychange")&&(l.a.n(t,"propertychange",function(){s=n}),l.a.n(t,"blur",function(){s&&o()})),l.a.o(f,function(n){var i=o;l.a.Ob(n,"after")&&(i=function(){setTimeout(o,0)},n=n.substring(5)),l.a.n(t,n,i)})},update:function(t,r){var e="select"===l.a.u(t),f=l.a.d(r()),u=l.k.q(t),o=f!=u;0===f&&0!==u&&"0"!==u&&(o=n),o&&(u=function(){l.k.T(t,f)},u(),e&&setTimeout(u,0)),e&&0<t.length&&wt(t,f,i)}},l.c.visible={update:function(n,t){var i=l.a.d(t()),r="none"!=n.style.display;i&&!r?n.style.display="":!i&&r&&(n.style.display="none")}},l.c.click={init:function(n,t,i,r){return l.c.event.init.call(this,n,function(){var n={};return n.click=t(),n},i,r)}},l.v=function(){},l.v.prototype.renderTemplateSource=function(){u(Error("Override renderTemplateSource"))},l.v.prototype.createJavaScriptEvaluatorBlock=function(){u(Error("Override createJavaScriptEvaluatorBlock"))},l.v.prototype.makeTemplateSource=function(n,t){if("string"==typeof n){t=t||e;var i=t.getElementById(n);return i||u(Error("Cannot find template with ID "+n)),new l.l.h(i)}if(1==n.nodeType||8==n.nodeType)return new l.l.O(n);u(Error("Unknown template type: "+n))},l.v.prototype.renderTemplate=function(n,t,i,r){return n=this.makeTemplateSource(n,r),this.renderTemplateSource(n,t,i)},l.v.prototype.isTemplateRewritten=function(t,r){return this.allowTemplateRewriting===i?n:this.makeTemplateSource(t,r).data("isRewritten")},l.v.prototype.rewriteTemplate=function(t,i,r){t=this.makeTemplateSource(t,r),i=i(t.text()),t.text(i),t.data("isRewritten",n)},l.b("templateEngine",l.v),kt=/(<[a-z]+\d*(\s+(?!data-bind=)[a-z0-9\-]+(=(\"[^\"]*\"|\'[^\']*\'))?)*\s+)data-bind=(["'])([\s\S]*?)\5/gi,dt=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g,l.za={vb:function(n,t,i){t.isTemplateRewritten(n,i)||t.rewriteTemplate(n,function(n){return l.za.Gb(n,t)},i)},Gb:function(n,t){return n.replace(kt,function(n,i,r,u,f,e,o){return st(o,i,t)}).replace(dt,function(n,i){return st(i,"<!-- ko -->",t)})},kb:function(n){return l.s.ra(function(t,i){t.nextSibling&&l.Fa(t.nextSibling,n,i)})}},l.b("__tr_ambtns",l.za.kb),l.l={},l.l.h=function(n){this.h=n},l.l.h.prototype.text=function(){var n=l.a.u(this.h),n="script"===n?"text":"textarea"===n?"value":"innerHTML",t;if(0==arguments.length)return this.h[n];t=arguments[0],"innerHTML"===n?l.a.ca(this.h,t):this.h[n]=t},l.l.h.prototype.data=function(n){if(1===arguments.length)return l.a.f.get(this.h,"templateSourceData_"+n);l.a.f.set(this.h,"templateSourceData_"+n,arguments[1])},l.l.O=function(n){this.h=n},l.l.O.prototype=new l.l.h,l.l.O.prototype.text=function(){if(0==arguments.length){var n=l.a.f.get(this.h,"__ko_anon_template__")||{};return n.Aa===r&&n.ia&&(n.Aa=n.ia.innerHTML),n.Aa}l.a.f.set(this.h,"__ko_anon_template__",{Aa:arguments[0]})},l.l.h.prototype.nodes=function(){if(0==arguments.length)return(l.a.f.get(this.h,"__ko_anon_template__")||{}).ia;l.a.f.set(this.h,"__ko_anon_template__",{ia:arguments[0]})},l.b("templateSources",l.l),l.b("templateSources.domElement",l.l.h),l.b("templateSources.anonymousTemplate",l.l.O),l.wa=function(n){n==r||n instanceof l.v||u(Error("templateEngine must inherit from ko.templateEngine")),rt=n},l.va=function(n,i,f,e,o){if(f=f||{},(f.templateEngine||rt)==r&&u(Error("Set a template engine before calling renderTemplate")),o=o||"replaceChildren",e){var s=d(e);return l.j(function(){var t=i&&i instanceof l.z?i:new l.z(l.a.d(i)),r="function"==typeof n?n(t.$data,t):n,t=ft(e,o,r,t,f);"replaceNode"==o&&(e=t,s=d(e))},t,{Ka:function(){return!s||!l.a.X(s)},W:s&&"replaceNode"==o?s.parentNode:s})}return l.s.ra(function(t){l.va(n,i,f,t,"replaceNode")})},l.Mb=function(n,i,u,f,e){function s(n,t){et(t,o),u.afterRender&&u.afterRender(t,n)}function h(i,r){o=e.createChildContext(l.a.d(i),u.as),o.$index=r;var f="function"==typeof n?n(i,o):n;return ft(t,"ignoreTargetNode",f,o,u)}var o;return l.j(function(){var n=l.a.d(i)||[];"undefined"==typeof n.length&&(n=[n]),n=l.a.fa(n,function(n){return u.includeDestroyed||n===r||n===t||!l.a.d(n._destroy)}),l.r.K(l.a.$a,t,[f,n,h,u,s])},t,{W:f})},l.c.template={init:function(t,i){var r=l.a.d(i());return"string"==typeof r||r.name||1!=t.nodeType&&8!=t.nodeType||(r=1==t.nodeType?t.childNodes:l.e.childNodes(t),r=l.a.Hb(r),new l.l.O(t).nodes(r)),{controlsDescendantBindings:n}},update:function(i,u,f,e,o){u=l.a.d(u()),f={},e=n;var s,h=t;"string"!=typeof u&&(f=u,u=f.name,"if"in f&&(e=l.a.d(f["if"])),e&&"ifnot"in f&&(e=!l.a.d(f.ifnot)),s=l.a.d(f.data)),"foreach"in f?h=l.Mb(u||i,e&&f.foreach||[],f,i,o):e?(o="data"in f?o.createChildContext(s,f.as):o,h=l.va(u||i,o,f,i)):l.e.Y(i),o=h,(s=l.a.f.get(i,"__ko__templateComputedDomDataKey__"))&&"function"==typeof s.B&&s.B(),l.a.f.set(i,"__ko__templateComputedDomDataKey__",o&&o.pa()?o:r)}},l.g.Q.template=function(n){return n=l.g.aa(n),1==n.length&&n[0].unknown||l.g.Eb(n,"name")?t:"This template engine does not support anonymous templates nested within its templates"},l.e.I.template=n,l.b("setTemplateEngine",l.wa),l.b("renderTemplate",l.va),l.a.Ja=function(n,t,i){return n=n||[],t=t||[],n.length<=t.length?ut(n,t,"added","deleted",i):ut(t,n,"deleted","added",i)},l.b("utils.compareArrays",l.a.Ja),l.a.$a=function(t,i,u,f,e){function rt(n,t){o=d[t],nt!==t&&(it[n]=o),o.na(nt++),k(o.M),g.push(o),p.push(o)}function v(n,t){if(n)for(var i=0,r=t.length;i<r;i++)t[i]&&l.a.o(t[i].M,function(r){n(r,i,t[i].U)})}var s,a,ut;i=i||[],f=f||{};var a=l.a.f.get(t,"setDomNodeChildrenFromArrayMapping_lastMappingResult")===r,d=l.a.f.get(t,"setDomNodeChildrenFromArrayMapping_lastMappingResult")||[],y=l.a.V(d,function(n){return n.U}),h=l.a.Ja(y,i),g=[],c=0,nt=0,tt=[],p=[];i=[];for(var it=[],y=[],o,s=0,w,b;w=h[s];s++)switch(b=w.moved,w.status){case"deleted":b===r&&(o=d[c],o.j&&o.j.B(),tt.push.apply(tt,k(o.M)),f.beforeRemove&&(i[s]=o,p.push(o))),c++;break;case"retained":rt(s,c++);break;case"added":b!==r?rt(s,b):(o={U:w.value,na:l.m(nt++)},g.push(o),p.push(o),a||(y[s]=o))}for(v(f.beforeMove,it),l.a.o(tt,f.beforeRemove?l.A:l.removeNode),s=0,a=l.e.firstChild(t);o=p[s];s++){for(o.M||l.a.extend(o,gt(t,u,o.U,e,o.na)),c=0;h=o.M[c];a=h.nextSibling,ut=h,c++)h!==a&&l.e.Pa(t,h,ut);!o.Ab&&e&&(e(o.U,o.M,o.na),o.Ab=n)}v(f.beforeRemove,i),v(f.afterMove,it),v(f.afterAdd,y),l.a.f.set(t,"setDomNodeChildrenFromArrayMapping_lastMappingResult",g)},l.b("utils.setDomNodeChildrenFromArrayMapping",l.a.$a),l.C=function(){this.allowTemplateRewriting=i},l.C.prototype=new l.v,l.C.prototype.renderTemplateSource=function(i){var r=!(9>l.a.Z)&&i.nodes?i.nodes():t;return r?l.a.L(r.cloneNode(n).childNodes):(i=i.text(),l.a.ta(i))},l.C.oa=new l.C,l.wa(l.C.oa),l.b("nativeTemplateEngine",l.C),l.qa=function(){var n=this.Db=function(){if("undefined"==typeof f||!f.tmpl)return 0;try{if(0<=f.tmpl.tag.tmpl.open.toString().indexOf("__"))return 2}catch(n){}return 1}();this.renderTemplateSource=function(i,r,o){o=o||{},2>n&&u(Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later."));var s=i.data("precompiled");return s||(s=i.text()||"",s=f.template(t,"{{ko_with $item.koBindingContext}}"+s+"{{/ko_with}}"),i.data("precompiled",s)),i=[r.$data],r=f.extend({koBindingContext:r},o.templateOptions),r=f.tmpl(s,i,r),r.appendTo(e.createElement("div")),f.fragments={},r},this.createJavaScriptEvaluatorBlock=function(n){return"{{ko_code ((function() { return "+n+" })()) }}"},this.addTemplate=function(n,t){e.write("<script type='text/html' id='"+n+"'>"+t+"<\/script>")},0<n&&(f.tmpl.tag.ko_code={open:"__.push($1 || '');"},f.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},l.qa.prototype=new l.v,h=new l.qa,0<h.Db&&l.wa(h),l.b("jqueryTmplTemplateEngine",l.qa)}var n=!0,t=null,i=!1,o=window,e=document,c=navigator,f=window.jQuery,r=void 0;"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?h(module.exports||exports):"function"==typeof define&&define.amd?define(["exports"],h):h(o.ko={}),n}(),logMessages={skill:function(n,t,i,r){return n+" rolled <a rel='tooltip' href='#' title='"+i+"'>"+r+'<\/a> on its "'+t+'" check.'},hit:function(n,t,i,r){return n+' hits with "'+t+"\" for <a rel='tooltip' href='#' title='"+i+"'>"+r+"<\/a> damage."},initiate:function(n,t,i,r){return n+' attacked with "'+t+"\" rolling <a rel='tooltip' href='#' title='"+i+"'>"+r+"<\/a>."},critAttempt:function(n,t,i,r){return n+' attempted to crit using "'+t+"\" for <a rel='tooltip' href='#' title='"+i+"'>"+r+"<\/a>."},critSecond:function(n,t,i,r){return n+' rolls critical confirm using "'+t+"\" for <a rel='tooltip' href='#' title='"+i+"'>"+r+"<\/a>."},critMiss:function(n,t,i,r){return">> If "+n+" fails the critical, the damage is <a rel='tooltip' href='#' title='"+i+"'>"+r+"<\/a>."},critSuccess:function(n,t,i,r){return">> If "+n+" confirms the critical, the damage is <a rel='tooltip' href='#' title='"+i+"'>"+r+"<\/a>."}},MonsterModel=function(n,t){var i=this;console.log(t),i.monsterBaseStats=t.data[0],i.uid=n,i.id=i.monsterBaseStats.m_id,i.feats=new FeatModel(t.mfeat),i.stats={str:new StatModel(i.monsterBaseStats.str),dex:new StatModel(i.monsterBaseStats.dex),con:new StatModel(i.monsterBaseStats.con),wis:new StatModel(i.monsterBaseStats.wis),int:new StatModel(i.monsterBaseStats.int),cha:new StatModel(i.monsterBaseStats.cha),fort:new StatModel(i.monsterBaseStats.fort),ref:new StatModel(i.monsterBaseStats.ref),will:new StatModel(i.monsterBaseStats.will),grapple:new GrappleModel(i.monsterBaseStats.grapple,i.feats),bab:new StatModel(i.monsterBaseStats.base_atk),cmd:new StatModel(i.monsterBaseStats.cmd),cmb:new StatModel(i.monsterBaseStats.cmb),reach:i.monsterBaseStats.reach,space:i.monsterBaseStats.space_taken,treasure:i.monsterBaseStats.treasure,size:ko.observable(i.monsterBaseStats.size),category:ko.observable(i.monsterBaseStats.category)},i.skills=new SkillModel(t.mskill),i.reductions=new DRModel(t.mdmgred),i.qualities=new QualityModel(t.mqualit,i.monsterBaseStats.name),i.armor=new ArmorModel(t.marmor),i.spatks=new SpecialAttackModel(t.mspatk,i.monsterBaseStats.name),i.weapons=new WeaponAttackModel(t.mweapon,i.monsterBaseStats.name),i.attacks=new WeaponAttackModel(t.mattack,i.monsterBaseStats.name),i.initiative=new InitiativeModel(i.stats.dex,i.feats,i.uid),i.hp=new HPModel(i.monsterBaseStats.hit_dice,i.stats.con,i.feats,i.uid),i.speeds=new SpeedModel(t.mmove),i.fatks=new FullAttackModel(t.mfatk),i.ac=new ACModel(i,{"Natural AC":parseInt(i.monsterBaseStats.natural_ac),Base:10,"DEX Bonus":i.stats.dex.bonus(),"Size Mod":_getSizeModifier(i.stats.size())}),i.formatCR=function(n){switch(n){case"0.25":return $("<div/>").html("&frac14;").text();case"0.33":return $("<div/>").html("&frac13;").text();case"0.50":return $("<div/>").html("&frac12;").text()}return parseInt(n)},i.nameTooltip=ko.computed(function(){var r=i.stats.size()+" "+i.stats.category(),u;return t.msubcat.length!=0&&(u=[],$.each(t.msubcat,function(n,t){u.push(t.subcategory)}),r+=" ("+u.join(", ")+")"),$$(n+"_name").attr("data-original-title",r),r})},ko.bindingHandlers.bootstrapTooltip={init:function(n,t){var i=ko.utils.unwrapObservable(t());i=$.extend(!0,{},{},i),$(n).tooltip(i),$(n).click(function(){var t=$(this),n=!0;$(".in").each(function(){$(this).siblings("a").is(t)&&(n=!1),$(this).siblings("a").tooltip("hide")}),n&&$(this).tooltip("show")})}},Roller=function(){this.roll=new function(n){var i=n.split("d"),t=parseInt(i[0]),r=parseInt(i[1]);return t<=0||r<=0?0:Math.floor(Math.random()*(t*r-t+1))+t}};var Data={mode:"html5",init:function(){Data.isHtml5()||(mode="cookie")},isHtml5:function(){return typeof Storage!="undefined"},hasVar:function(n){return Data.mode=="html5"?typeof Data._html5VarGetRaw(n)!="undefined"&&Data._html5VarGetRaw(n)!="undefined"&&Data._html5VarGetRaw(n)!=null:Data._cookieVarGet(n)!==null},getVar:function(n){return Data.mode=="html5"?Data._html5VarGet(n):Data._cookieVarGet(n)},_cookieVarGet:function(n){return $.parseJSON($.cookie(n))},_html5VarGet:function(n){if(!Data.isHtml5())throw new Error("You don't have an HTML5 compliant browser, don't try to fool me!");try{return $.parseJSON(localStorage[n])}catch(t){return null}},_cookieVarGetRaw:function(n){return $.cookie(n)},_html5VarGetRaw:function(n){return localStorage[n]},clearVar:function(n){return Data.mode=="html5"?localStorage.removeItem(n):Data._cookieVarSet(n,null)},setVar:function(n,t){return t=JSON.stringify(t),Data.mode=="html5"?Data._html5VarSet(n,t):Data._cookieVarSet(n,t)},_html5VarSet:function(n,t){if(!Data.isHtml5())throw new Error("You don't have an HTML5 compliant browser, don't try to fool me!");localStorage[n]=t},_cookieVarSet:function(n,t){$.cookie(n,t)}},SESSIONS_VARIABLE="sessions",LAST_SESSION_VARIABLE="lastSessionId",hasReloadedSession=!1;
//@ sourceMappingURL=monster_generator.min.js.map