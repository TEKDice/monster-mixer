(function(b){b.extend(b.fn,{livequery:function(h,i,j){var a=this,g;if(b.isFunction(h)){j=i,i=h,h=undefined}b.each(b.livequery.queries,function(d,c){if(a.selector==c.selector&&a.context==c.context&&h==c.type&&(!i||i.$lqguid==c.fn.$lqguid)&&(!j||j.$lqguid==c.fn2.$lqguid)){return(g=c)&&false}});g=g||new b.livequery(this.selector,this.context,h,i,j);g.stopped=false;g.run();return this},expire:function(f,g,h){var a=this;if(b.isFunction(f)){h=g,g=f,f=undefined}b.each(b.livequery.queries,function(d,c){if(a.selector==c.selector&&a.context==c.context&&(!f||f==c.type)&&(!g||g.$lqguid==c.fn.$lqguid)&&(!h||h.$lqguid==c.fn2.$lqguid)&&!this.stopped){b.livequery.stop(c.id)}});return this}});b.livequery=function(a,i,g,h,j){this.selector=a;this.context=i;this.type=g;this.fn=h;this.fn2=j;this.elements=[];this.stopped=false;this.id=b.livequery.queries.push(this)-1;h.$lqguid=h.$lqguid||b.livequery.guid++;if(j){j.$lqguid=j.$lqguid||b.livequery.guid++}return this};b.livequery.prototype={stop:function(){var a=this;if(this.type){this.elements.unbind(this.type,this.fn)}else{if(this.fn2){this.elements.each(function(f,e){a.fn2.apply(e)})}}this.elements=[];this.stopped=true},run:function(){if(this.stopped){return}var g=this;var f=this.elements,h=b(this.selector,this.context),a=h.not(f);this.elements=h;if(this.type){a.bind(this.type,this.fn);if(f.length>0){b.each(f,function(d,c){if(b.inArray(c,h)<0){b.event.remove(c,g.type,g.fn)}})}}else{a.each(function(){g.fn.apply(this)});if(this.fn2&&f.length>0){b.each(f,function(d,c){if(b.inArray(c,h)<0){g.fn2.apply(c)}})}}}};b.extend(b.livequery,{guid:0,queries:[],queue:[],running:false,timeout:null,checkQueue:function(){if(b.livequery.running&&b.livequery.queue.length){var a=b.livequery.queue.length;while(a--){b.livequery.queries[b.livequery.queue.shift()].run()}}},pause:function(){b.livequery.running=false},play:function(){b.livequery.running=true;b.livequery.run()},registerPlugin:function(){b.each(arguments,function(f,e){if(!b.fn[e]){return}var a=b.fn[e];b.fn[e]=function(){var c=a.apply(this,arguments);b.livequery.run();return c}})},run:function(a){if(a!=undefined){if(b.inArray(a,b.livequery.queue)<0){b.livequery.queue.push(a)}}else{b.each(b.livequery.queries,function(d){if(b.inArray(d,b.livequery.queue)<0){b.livequery.queue.push(d)}})}if(b.livequery.timeout){clearTimeout(b.livequery.timeout)}b.livequery.timeout=setTimeout(b.livequery.checkQueue,20)},stop:function(a){if(a!=undefined){b.livequery.queries[a].stop()}else{b.each(b.livequery.queries,function(d){b.livequery.queries[d].stop()})}}});b.livequery.registerPlugin("append","prepend","after","before","wrap","attr","removeAttr","addClass","removeClass","toggleClass","empty","remove","html");b(function(){b.livequery.play()})})(jQuery);