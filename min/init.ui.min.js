var defaultPopupSize=500;var extendPopupSize=1200;var height=360;var heightAdjust=140;var resizeTimer;function limitFeatNums(a){$("#"+a+"_mfeat_table .applyNum").each(function(){var b=$(this).closest("td").prev().text()=="Power Attack";$(this).change(function(){var e=parseInt($(this).val());var d=parseInt($("#"+a+"_bab").text());var c=clamp(0,(b?d:5),parseInt($("#"+a+"_bab").attr("data-base-value")));if(e<0){e=0}if(e>c){e=c}$(this).val(e)});$(this).closest("td").attr("id",a+"_calc_"+(b?"pa":"ce"))});$("#"+a+"_mfeat_table .inline-checkbox").each(function(){$(this).attr("id",a+"_calc_"+($(this).closest("td").prev().text()=="Awesome Blow"?"ab":"pbs"))})}function setupRoller(){$("#roll").keyup(function(c){if(c.keyCode==27){$("#roll").val("")}if(c.which!=13){return}c.preventDefault();var a=$(this).val();var b=rollDice(a);if(b===0){return}addToLog("Custom roll: "+a+" rolled "+b+".","customRoll")});$("#dice button").click(function(){var a=$("#roll").val()==""?"1"+$(this).text():"+1"+$(this).text();$("#roll").val($("#roll").val()+a)})}function setupRollables(b){var a=b.find("[data-uid]").attr("data-uid");b.find(".rollable").each(function(){var c=$("<i/>").addClass("icon-share-alt");c.click(function(){var d=$(this).parent().find(".info");if(d.length===0){bootbox.alert("Please select a feature to roll.");return}attack(d,$(this),a)});$(this).append(c)})}function setupGrids(a){$(".sortable").sortable({sort:function(c,b){setupGrids(a)}});$(".sortable").disableSelection();$(".draggable").not(".invisible").find(".minibox-content").each(function(){var b=$(this).niceScroll({horizrailenabled:false,zindex:9});$("#"+b.id).attr("data-nice-uid",a)});resizeGrids()}function resizeGrids(){$(".minibox-content").each(function(){$(this).height($(this).parent().height()-22)})}function setupGenButton(){$("#seeMoreButton").button("loading");$("#finalAddButton").button("loading");$("#finalAddButton").click(function(){_addAllSuggestedMonsters($(this))});$("#seeMoreButton").click(function(){_seeMoreButtonFunctionality($(this))});$("#genButton").click(function(){_genButtonFunctionality($(this))})}function _addAllSuggestedMonsters(a){a.button("generating");setTimeout(function(){a.attr("disabled","disabled").addClass("disabled")},10);$("#overlay").fadeIn();$("#advGenFinalContainer tr").each(function(){var b=$(this).data("monster");var c=parseInt($(this).children(":nth-child(2)").text());_hidePopup();setTimeout(function(){for(var d=0;d<c;d++){setTimeout(function(){addNewMonster(b)},100)}},500)});$("#overlay").fadeOut();setTimeout(function(){a.removeAttr("disabled").removeClass("disabled")},10);a.button("reset")}function _seeMoreButtonFunctionality(d){d.button("generating");setTimeout(function(){d.attr("disabled","disabled").addClass("disabled")},10);var b=0;var a={orgs:[],singles:[]};var c=[];$("#advGenMonsters input[type='checkbox']").each(function(){if($(this).is(":checked")){var e=$(this).closest("tr");var g=e.find(".only-positive").val()||null;var f=e.find("select").val();if((g!=null&&g!="0")||f!="null"){b++}if(g!=null&&g!="0"){c[e.attr("data-monster-name")]=g;a.singles.push(e.attr("data-monster-id"))}if(f!="null"){a.orgs.push(f)}}});if(b==0){setTimeout(function(){d.removeAttr("disabled").removeClass("disabled")},10);d.button("reset");bootbox.alert("Please select some monsters to create.");return}$.post("ajax.php",{action:"gen",orgs:JSON.stringify(a)},function(e){_parseSuggestedMonsters($.parseJSON(e),c);$("#finalAddButton").button("reset")}).always(function(){setTimeout(function(){d.removeAttr("disabled").removeClass("disabled")},10);d.button("reset")})}function _parseSuggestedMonsters(c,b){var d=$("#advGenFinalContainer");var a=$("#advGenFinal");d.children().not("#advGenFinal").remove();a.empty();if(Object.keys(b).length){a.show();a.append("<caption>Monsters</caption>")}else{a.hide()}$.each(c,function(h,l){if(l.hasOwnProperty("name")){var g=$("<table/>").addClass("table table-condensed table-striped").css("position","relative").appendTo(d);g.append("<caption>"+l.name+"</caption>");$.each(l.monsters,function(n,p){var o=$("<tr/>").appendTo(g);o.attr("data-gen-min",p.minimum).attr("data-gen-max",p.maximum);o.append("<td>"+p.monster.data[0].name+"</td><td class='rightalign'></td>");o.data("monster",p.monster)});var m=$("<i/>").addClass("icon-share-alt").appendTo(g);m.click(function(){_rerollTable(g)});_rerollTable(g)}else{var j=$("<tr/>");var f=l.data[0].name;var k=b[f];j.append("<td>"+f+"</td><td class='rightalign'>"+k+"</td>").appendTo(a);j.attr("data-gen-min",k).attr("data-gen-max",k);j.data("monster",l)}});$("#advGenFinalContainer").niceScroll({zindex:14,horizrailenabled:false});$("#advGenFinalContainer").css("overflow","hidden")}function _rerollTable(a){a.find("tr").each(function(){var b=parseInt($(this).attr("data-gen-max"));var d=parseInt($(this).attr("data-gen-min"));var c=Math.floor(Math.random()*(b-d+1))+d;$(this).children(":nth-child(2)").text(c)})}function _genButtonFunctionality(a){a.button("loading");var b={};$(".inner-filter-container").each(function(){var d=$(this).attr("data-attr");b[d]=[];_gaq.push(["_trackEvent","Filter",d]);$(this).children(".badge").each(function(){b[d].push({sign:$(this).attr("data-sign"),value:$(this).attr("data-value")})})});var c=$("#extra").is(":visible");$.post("ajax.php",{action:"gen",data:JSON.stringify(b),adv:c},function(e){a.button("reset");if(e===""){bootbox.alert("No results were found with your filters. Try broadening your search.");return}if(!c){e=$.parseJSON(e);var d=addNewMonster(e);setupGrids(d);return}$("#advGenMonsters").empty();$.each($.parseJSON(e),function(f,g){addNewSuggestedRow(f,g)});$(".only-positive").change(function(){var f=parseInt($(this).val());if(f<0){f=0}$(this).val(f)});$("tr[data-monster-name] select, tr[data-monster-name] .only-positive").change(function(){$(this).closest("tr").find("input[type='checkbox']").prop("checked",true)});$("#seeMoreButton").button("reset")})}function addNewSuggestedRow(b,c){var a=$("#advGenTemplate").html();$("#advGenMonsters").append("<tr data-monster-name='"+b+"' data-monster-id='"+c.id+"'><td>"+a+"</td></tr>");_makeSelect(b,c.orgs);$("[data-monster-name='"+b+"'] .monsterName").attr("title",b).text(b).tooltip({delay:500});$("#advGenContainer").niceScroll({zindex:14,horizrailenabled:false});$("#advGenContainer").css("overflow","hidden")}function _makeSelect(b,c){var a=$("[data-monster-name='"+b+"'] select");$.each(c,function(d,f){if(f.organization.indexOf(b)!=-1){f.organization=f.organization.substring(b.length+1)}a.append("<option value='"+f.id+"'>"+f.organization+"</option>")});a.append("<option value='null' selected>No Org.</option>")}function rollableRowHighlighting(a){}function tabChangeScrollbars(){$('a[data-toggle="tab"]').on("shown",function(b){$("#"+$(this).attr("data-uid")).find(".minibox-content").each(function(){var c=$(this).niceScroll({horizrailenabled:false,zindex:9});$("#"+c.id).attr("data-nice-uid",$(this).closest("tab-pane").attr("data-for"));$(this).css("overflow","hidden")});var a=$(this).attr("data-uid");$("#curMon > div[data-for='"+a+"']").show().siblings().hide();_hidePopup()})}function setupAddButton(){$("#newFilter").click(addNewFilter)}function initializePopupToggler(){$("#medianArrowContainer").click(_togglePopupInsides)}function _togglePopupInsides(){if($("#extra").is(":visible")){$("#popup").animate({width:defaultPopupSize});$("#popupLeft").animate({width:defaultPopupSize});$("#extra").animate({width:0},function(){$("#extra").css("display","none");$("#extraToggle").attr("class","icon-arrow-right");$("#medianArrowContainer").attr("title","More options")})}else{$("#popup").animate({width:extendPopupSize},function(){$("#popupLeft").animate({width:defaultPopupSize});$("#extra").css("display","block");$("#extra").animate({width:extendPopupSize-defaultPopupSize});$("#extraToggle").attr("class","icon-arrow-left");$("#medianArrowContainer").attr("title","Less options")})}}function initializeArrowToggler(){$("#showFilters").click(_togglePopup)}function _togglePopup(){$("#popup").slideToggle(400,function(){if($(this).is(":visible")){$("#filterIcon").attr("class","icon-arrow-up");$("#popup").attr("display","inline-block");$("#filterContainer").niceScroll({zindex:14});$("#filterContainer").css("overflow","hidden")}else{$("#filterIcon").attr("class","icon-arrow-down")}})}function _hidePopup(){$("#popup").slideUp(400,function(){$("#filterIcon").attr("class","icon-arrow-down")})}function timedResizeElements(){clearTimeout(resizeTimer);resizeTimer=setTimeout(resizeElements,100)}function handleResizing(){$(window).resize(timedResizeElements);resizeElements()}function resizeElements(){height=$(window).height();$("#log").css("height",height-80-heightAdjust+"px");$("#monsterListCont").css("height",height-50-heightAdjust+"px");$("#monsterList").css("height",height-50-heightAdjust+"px");$(".tab-content").css("height",$("#log").height()-38);$("#log .tab-pane > div").css("height",$("#log").height()-38);$("#monstersContainer > .row-fluid").first().css("height",$("#monsterListCont").height());resizeGrids();changeLogEntrySize()};