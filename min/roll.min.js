function getPrecedence(a){if("*/".indexOf(a)!=-1){return 2}if("-+".indexOf(a)!=-1){return 1}}function isOperator(a){return"+-/*".indexOf(a)!=-1}function isOperand(a){return !/[^0-9d]/.test(a)}function operateOn(op,left,right){return eval(left+op+right)}function toPostfix(c){var b=new Array();var a="";var d=getTokens(c);d.forEach(function(f){if(isOperand(f)){if(f.indexOf("d")!=-1){f=roll(f)}a+=f+" "}else{if(isOperator(f)){while(b.length>0){var g=b.pop();if(getPrecedence(g)>=getPrecedence(f)){a+=g+" "}else{b.push(g);break}}b.push(f)}}});while(b.length>0){var e=b.pop();a+=e+" "}return a.trim()}function getTokens(b){b=b.split(" ").join("");var a="";var c=new Array();b.split("").forEach(function(d){if(isOperand(d)){a+=d}else{if(isOperator(d)){c.push(a);c.push(d);a=""}}});if(a!=""){c.push(a)}return c}function evalPostfix(c){var a=new Array();var b=c.split(" ");b.forEach(function(e){if(isOperand(e)){a.push(e)}else{if(isOperator(e)){var d=a.pop();var f=a.pop();a.push(operateOn(e,f,d))}}});return a.pop()}function evalExpression(a){var b=toPostfix(a);return evalPostfix(b)}function rollExpression(a){return evalExpression(a)}function roll(b){var c=b.split("d");var a=parseInt(c[0]);var d=parseInt(c[1]);if(a<=0||d<=0){return 0}return Math.floor(Math.random()*(((a*d)-a)+1))+a};